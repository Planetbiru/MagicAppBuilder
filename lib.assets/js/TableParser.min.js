class TableParser{constructor(e){this.tableInfo=[],this.init(),e&&this.parseAll(e)}init(){this.typeList="timestamptz,timestamp,serial4,bigserial,int2,int4,int8,tinyint,bigint,text,nvarchar,varchar,enum,set,numeric,decimal,char,real,float,integer,int,datetime,date,double,boolean,bool".split(",")}inArray(e,t){return e.includes(t)}isPrimaryKey(e){let t=e.toUpperCase().replace(/\s+/g," ").trim();return t.includes("PRIMARY KEY")}isAutoIncrement(e){let t=e.toUpperCase().replace(/\s+/g," ").trim(),s=!1;return(s=t.includes("AUTO_INCREMENT"))||(s=t.includes("SERIAL")||t.includes("BIGSERIAL")||t.includes("NEXTVAL")),s}parseTable(e){e=e.split(";")[0];let t=/(\w+\s+key.*|\w+\s+bigserial|\w+\s+serial4|\w+\s+tinyint.*|\w+\s+bigint.*|\w+\s+text.*|\w+\s+nvarchar.*|\w+\s+varchar.*|\w+\s+char.*|\w+\s+real.*|\w+\s+float.*|\w+\s+integer.*|\w+\s+int.*|\w+\s+datetime.*|\w+\s+date.*|\w+\s+double.*|\w+\s+bigserial.*|\w+\s+serial.*|\w+\s+timestamp.*|\w+\s+timestamptz.*|\w+\s+boolean.*|\w+\s+bool.*|\w+\s+enum\s*\(.*\)|\w+\s+enum\s*\(.*\)|\w+\s+set\s*\(.*\)|\w+\s+decimal\s*\(.*\)|\w+\s+numeric\s*\(.*\))/gim,s=/(?<fname>\w+)\s+(?<ftype>\w+)(?<fattr>.*)/gi,i=/enum\s*\(([^)]+)\)/i,l=/not\s+null/i,r=/primary\s+key/i,a=/default\s+(.+)/i,n=/(PRIMARY|UNIQUE) KEY[a-zA-Z_0-9\s]+\(([a-zA-Z_0-9,\s]+)\)/gi,u=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gim.exec(e),c=u.groups.tb,m=[],o=null,p=[],w=[];for(;null!=(u=t.exec(e));){let h=u[0],d=h;s.lastIndex=0;let g=s.exec(h),b=g[2],f=!1;if(i.test(b)){let y;b=`VARCHAR(${Math.max(...i.exec(b)[1].split(",").map(e=>e.trim().replace(/['"]/g,"")).map(e=>e.length))+2})`}if(this.isValidType(b.toString())){let A=g.groups.fattr.replace(",","").trim(),x=!l.test(A),I=A.replace(l,"");f=r.test(I)||this.isPrimaryKey(d);let L=this.isAutoIncrement(d),R=a.exec(I),$=null;R&&R.length>0?(R=R[1].trim()).toLowerCase().includes("comment")&&($=R.substring(R.indexOf("comment"))):R=null;let T=this.getLength(A),_=g.groups.fname.trim();f&&w.push(_),this.inArray(p,_)||(m.push({Field:_,Type:b.trim(),Length:T,Key:f,Nullable:x,Default:R,AutoIncrement:L}),p.push(_))}else if(u[1].toLowerCase().includes("primary")&&u[1].toLowerCase().includes("key")){let C=u[1],E=/\((.*)\)/,K=C.match(E);null==o&&(o=K?K[1]:null)}if(null!=o)for(let N in o=o.split("(").join("").split(")").join(""),m)m[N].Field==o&&(m[N].Key=!0);if(n.test(h)&&r.test(h)){let P=h.replace(h.match(r)[0],""),U=(P=P.replace("(","").replace(")","")).split(",").map(e=>e.trim());for(let v in m)this.inArray(U,m[v].Field)&&(m[v].Key=!0)}}return null==o&&(o=w[0]),{tableName:c,columns:m,primaryKey:o}}getLength(e){if(e.includes("(")&&e.includes(")")){let t=e.match(/\((.*)\)/);return t?t[1]:""}return""}isValidType(e){return this.typeList.includes(e.toLowerCase())}parseAll(e){let t=[],s,i=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gi;for(;null!=(s=i.exec(e));){let l=e.substring(s.index),r=this.parseTable(l);t.push(r)}this.tableInfo=t}getResult(){return this.tableInfo}}