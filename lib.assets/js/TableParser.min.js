class TableParser{constructor(){this.inArray=function(t,e){for(let i in t)if(t[i]==e)return!0;return!1},this.parseTable=function(t){t=t.split(";")[0];let e=/(\w+\s+key.*|\w+\s+bigserial|\w+\s+serial4|\w+\s+tinyint.*|\w+\s+bigint.*|\w+\s+longtext.*|\w+\s+mediumtext.*|\w+\s+smalltext.*|\w+\s+text.*|\w+\s+nvarchar.*|\w+\s+varchar.*|\w+\s+char.*|\w+\s+real.*|\w+\s+float.*|\w+\s+integer.*|\w+\s+int.*|\w+\s+datetime.*|\w+\s+date.*|\w+\s+double.*|\w+\s+bigserial.*|\w+\s+serial.*|\w+\s+timestamp.*|\w+\s+timestamptz.*|\w+\s+boolean.*|\w+\s+bool.*|\w+\s+enum\s*\(.*\))/gim,i=/(?<fname>\w+)\s+(?<ftype>\w+)(?<fattr>.*)/gi,s=/enum\s*\(([^)]+)\)/i,l=/not\s+null/i,n=/primary\s+key/i,a=/default\s+(.+)/i,r=/(PRIMARY|UNIQUE) KEY[a-zA-Z_0-9\s]+\(([a-zA-Z_0-9,\s]+)\)/gi,o=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gim.exec(t),u=o.groups.tb,m=[],f=null,c=[];for(;null!=(o=e.exec(t));){let p=o[0];i.lastIndex=0;let h=i.exec(p),w=h[2],g=!1;if(s.test(w)){let b;w=`VARCHAR(${Math.max(...s.exec(w)[1].split(",").map(t=>t.trim().replace(/['"]/g,"")).map(t=>t.length))+2})`}if(this.isValidType(w.toString())){let d=h.groups.fattr.replace(",","").trim(),x=!l.test(d),y=d.replace(l,"");g=n.test(y);let _=a.exec(y),$=null;_&&_.length>0?-1!=(_=_[1].trim()).toLowerCase().indexOf("comment")&&($=_.substring(_.indexOf("comment"))):_=null;let A=this.getLength(d),L=h.groups.fname.trim();this.inArray(c,L)||(m.push({Field:L,Type:w.trim(),Length:A,Key:g,Nullable:x,Default:_}),c.push(L))}else if(-1!=o[1].toLowerCase().indexOf("primary")&&-1!=o[1].toLowerCase().indexOf("key")){let I=o[1],O=/\((.*)\)/,T=I.match(O);null==f&&(f=null!=T&&void 0!==T[1]?T[1]:null)}if(null!=f)for(let v in f=f.split("(").join("").split(")").join(""),m)m[v].Field==f&&(m[v].Key=!0);if(r.test(p)&&n.test(p)){let C=p.replace(p.match(n)[0],""),K=(C=C.replace("(","").replace(")","")).split(",");for(let R in K)K[R]=K[R].trim();for(let z in m)this.inArray(K,m[z].Field)&&(m[z].Key=!0)}}return{tableName:u,columns:m,primaryKey:f}},this.getLength=function(t){if(-1!=t.indexOf("(")&&-1!=t.indexOf(")")){let e=t.match(/\((.*)\)/);return e?e[1]:""}return""},this.isValidType=function(t){return this.typeList.includes(t.toLowerCase())},this.getResult=function(){return this.tableInfo},this.init=function(){this.typeList="timestamptz,timestamp,serial4,bigserial,int2,int4,int8,tinyint,smallint,mediumint,bigint,tinytext,smalltext,mediumtext,longtext,longtext,text,nvarchar,varchar,enum,char,real,float,integer,int,datetime,date,double,boolean,bool".split(",")},this.parseAll=function(t){let e=[],i,s=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gi;for(;null!=(i=s.exec(t));){let l=t.substring(i.index),n=this.parseTable(l);e.push(n)}this.tableInfo=e},this.tableInfo=[],this.init(),"undefined"!=typeof sql&&this.parseAll(sql)}}