class TableParser{constructor(){this.inArray=function(e,t){for(let i in e)if(e[i]==t)return!0;return!1},this.isPrimaryKey=function(e){let t=e.toUpperCase().replace(/\s+/g," ").trim();return console.log(t),-1!=t.indexOf("PRIMARY KEY")},this.isAutoIncrement=function(e){return -1!=e.toUpperCase().replace(/\s+/g," ").trim().indexOf("AUTO_INCREMENT")},this.parseTable=function(e){e=e.split(";")[0];let t=/(\w+\s+key.*|\w+\s+bigserial|\w+\s+serial4|\w+\s+tinyint.*|\w+\s+bigint.*|\w+\s+text.*|\w+\s+nvarchar.*|\w+\s+varchar.*|\w+\s+char.*|\w+\s+real.*|\w+\s+float.*|\w+\s+integer.*|\w+\s+int.*|\w+\s+datetime.*|\w+\s+date.*|\w+\s+double.*|\w+\s+bigserial.*|\w+\s+serial.*|\w+\s+timestamp.*|\w+\s+timestamptz.*|\w+\s+boolean.*|\w+\s+bool.*|\w+\s+enum\s*\(.*\)|\w+\s+enum\s*\(.*\)|\w+\s+set\s*\(.*\)|\w+\s+decimal\s*\(.*\)|\w+\s+numeric\s*\(.*\))/gim,i=/(?<fname>\w+)\s+(?<ftype>\w+)(?<fattr>.*)/gi,s=/enum\s*\(([^)]+)\)/i,n=/not\s+null/i,r=/primary\s+key/i,l=/default\s+(.+)/i,a=/(PRIMARY|UNIQUE) KEY[a-zA-Z_0-9\s]+\(([a-zA-Z_0-9,\s]+)\)/gi,o=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gim.exec(e),u=o.groups.tb,c=[],m=null,f=[],p=[];for(;null!=(o=t.exec(e));){let h=o[0],w=h;i.lastIndex=0;let g=i.exec(h),b=g[2],d=!1;if(s.test(b)){let y;b=`VARCHAR(${Math.max(...s.exec(b)[1].split(",").map(e=>e.trim().replace(/['"]/g,"")).map(e=>e.length))+2})`}if(this.isValidType(b.toString())){let x=g.groups.fattr.replace(",","").trim(),_=!n.test(x),A=x.replace(n,"");(d=r.test(A))||(d=this.isPrimaryKey(w));let $=this.isAutoIncrement(w),I=l.exec(A),L=null;I&&I.length>0?-1!=(I=I[1].trim()).toLowerCase().indexOf("comment")&&(L=I.substring(I.indexOf("comment"))):I=null;let O=this.getLength(x),C=g.groups.fname.trim();d&&p.push(C),this.inArray(f,C)||(c.push({Field:C,Type:b.trim(),Length:O,Key:d,Nullable:_,Default:I,AutoIncrement:$}),f.push(C))}else if(-1!=o[1].toLowerCase().indexOf("primary")&&-1!=o[1].toLowerCase().indexOf("key")){let K=o[1],R=/\((.*)\)/,T=K.match(R);null==m&&(m=null!=T&&void 0!==T[1]?T[1]:null)}if(null!=m)for(let v in m=m.split("(").join("").split(")").join(""),c)c[v].Field==m&&(c[v].Key=!0);if(a.test(h)&&r.test(h)){let E=h.replace(h.match(r)[0],""),N=(E=E.replace("(","").replace(")","")).split(",");for(let P in N)N[P]=N[P].trim();for(let U in c)this.inArray(N,c[U].Field)&&(c[U].Key=!0)}}return null==m&&(m=p[0]),{tableName:u,columns:c,primaryKey:m}},this.getLength=function(e){if(-1!=e.indexOf("(")&&-1!=e.indexOf(")")){let t=e.match(/\((.*)\)/);return t?t[1]:""}return""},this.isValidType=function(e){return this.typeList.includes(e.toLowerCase())},this.getResult=function(){return this.tableInfo},this.init=function(){this.typeList="timestamptz,timestamp,serial4,bigserial,int2,int4,int8,tinyint,bigint,text,nvarchar,varchar,enum,set,numeric,decimal,char,real,float,integer,int,datetime,date,double,boolean,bool".split(",")},this.parseAll=function(e){let t=[],i,s=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gi;for(;null!=(i=s.exec(e));){let n=e.substring(i.index),r=this.parseTable(n);t.push(r)}this.tableInfo=t},this.tableInfo=[],this.init(),"undefined"!=typeof sql&&this.parseAll(sql)}}