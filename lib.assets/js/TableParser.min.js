class TableParser{constructor(e){this.tableInfo=[],this.init(),e&&this.parseAll(e)}init(){this.typeList="TIMESTAMPTZ,TIMESTAMP,SERIAL4,BIGSERIAL,INT2,INT4,INT8,TINYINT,BIGINT,TEXT,NVARCHAR,VARCHAR,ENUM,SET,NUMERIC,DECIMAL,CHAR,REAL,FLOAT,INTEGER,INT,DATETIME,DATE,DOUBLE,BOOLEAN,BOOL".split(",")}inArray(e,t){return e.includes(t)}isPrimaryKey(e){let t=e.toUpperCase().replace(/\s+/g," ").trim();return t.includes("PRIMARY KEY")}isAutoIncrement(e){let t=e.toUpperCase().replace(/\s+/g," ").trim(),s=!1;return(s=t.includes("AUTO_INCREMENT"))||(s=t.includes("SERIAL")||t.includes("BIGSERIAL")||t.includes("NEXTVAL")),s}parseTable(e){e=e.split(";")[0];let t=/(\w+\s+key.*|\w+\s+bigserial|\w+\s+serial4|\w+\s+tinyint.*|\w+\s+bigint.*|\w+\s+text.*|\w+\s+nvarchar.*|\w+\s+varchar.*|\w+\s+char.*|\w+\s+real.*|\w+\s+float.*|\w+\s+integer.*|\w+\s+int.*|\w+\s+datetime.*|\w+\s+date.*|\w+\s+double.*|\w+\s+bigserial.*|\w+\s+serial.*|\w+\s+timestamp.*|\w+\s+timestamptz.*|\w+\s+boolean.*|\w+\s+bool.*|\w+\s+enum\s*\(.*\)|\w+\s+enum\s*\(.*\)|\w+\s+set\s*\(.*\)|\w+\s+decimal\s*\(.*\)|\w+\s+numeric\s*\(.*\))/gim,s=/(?<fname>\w+)\s+(?<ftype>\w+)(?<fattr>.*)/gi,i=/enum\s*\(([^)]+)\)/i,l=/not\s+null/i,r=/primary\s+key/i,a=/default\s+(.+)/i,n=/(PRIMARY|UNIQUE) KEY[a-zA-Z_0-9\s]+\(([a-zA-Z_0-9,\s]+)\)/gi,u=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gim.exec(e),c=u.groups.tb,p=[],m=null,o=[],A=[];for(;null!=(u=t.exec(e));){let I=u[0],h=I;s.lastIndex=0;let w=s.exec(I),T=w[2],g=!1;if(i.test(T)){let E;T=`VARCHAR(${Math.max(...i.exec(T)[1].split(",").map(e=>e.trim().replace(/['"]/g,"")).map(e=>e.length))+2})`}if(this.isValidType(T.toString())){let f=w.groups.fattr.replace(",","").trim(),y=!l.test(f),b=f.replace(l,"");g=r.test(b)||this.isPrimaryKey(h);let d=this.isAutoIncrement(h),R=a.exec(b),N=null;R&&R.length>0?(R=R[1].trim()).toLowerCase().includes("comment")&&(N=R.substring(R.indexOf("comment"))):R=null;let L=this.getLength(f),x=w.groups.fname.trim();g&&A.push(x),this.inArray(o,x)||(p.push({Field:x,Type:T.trim(),Length:L,Key:g,Nullable:y,Default:R,AutoIncrement:d}),o.push(x))}else if(this.isPrimaryKey(h)){let C=u[1],M=/\((.*)\)/,$=C.match(M);null==m&&(m=$?$[1]:null)}if(null!=m)for(let K in m=m.split("(").join("").split(")").join(""),p)p[K].Field==m&&(p[K].Key=!0);if(n.test(I)&&r.test(I)){let U=I.replace(I.match(r)[0],""),O=(U=U.replace("(","").replace(")","")).split(",").map(e=>e.trim());for(let P in p)this.inArray(O,p[P].Field)&&(p[P].Key=!0)}}return null==m&&(m=A[0]),{tableName:c,columns:p,primaryKey:m}}getLength(e){if(e.includes("(")&&e.includes(")")){let t=e.match(/\((.*)\)/);return t?t[1]:""}return""}isValidType(e){return this.typeList.includes(e.toUpperCase())}parseAll(e){let t=[],s,i=/(create\s+table\s+if\s+not\s+exists|create\s+table)\s(?<tb>.*)\s\(/gi;for(;null!=(s=i.exec(e));){let l=e.substring(s.index),r=this.parseTable(l);t.push(r)}this.tableInfo=t}getResult(){return this.tableInfo}}