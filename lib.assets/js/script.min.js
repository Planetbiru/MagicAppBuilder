let initielized=!1,currentEntity="",currentValidator="",currentModule="",currentEntity2Translated="",lastErrorLine=-1,ajaxPending=0,referenceResource="",currentEntityName="",currentValidatorName="",currentTableName="",currentTableStructure={};function increaseAjaxPending(){ajaxPending++,updatePendingBar()}function decreaseAjaxPending(){ajaxPending--,updatePendingBar()}function updatePendingBar(){$(".ajax-pending").css("width",16*ajaxPending+"px")}function resetWorkspaceSearch(){$("#search-workspace").val(""),doFilterWorkspace($("#search-workspace"))}function resetApplicationSearch(){$("#search-application").val(""),doFilterApplication($("#search-application"))}let keyWords="absolute,action,add,after,aggregate,alias,all,allocate,alter,analyse,analyze,and,any,are,array,as,asc,assertion,at,authorization,avg,before,begin,between,binary,bit,bit_length,blob,boolean,both,breadth,by,call,cascade,cascaded,case,cast,catalog,char,character,character_length,char_length,check,class,clob,close,coalesce,collate,collation,column,commit,completion,connect,connection,constraint,constraints,constructor,continue,convert,corresponding,count,create,cross,cube,current,current_date,current_path,current_role,current_time,current_timestamp,current_user,cursor,cycle,data,date,day,deallocate,dec,decimal,declare,default,deferrable,deferred,delete,depth,deref,desc,describe,descriptor,destroy,destructor,deterministic,diagnostics,dictionary,disconnect,distinct,do,domain,double,drop,dynamic,each,else,end,end-exec,equals,escape,every,except,exception,exec,execute,exists,external,extract,false,fetch,first,float,for,foreign,found,free,from,full,function,general,get,global,go,goto,grant,group,grouping,having,host,hour,identity,ignore,immediate,in,indicator,initialize,initially,inner,inout,input,insensitive,insert,int,integer,intersect,interval,into,is,isolation,iterate,join,key,language,large,last,lateral,leading,left,less,level,like,limit,local,localtime,localtimestamp,locator,lower,map,match,max,min,minute,modifies,modify,month,names,national,natural,nchar,nclob,new,next,no,none,not,null,nullif,numeric,object,octet_length,of,off,offset,old,on,only,open,operation,option,or,order,ordinality,out,outer,output,overlaps,pad,parameter,parameters,partial,path,placing,position,postfix,precision,prefix,preorder,prepare,preserve,primary,prior,privileges,procedure,public,read,reads,real,recursive,ref,references,referencing,relative,restrict,result,return,returns,revoke,right,role,rollback,rollup,routine,row,rows,savepoint,schema,scope,scroll,search,second,section,select,sequence,session,session_user,set,sets,size,smallint,some,space,specific,specifictype,sql,sqlcode,sqlerror,sqlexception,sqlstate,sqlwarning,start,state,statement,static,structure,substring,sum,system_user,table,temporary,terminate,than,then,time,timestamp,timezone_hour,timezone_minute,to,trailing,transaction,translate,translation,treat,trigger,trim,true,under,union,unique,unknown,unnest,update,upper,usage,user,using,value,values,varchar,variable,varying,view,when,whenever,where,with,without,work,write,year,zone";function updateDependency(e,t){let a="";"update-magic-object"==e?a="MagicObject":"update-magic-app"==e?a="MagicApp":"update-classes"==e&&(a="Classes");let n=`Are you sure you want to update ${a}?`,i=`Error while update ${a}.`,l=`${a} updated successfully.`;asyncAlert(n,"Confirmation",[{caption:"OK",class:"btn-primary",fn:function(){let a=$(t).html();$(t).html('<i class="fas fa-spinner fa-spin"></i> Updating...').prop("disabled",!0);let n=$(t).closest("form").find('[name="application_id"]').val();$.ajax({url:"lib.ajax/application-dependency-update.php",type:"POST",dataType:"json",data:{application_id:n,option:e},success:function(e){e.success?showToast("Success",l):showToast("Failed",i)},error:function(){showToast("Error",i)},complete:function(){$(t).html(a).prop("disabled",!1)}})}},{caption:"Cancel",class:"btn-secondary",fn:function(){}},])}function showWaitingScreen(){document.body.style.overflow="hidden",document.querySelector(".waiting-screen").style.display="block",document.querySelector(".all").style.height="calc(100vh - 32px)",document.querySelector(".all").style.overflow="hidden"}function hideWaitingScreen(){document.body.style.overflow="auto",document.querySelector(".waiting-screen").style.display="none",document.querySelector(".all").style.height="auto",document.querySelector(".all").style.overflow="auto"}function setCheckingStatus(e,t){$.ajax({type:"GET",data:{userAction:"check-status",applicationId:e},url:"lib.ajax/application-status.php",dataType:"json",success:function(a){if("finish"!==a.applicationStatus)setTimeout(function(){setCheckingStatus(e,t)},1e3);else{let n=(new Date().getTime()-t)/1e3;showToast("Application Ready",`The application was successfully created in ${n.toFixed(2)} seconds.`),updateApplicationInfo(e),hideWaitingScreen(),loadAllResource()}},error:function(e){console.error(e)}})}function updateApplicationInfo(e){increaseAjaxPending(),$.ajax({type:"POST",data:{userAction:"update-info",applicationId:e},url:"lib.ajax/application-status.php",dataType:"json",success:function(e){decreaseAjaxPending()},error:function(e){decreaseAjaxPending()}})}function fillEntityGeneratorForm(e){let t=e.closest("table"),a=upperCamelize(e.val()),n=e.find("option:selected").attr("data-primary-keys").split(",")[0];t.find('[name="entity_generator_entity_name"]').val(a),t.find('[name="entity_generator_primary_key"]').val(n)}function saveFeatureForm(){let e={};$("#modal-module-features").find('input[type="checkbox"]').each(function(){e[$(this).attr("name")]=$(this)[0].checked}),$("#modal-module-features").find('input[type="radio"]').each(function(){$(this)[0].checked&&(e[$(this).attr("name")]=$(this).val())}),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/module-features.php",data:{data:JSON.stringify(e)},dataType:"json",success:function(e){decreaseAjaxPending()},error:function(e){decreaseAjaxPending()}})}function restoreFeatureForm(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/module-features.php",dataType:"json",success:function(e){void 0===e.activate_deactivate?asyncAlert("No cononfiguration found for the current application.","Configuration Not Found",[{caption:"Close",fn(){},class:"btn-primary"}]):($("#modal-module-features").find('input[type="checkbox"]').each(function(){let t=$(this).attr("name");e.hasOwnProperty(t)&&$(this).prop("checked",e[t])}),$("#modal-module-features").find('input[type="radio"]').each(function(){let t=$(this).attr("name"),a=$(this).val();e.hasOwnProperty(t)&&e[t]===a&&$(this).prop("checked",!0)}),e.with_approval?($("#approval_type1")[0].disabled=!1,$("#approval_type2")[0].disabled=!1,$("#approval_position1")[0].disabled=!1,$("#approval_position2")[0].disabled=!1,$("#approval_by_other_user")[0].disabled=!1,$("#approval_bulk")[0].disabled=!1):($("#approval_type1")[0].disabled=!0,$("#approval_type2")[0].disabled=!0,$("#approval_position1")[0].disabled=!0,$("#approval_position2")[0].disabled=!0,$("#approval_by_other_user")[0].disabled=!0,$("#approval_bulk")[0].disabled=!0),e.export_to_csv?$("#export_use_temporary")[0].disabled=!1:$("#export_use_temporary")[0].disabled=!0,e.backend_only?$("#ajax_support")[0].disabled=!0:$("#ajax_support")[0].disabled=!1),decreaseAjaxPending()},error:function(e){console.error(e),decreaseAjaxPending()}})}String.prototype.equalIgnoreCase=function(e){return this.toLowerCase()==e.toLowerCase()},String.prototype.replaceAll=function(e,t,a){return this.replace(RegExp(e.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),a?"gi":"g"),"string"==typeof t?t.replace(/\$/g,"$$$$"):t)},String.prototype.replaceAll=function(e,t,a){return this.replace(RegExp(e.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),a?"gi":"g"),"string"==typeof t?t.replace(/\$/g,"$$$$"):t)},String.prototype.capitalize=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()})},String.prototype.prettify=function(){let e,t,a=this.split(" ");for(e=0;e<a.length;e++)switch(t=a[e]){case"Id":a[e]="";break;case"Ip":a[e]="IP"}return a.join(" ")},String.prototype.replaceAll=function(e,t){return this.replace(RegExp(e,"g"),t)},jQuery(function(){$("body").load("lib.ajax/body.min.html",function(){initAll(),initEditor(),initFileManager()})});let validatorBuilder=null,valBuilder=null;function createValidator(e){increaseAjaxPending(),currentValidator=$('#validationMasterModal [name="validatorName"]').val(),$.ajax({type:"POST",dataType:"html",url:"lib.ajax/validator-create.php",data:{userAction:"create",tableName:$('#validationMasterModal [name="tableName"]').val(),validator:$('#validationMasterModal [name="validatorName"]').val(),definition:$('#validationMasterModal [name="validatorDefinition"]').val()},success:function(e){$(".validator-container-file .validator-list").empty().append(e),$(".container-translate-validator .validator-list").empty().append(e),$("button#validator-file-tab").removeClass("text-danger");$(".validator-container-file .validator-list").find('a[data-error="true"]').length&&$("button#validator-file-tab").addClass("text-danger"),clearValidatorFile(),clearTtransEd5(),clearTtransEd6(),decreaseAjaxPending(),$("#validationMasterModal").modal("hide"),$(".modal-backdrop").css("display","none"),$("body").removeClass("modal-open"),getValidatorFile(currentValidator,function(){$(".validator-container-file .validator-li").removeClass("selected-file"),$('.validator-container-file .validator-li [data-validator-name="'+currentValidator+'"]').closest("li").addClass("selected-file")},0)},error:function(e){decreaseAjaxPending()}})}function addValidatorForm(){increaseAjaxPending(),$.ajax({type:"POST",dataType:"html",url:"lib.ajax/validator-create-form.php",data:{userAction:"select-table"},success:function(e){$("#validationMasterModal .modal-header .modal-title").text("Create New Validator"),$("#validationMasterModal .modal-body").empty().append(e),$("#validationMasterModal .master-validation-modal-ok").text("Create Form"),$("#validationMasterModal .master-validation-modal-ok").attr("onclick","selectTableForNewValidator(this)"),$("#validationMasterModal").data("bs.modal",null),$("#validationMasterModal").modal({backdrop:"static",keyboard:!1,show:!0}),valBuilder||(valBuilder=new ValidationBuilder("#validationMasterModal",".validation-modal-merged","#validationMasterModal .validation-output","#validationMasterModal .field-group")),decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}function selectTableForNewValidator(e){let t=e.form.querySelector('[name="tableName"]').value,a=e.form.querySelector('[name="validatorName"]').value;increaseAjaxPending(),$.ajax({type:"POST",dataType:"html",url:"lib.ajax/validator-create-form.php",data:{userAction:"create-form",tableName:t,validatorName:a},success:function(e){valBuilder.setValidation({}),$("#validationMasterModal .modal-header .modal-title").text("Create New Validator"),$("#validationMasterModal .modal-body").empty().append(e),$("#validationMasterModal .master-validation-modal-ok").text("Create"),$("#validationMasterModal .master-validation-modal-ok").attr("onclick","createValidator(this)"),$("#validationMasterModal").data("bs.modal",null),$("#validationMasterModal").modal({keyboard:!1,show:!0}),decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}function testValidator(e){let t=e.form;increaseAjaxPending(),$.ajax({type:"post",dataType:"json",url:"lib.ajax/validator-test.php?validator="+encodeURIComponent(currentValidator),data:$(t).serialize(),success:function(e){let t=$("#genericModal .modal-body");if(t.find("input").removeClass("is-invalid"),e&&e.success)t.find(".validator-test-message").empty().append('<div class="alert alert-success">'+e.message+"</div>");else{let a="An error occurred.";e&&e.message&&(a=e.message),t.find(".validator-test-message").empty().append('<div class="alert alert-danger">'+a+"</div>"),e.propertyName&&t.find('[name="'+e.propertyName+'"]').addClass("is-invalid").select()}decreaseAjaxPending()},error:function(e,t,a){$("#validationMasterModal .modal-body .validator-test-message").empty().append('<div class="alert alert-danger">AJAX Error: '+t+" - "+a+"</div>"),decreaseAjaxPending()}})}function updateValidatorForm(){$("#validationMasterModal .modal-header .modal-title").text("Update Validator"),$("#validationMasterModal .modal-body").empty(),$("#validationMasterModal .master-validation-modal-ok").text("Update"),$("#validationMasterModal .master-validation-modal-ok").attr("onclick","createValidator(this)"),$.ajax({type:"post",dataType:"html",url:"lib.ajax/validator-create-form.php",data:{userAction:"update-form",validator:currentValidator},success:function(e){decreaseAjaxPending(),$("#validationMasterModal .modal-body").append(e),valBuilder||(valBuilder=new ValidationBuilder("#validationMasterModal",".validation-modal-merged","#validationMasterModal .validation-output","#validationMasterModal .field-group"));let t=JSON.parse($('#validationMasterModal .modal-body [name="existing"]').val());valBuilder.setValidation(t.properties),valBuilder.renderValidationsMerged()},error:function(e,t,a){decreaseAjaxPending()}}),$("#validationMasterModal").data("bs.modal",null),$("#validationMasterModal").modal({backdrop:"static",keyboard:!1,show:!0})}function renderValidatorEditor(e){let t=document.createElement("div"),a=document.createElement("table");return a.className="config-table",a.innerHTML=`
    <tbody>
      <tr><td>Table Name</td><td>${e.tableName}</td></tr>
      <tr><td>Validator Class Name</td><td>${e.className}</td></tr>
    </tbody>
  `,t.appendChild(a),Object.entries(e.properties).forEach(([e,a])=>{let n=document.createElement("div");n.className="mb-3 field-group validation-item",n.dataset.fieldName=e,n.dataset.maximumLength=a?.validators?.find(e=>"MaxLength"===e.validationType)?.attributes?.value||"",n.innerHTML=`
      <hr>
      <span class="form-label">${e}</span>
      <div class="field-validations-list mt-2"></div>
      <button type="button" class="btn btn-primary mt-2 add-validation-merged">
        <i class="fa-solid fa-plus"></i> Add Validation
      </button>
    `,t.appendChild(n)}),t.innerHTML+=`
    <hr>
    <span class="form-label">Definition</span>
    <input type="hidden" name="tableName" value="${htmlEncode(e.tableName)}">
    <input type="hidden" name="validatorName" value="${htmlEncode(e.className)}">
    <textarea class="form-control validation-output" name="validatorDefinition" rows="5" readonly></textarea>
  `,t}function htmlEncode(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function showTestValidatorForm(){increaseAjaxPending(),$.ajax({type:"POST",dataType:"html",url:"lib.ajax/validator-form.php",data:{validator:currentValidator},success:function(e){$("#genericModal .modal-header .modal-title").text(currentValidator+" Test"),$("#genericModal .modal-body").empty().append(e),$("#genericModal .generic-modal-ok").text("Test Validator"),$("#genericModal .generic-modal-ok").attr("onclick","testValidator(this)"),$("#genericModal").modal("show"),decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}function deleteValidatorFile(){asyncAlert(`Do you want to delete file ${currentValidator}.php?`,"Confirmation",[{caption:"Yes",fn(){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/validator-delete.php",dataType:"json",data:{validator:currentValidator},success:function(e){decreaseAjaxPending(),updateValidatorFile(),resetFileManager(),removeHilightLineError(cmEditorValidator),e.success&&(setValidatorFile(""),$("#button_save_validator_file").attr("disabled","disabled"),$("#button_save_validator_file_as").attr("disabled","disabled"),$("#button_test_validator").attr("disabled","disabled"),$("#button_delete_validator_file").attr("disabled","disabled"),$("#button_update_validator_file").attr("disabled","disabled"))},error:function(e){decreaseAjaxPending()}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}function handleApplicationFileUpload(e,t,a,n,i){let l=$("#tab-pane-from-config .import-message"),o=$("#modal-application-import .button-save-application-import"),r=new FormData;r.append("user_action",t),a&&r.append("application_id",a),n&&r.append("application_name",n),i&&r.append("base_application_directory",i),r.append("file[]",e),$('#tab-pane-from-config [name="file_name"]').val(e.name),l.html('<div class="alert alert-info">Uploading and parsing file...</div>'),$.ajax({url:"lib.ajax/application-import.php",type:"POST",data:r,processData:!1,contentType:!1,dataType:"json",success:function(e){e.success?($('#tab-pane-from-config [name="base_application_directory"]').val(e.data.base_application_directory),$('#tab-pane-from-config [name="application_name"]').val(e.data.application_name),$('#tab-pane-from-config [name="application_id"]').val(e.data.application_id),o[0].disabled=!1,"import"==t&&(loadAllResource(),$("#modal-application-import").modal("hide"))):($('#tab-pane-from-config [name="base_application_directory"]').val(e.data.base_application_directory||""),$('#tab-pane-from-config [name="application_name"]').val(e.data.application_name||""),$('#tab-pane-from-config [name="application_id"]').val(e.data.application_id||""),o[0].disabled=!1),l.html(`<div class="alert alert-${e.status}">${e.message}</div>`)},error:function(e,t,a){o[0].disabled=!0,console.error("Error during file upload:",t,a,e);let n=`Error: Failed to upload or parse file. ${a}`;e.responseText&&(n+=`<br>Server Response: ${e.responseText.substring(0,200)}...`),l.html(`<div class="alert alert-danger">${n}</div>`)}})}function getLocalStorageKey(e){let t=window.location.pathname,a=t.endsWith("/")?t:t.substring(0,t.lastIndexOf("/")+1),n=a.replace(/\/+/g,"_").replace(/^_+|_+$/g,"");return n?`${n}__${e}`:e}function showLoginError(e="Invalid username or password. Please try again."){let t=$("#loginForm .login-error");t.length&&t.text(e).removeClass("d-none").addClass("show")}function hideLoginError(){let e=$("#loginForm .login-error");e.length&&e.addClass("d-none").removeClass("show").text("")}function trim(e,t){return e.replace(RegExp(`^${t}`,"g"),"").replace(RegExp(`${t}$`,"g"),"")}function getBasename(e){return(e=trim(e=e.split("\\").join("/"),"/")).split("/").reverse()[0]}function validateActiveTab(){let e=$("#importApplicationTabContent .tab-pane.show.active"),t=!1;"tab-pane-from-config"===e.attr("id")?t=validateFromConfig():"tab-pane-from-existing"===e.attr("id")&&(t=validateFromExisting()),$(".button-save-application-import").prop("disabled",!t)}function validateFromConfig(){let e=$('input[name="base_application_directory"]',"#tab-pane-from-config").val().trim(),t=$('input[name="application_name"]',"#tab-pane-from-config").val().trim(),a=$('input[name="application_id"]',"#tab-pane-from-config").val().trim(),n=$('input[name="file_name"]',"#tab-pane-from-config").val().trim();return e&&t&&a&&n}function validateFromExisting(){let e=$('input[name="base_application_directory"]',"#tab-pane-from-existing").val().trim(),t=$('input[name="application_name"]',"#tab-pane-from-existing").val().trim(),a=$('input[name="application_id"]',"#tab-pane-from-existing").val().trim();return e&&t&&a}let initAll=function(){let e=document.getElementById("dir-tree");$("#importApplicationTab").on("shown.bs.tab",function(e){$(e.target).attr("id"),validateActiveTab()}),$(".button-clear-import").on("click",function(e){$("#tab-pane-from-existing .import-message").html('<div class="alert alert-info">Type existing application directory to import the application.</div>'),$(this).closest("table").find('input[type="text"], input[type="hidden"]').val(""),$(this).closest("table").find(".import-message").empty()}),$("#tab-pane-from-existing .button-check-application").on("click",function(e){e.preventDefault();let t=$("#tab-pane-from-existing"),a=t.find('[name="base_application_directory"]').val();$.ajax({type:"POST",url:"lib.ajax/application-check-files.php",data:{base_application_directory:a},dataType:"json",success:function(e){e.success?(t.find(".import-message").html(`<div class="alert alert-success">${e.message}</div>`),t.find('[name="application_id"]').val(e.data.applicationId),t.find('[name="application_name"]').val(e.data.applicationName),$(".button-save-application-import")[0].disabled=!1):(t.find(".import-message").html(`<div class="alert alert-warning">${e.message}</div>`),$(".button-save-application-import")[0].disabled=!0)}})}),$('#tab-pane-from-config [name="base_application_directory"]').on("change keyup",function(e){let t=$(this).val(),a=getBasename(t);a=trim(a,"/"),a=trim(a,"-"),a=(a=trim(a,"_")).trim(),$('#tab-pane-from-config [name="application_id"]').val(a)}),$('#tab-pane-from-config [name="application_id"]').on("change keyup",function(e){let t=$(this).val(),a=$('#tab-pane-from-config [name="base_application_directory"]').val();a=trim(a,"/"),a=trim(a,"/"),a=trim(a,"\\"),a=trim(a,"-"),a=(a=trim(a,"_")).trim(),t=trim(t,"/"),t=trim(t,"/"),t=trim(t,"\\"),t=trim(t,"-"),t=(t=trim(t,"_")).trim();let n=(a=a.split("\\").join("/")).split("/");n[n.length-1]=t,a=n.join("/"),$('#tab-pane-from-config [name="base_application_directory"]').val(a)}),e.addEventListener("mouseover",t=>{let a=t.target.closest("li");a&&e.contains(a)&&a.classList.add("hovered")}),e.addEventListener("mouseout",t=>{let a=t.target.closest("li");a&&e.contains(a)&&a.classList.remove("hovered")}),$(document).on("click",".button-check-application-id",function(e){e.preventDefault();let t=$("#tab-pane-from-config"),a=t.find('[name="application_id"]').val(),n=t.find('[name="base_application_directory"]').val(),i=t.find('[name="application_name"]').val();$.ajax({type:"POST",url:"lib.ajax/application-check-id.php",data:{application_id:a,base_application_directory:n,application_name:i},dataType:"json",success:function(e){e.success?(t.find(".import-message").html(`<div class="alert alert-success">${e.message}</div>`),$(".button-save-application-import")[0].disabled=!1):(t.find(".import-message").html(`<div class="alert alert-warning">${e.message}</div>`),$(".button-save-application-import")[0].disabled=!0)},error:function(e){t.find(".import-message").html(`<div class="alert alert-warning">${e}</div>`)}})}),$("#loginForm").on("submit",function(e){e.preventDefault(),$(this);let t=new FormData(this);$.ajax({url:"lib.ajax/session-login.php",method:"POST",data:t,processData:!1,contentType:!1,headers:{"X-Requested-With":"XMLHttpRequest"},dataType:"json",success:function(e){e.loggedIn?($("#loginModal").modal("hide"),hideLoginError(),$(".session-expired-alert").remove()):showLoginError(e.message||"Invalid username or password.")},error:function(){showLoginError("Login failed due to a network or server error.")}})}),$(document).on("click",".update-magic-object",function(){updateDependency("update-magic-object",this)}),$(document).on("click",".update-magic-app",function(){updateDependency("update-magic-app",this)}),$(document).on("click",".update-classes",function(){updateDependency("update-classes",this)}),$(document).on("change",".application-path-selector",function(e){$(this)[0].checked&&$(this).closest("tr").siblings().each(function(){$(this).find(".application-path-selector")[0].checked=!1})}),$(document).on("click",".update-trash-entity",function(e){let t=$(this).closest("form").find('[name="application_id"]').val(),a=[];$(this).closest("form").find(".select-trash-table").each(function(e){$(this)[0].checked&&a.push($(this).val())}),$.ajax({type:"POST",url:"lib.ajax/entity-trash-update.php",data:{applicationId:t,userAction:"update",table:a},dataType:"html",success:function(e){$(".entity-trash-list-container").empty().append(e)}})}),$(document).on("click",".delete-trash-entity",function(e){let t=$(this).closest("form").find('[name="application_id"]').val(),a=[];$(this).closest("form").find(".select-trash-table").each(function(e){$(this)[0].checked&&a.push($(this).val())}),$.ajax({type:"POST",url:"lib.ajax/entity-trash-update.php",data:{applicationId:t,userAction:"delete",table:a},dataType:"html",success:function(e){$(".entity-trash-list-container").empty().append(e)}})}),$(document).on("hidden.bs.modal",".modal",function(){setTimeout(()=>{let e=document.querySelector(".modal.show");e||($(".modal-backdrop").remove(),$("body").removeClass("modal-open").removeAttr("style"))},40)}),$(document).on("hidden.bs.modal",".validation-modal-merged",function(){setTimeout(function(){$(".modal.show").length>0&&$("body").addClass("modal-open")},40)}),$(document).on("click","#button_create_validator_file",function(e){addValidatorForm()}),$(document).on("click","#button_update_validator_file",function(e){updateValidatorForm()}),$(document).on("click","#button_test_validator",function(e){showTestValidatorForm()}),$(document).on("click","#button_delete_validator_file",function(e){deleteValidatorFile()}),$(document).on("click",".button-load-string-format",function(e){increaseAjaxPending(),$.ajax({type:"get",dataType:"json",url:"lib.ajax/format-string.php",success:function(e){$("#input-control-string-format").val(e.stringFormat),decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}),$(document).on("click",".button-save-string-format",function(e){increaseAjaxPending(),$.ajax({type:"post",dataType:"json",url:"lib.ajax/format-string.php",data:{stringFormat:$("#input-control-string-format").val()},success:function(e){decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}),$(document).on("click",".button-load-date-format",function(e){increaseAjaxPending(),$.ajax({type:"get",dataType:"json",url:"lib.ajax/format-date.php",success:function(e){$("#input-control-date-format").val(e.dateFormat),decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}),$(document).on("click",".button-save-date-format",function(e){increaseAjaxPending(),$.ajax({type:"post",dataType:"json",url:"lib.ajax/format-date.php",data:{dateFormat:$("#input-control-date-format").val()},success:function(e){decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}),$(document).on("click",".button-load-number-format",function(e){increaseAjaxPending(),$.ajax({type:"get",dataType:"json",url:"lib.ajax/format-number.php",success:function(e){$("#input-control-decimal").val(e.decimal),$("#input-control-decimal-separator").val(e.separator),$("#input-control-thousands-separator").val(e.thousandsSeparator),decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}),$(document).on("click",".button-save-number-format",function(e){increaseAjaxPending(),$.ajax({type:"post",dataType:"json",url:"lib.ajax/format-number.php",data:{decimal:$("#input-control-decimal").val(),separator:$("#input-control-decimal-separator").val(),thousandsSeparator:$("#input-control-thousands-separator").val()},success:function(e){decreaseAjaxPending()},error:function(){decreaseAjaxPending()}})}),validatorBuilder=new ValidationBuilder(".field-validation-modal",".validation-modal",".json-output",".main-table tbody tr"),$(document).on("click","#button-load-module-features",function(e){e.preventDefault(),restoreFeatureForm()}),$(document).on("click","#button-save-module-features",function(e){e.preventDefault(),asyncAlert("Do you want to save this configuration for the current application?","Confirmation",[{caption:"Yes",fn(){saveFeatureForm()},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("click","#button-clear-module-features",function(e){e.preventDefault(),resetFeatureForm()}),$(document).on("click",".group-reference",function(e){let t=$(this).val();$(this).closest("table").attr("data-group-source",t)}),$(document).on("click","#button_create_entity_file",function(e){e.preventDefault(),$("#modal-entity-generator").modal("show"),increaseAjaxPending(),$(".modal-body .entity-generator").load("lib.ajax/entity-generator-dialog.php?entityName="+encodeURIComponent(currentEntityName)+"&tableName="+encodeURIComponent(currentTableName),function(){decreaseAjaxPending(),$('select[name="entity_generator_table_name"]').on("change",function(e){fillEntityGeneratorForm($(this))})})}),$(document).on("click",".button-add-entity-suffix",function(e){let t=$('[name="entity_generator_entity_name"]').val();t.endsWith("Min")||(t+="Min",$('[name="entity_generator_entity_name"]').val(t))}),$(document).on("click",".button-create-entity",function(e){let t=$('[name="entity_generator_entity_name"]').val(),a=$('[name="entity_generator_table_name"]').val();asyncAlert("Are you sure you want to generate the entity and replace the existing file?","Entity Generation Confirmation",[{caption:"Yes",fn(){$("#modal-entity-generator").modal("hide"),increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/entity-generator.php",data:{entityName:t,tableName:a},success:function(e){decreaseAjaxPending(),updateEntityFile(function(){let e="",a="";0==t.indexOf("App\\")||0==t.indexOf("Data\\")?(e=(e='.entity-li > [data-entity-name="'+t+'"]').replace(/\\/g,"\\\\"),a=""+t):(e='.entity-li > [data-entity-name="Data\\\\'+t+'"]',a="Data\\"+t);let n=$(e);getEntityFile([a],function(){$(".entity-container-file .entity-li").removeClass("selected-file"),n.closest("li").addClass("selected-file")})}),resetFileManager(),updateEntityQuery(!0),updateEntityRelationshipDiagram()}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("click","#button_delete_module_file",function(e){e.preventDefault(),asyncAlert(`Do you want to delete file ${currentModule}.php?`,"Confirmation",[{caption:"Yes",fn(){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/module-delete.php",dataType:"json",data:{module:currentModule},success:function(e){decreaseAjaxPending(),updateModuleFile(),resetFileManager(),e.success&&($("#button_save_module_file").attr("disabled","disabled"),$("#button_delete_module_file").attr("disabled","disabled"),cmEditorModule.getDoc().setValue(""),setTimeout(function(){cmEditorModule.refresh()},1))},error:function(e){decreaseAjaxPending()}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("click","#button_delete_entity_file",function(e){e.preventDefault(),asyncAlert(`Do you want to delete file ${currentEntity}.php?`,"Confirmation",[{caption:"Yes",fn(){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/entity-delete.php",dataType:"json",data:{entity:currentEntity},success:function(e){decreaseAjaxPending(),updateEntityFile(),resetFileManager(),updateEntityQuery(!0),updateEntityRelationshipDiagram(),removeHilightLineError(cmEditorFile),e.success&&(setEntityFile(""),$("#button_save_entity_file").attr("disabled","disabled"),$("#button_save_entity_file_as").attr("disabled","disabled"),$("#button_delete_entity_file").attr("disabled","disabled"))},error:function(e){decreaseAjaxPending()}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("change",".multiple-selection",function(e){let t=$(this).val();$(".multiple-selection").val(t)}),$(document).on("click","#vscode",function(){let e=$("#current_application option:selected").attr("data-directory");window.location="vscode://file/"+e}),$(document).on("click","#load_table",function(e){e.preventDefault(),loadTable()}),$(document).on("click","#load_column",function(e){e.preventDefault();let t=$('[name="source_table"]').val(),a=$("table.main-table tbody");""==t?$('[name="source_table"]').focus():loadColumn(t,a)}),$(document).on("change",'select[name="source_table"]',function(e){let t=$(this).val(),a=$(this).find("option:selected").attr("data-primary-key")||"";updateTableName(t+".php",t,t,t,a)}),$(document).on("change",'[name="multi_level_menu"]',function(e){e.preventDefault();let t=$(this).is(":checked"),a=$('[name="active_theme"]');a.find("option").each(function(){let e=$(this).data("multi-level-menu");$(this).prop("disabled",t?!e:e)});let n=a.find("option:enabled").first();n.length&&a.val(n.val())}),$(document).on("click",".button-save-application-config",function(e){e.preventDefault();let t=$(this).closest(".modal").find("form"),a=t.serializeArray(),n={name:t.find('[name="application_name"]').val(),architecture:t.find('[name="application_architecture"]').val(),base_application_directory:t.find('[name="application_base_directory"]').val(),base_application_url:t.find('[name="application_url_directory"]').val(),description:t.find('[name="description"]').val(),multi_level_menu:t.find('[name="multi_level_menu"]')[0].checked,active_theme:t.find('[name="active_theme"]').val(),database:{},sessions:{},account_security:{},entity_info:{},module_location:[]};for(let i in t.find(".path-manager tbody tr").each(function(e){let t=$(this).find('[name^="name"]'),a=$(this).find('[name^="path"]'),i=$(this).find('[name^="checked"]');n.module_location.push({name:t.val(),path:a.val(),active:i[0].checked})}),a){let l=a[i].name;-1!==l.indexOf("database_")&&(n.database[l.substring(9)]=a[i].value),-1!==l.indexOf("sessions_")&&(n.sessions[l.substring(9)]=a[i].value),-1!==l.indexOf("account_security_")&&(n.account_security[l.substring(17)]=a[i].value),-1!==l.indexOf("entity_info_")&&(n.entity_info[l.substring(12)]=a[i].value)}n.application_id=t.find('[name="application_id"]').val(),updateCurrentApplivation(n),$("#modal-application-setting").modal("hide")}),$(document).on("click","#generate_script",function(e){e.preventDefault(),asyncAlert("Do you want to generate the module and entities and replace the existing files?","Confirmation",[{caption:"Yes",fn(){generateScript($(".main-table tbody"))},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("click","#switch_application",function(e){e.preventDefault(),switchApplication($("#current_application").val())}),$(document).on("change",".input-field-filter",function(e){let t=$(this)[0].checked,a=$(this).attr("value");t?($(this).closest("tr").find('.input-field-filter[value!="'+a+'"]')[0].checked=!1,prepareReferenceFilter(a,$(this))):$(this).closest("tr").find(".reference_button_filter").css("display","none")}),$(document).on("change",".input-element-type",function(e){let t=$(this).val(),a=$(this).attr("name");$(this).closest("tr").find('input[type="radio"][name="'+a+'"]').each(function(){this.checked=!1,$(this).removeAttr("checked"),$(this).attr("data-checked","false")}),$(this)[0].checked=!0,$(this).attr("data-checked","true"),$(this).attr("checked","checked"),prepareReferenceData(t,$(this))}),$(document).on("click",".reference_button_data",function(e){e.preventDefault();let t=$("#modal-create-reference-data");t.find(".modal-title").text("Create Data Reference"),t.attr("data-reference-type","data");let a=$(this).closest("td"),n=a.closest("tr").attr("data-field-name"),i=$(this).siblings("input").attr("name");t.attr("data-input-name",i),t.attr("data-field-name",n),t.find(".modal-body").empty(),t.find(".modal-body").append(getReferenceResource());let l=$('[name="'+i+'"]').val();if(l.length<60&&loadReference(n,i,function(e){null!=e&&(deserializeForm(e),"true"!=a.attr("data-valid")?(validateEntityName(),validateReference()):t.find(".input-with-checker").attr("data-valid","true"))}),l.length>20){let o=parseJsonData(l);"object"!=typeof o&&(o={}),deserializeForm(o),"true"!=a.attr("data-valid")?(validateEntityName(),validateReference()):t.find(".input-with-checker").attr("data-valid","true")}t.attr("data-type","reference"),t.modal("show")}),$(document).on("click",".reference_button_filter",function(e){e.preventDefault();let t=$("#modal-create-reference-data");t.find(".modal-title").text("Create Filter Reference"),t.attr("data-reference-type","filter");let a=$(this).closest("td"),n=a.closest("tr").attr("data-field-name"),i=$(this).siblings("input").attr("name");t.attr("data-input-name",i),t.attr("data-field-name",n),t.find(".modal-body").empty(),t.find(".modal-body").append(getReferenceResource());let l=$('[name="'+i+'"]').val().trim();if(l.length<60&&loadReference(n,i,function(e){null!=e&&(deserializeForm(e),"true"!=a.attr("data-valid")?(validateEntityName(),validateReference()):t.find(".input-with-checker").attr("data-valid","true"))}),l.length>20){let o=parseJsonData(l);"object"!=typeof o&&(o={}),deserializeForm(o),"true"!=a.attr("data-valid")?(validateEntityName(),validateReference()):t.find(".input-with-checker").attr("data-valid","true")}t.attr("data-type","filter"),t.modal("show")}),$(document).on("click","#apply_reference",function(e){let t=$("#modal-create-reference-data"),a=t.attr("data-input-name"),n=JSON.stringify(serializeForm());$('[name="'+a+'"]').val(n);let i="filter"==t.attr("data-type")&&t.find('.entity-section .input-with-checker[data-valid="true"]').length>=4||"reference"==t.attr("data-type")&&t.find('.entity-section .input-with-checker[data-valid="true"]').length>=6;$('[name="'+a+'"]').closest("td").attr("data-valid",i?"true":"false"),t.modal("hide")}),$(document).on("click","#save_to_cache",function(e){let t=$("#modal-create-reference-data").attr("data-field-name"),a=$("#modal-create-reference-data").attr("data-input-name"),n=JSON.stringify(serializeForm());saveReference(t,a,n)}),$(document).on("click","#load_from_cache",function(e){let t=$("#modal-create-reference-data").attr("data-field-name"),a=$("#modal-create-reference-data").attr("data-input-name");loadReference(t,a,function(e){null!=e&&deserializeForm(e)})}),$(document).on("click",".reference_type",function(e){let t=$(this).val();selectReferenceType({type:t})}),$(document).on("click",".btn-add-column",function(e){let t=$(this).closest("table");addColumn(t)}),$(document).on("click",".btn-remove-last-column",function(e){let t=$(this).closest("table");removeLastColumn(t)}),$(document).on("click",".btn-clear-group",function(e){let t=$(this).closest("table");clearGroup(t)}),$(document).on("click",".btn-add-row",function(e){let t=$(this).closest("table");addRow(t)}),$(document).on("click",".btn-remove-row",function(e){let t=$(this).closest("tbody").find("tr").length;if(t>1){let a=$(this).closest("tr");asyncAlert("Do you want to remove this row?","Deletion Confirmation",[{caption:"Yes",fn(){a.remove()},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}else 1==t&&"true"==$(this).closest("table").attr("data-empty-on-remove")&&asyncAlert("Do you want to clear this row?","Confirmation",[{caption:"Yes",fn:()=>{$(this).closest("tr").find(":input").each(function(e){$(this).is(":checkbox, :radio")?$(this).prop("checked",!1):$(this).val("")})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("change",'.map-section input[type="checkbox"]',function(e){$(this)[0].checked&&$(this).closest("tr").siblings().each(function(){$(this).find('input[type="checkbox"]')[0].checked=!1})}),$(document).on("change",".entity-container-query .entity-checkbox",function(e){let t=getEntitySelection(),a=$(".entity-merge")[0].checked,n=$(".entity-create-new")[0].checked;getEntityQuery(t,a,n)}),$(document).on("change",".entity-merge",function(e){let t=getEntitySelection(),a=$(".entity-merge")[0].checked,n=$(".entity-create-new")[0].checked;getEntityQuery(t,a,n)}),$(document).on("change","#backend_only",function(e){$(this)[0].checked?($("#ajax_support")[0].checked=!1,$("#ajax_support")[0].disabled=!0):$("#ajax_support")[0].disabled=!1}),$(document).on("change",".entity-create-new",function(e){let t=getEntitySelection(),a=$(".entity-merge")[0].checked,n=$(".entity-create-new")[0].checked;getEntityQuery(t,a,n)}),$(document).on("change",".entity-check-controll",function(e){let t=$(this)[0].checked;$(".entity-checkbox-query").each(function(){$(this)[0].checked=t});let a=getEntitySelection(),n=$(".entity-merge")[0].checked,i=$(".entity-create-new")[0].checked;getEntityQuery(a,n,i)}),$(document).on("click","#create_new_app",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=t.find('[name="application_name"]').val().trim(),n=t.find('[name="application_architecture"]').val().trim(),i=t.find('[name="application_description"]').val().trim(),l=t.find('[name="application_id"]').val().trim(),o=t.find('[name="application_directory"]').val().trim(),r=t.find('[name="application_url"]').val().trim(),d=t.find('[name="application_namespace"]').val().trim(),c=t.find('[name="application_workspace_id"]').val().trim(),s=t.find('[name="application_author"]').val().trim(),p=t.find('[name="magic_app_version"]').val(),u=0===t.find('[name="installation_method"]').val().toLowerCase().indexOf("online"),m=[];$("#modal-create-application table.path-manager tbody tr").each(function(){let e=$(this),t=e.find('td:nth-child(1) input[type="text"]').val(),a=e.find('td:nth-child(2) input[type="text"]').val(),n=e.find('td:nth-child(3) input[type="checkbox"]')[0].checked;m.push({name:t,path:a,active:n})}),""!=a&&""!=l&&""!=o&&""!=s&&(showWaitingScreen(),increaseAjaxPending(),setCheckingStatus(l,new Date().getTime()),$.ajax({method:"POST",url:"lib.ajax/application-create.php",dataType:"html",data:{id:l,application_name:a,application_architecture:n,application_description:i,application_directory:o,application_url:r,application_namespace:d,workspace_id:c,author:s,paths:m,magic_app_version:p,composer_online:u},success:function(e){decreaseAjaxPending()},error:function(e,t){decreaseAjaxPending()}})),$(t).modal("hide")}),$("#modal-workspace").on("show.bs.modal",function(e){resetWorkspaceSearch()}),$("#modal-update-path").on("show.bs.modal",function(e){increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/application-path.php",data:{userAction:"get"},success:function(e){for(decreaseAjaxPending();$("#modal-update-path table.path-manager > tbody > tr").length>1;)$("#modal-update-path table.path-manager > tbody > tr:last").remove();for(let t in e){if(t>0){let a=$("#modal-update-path table.path-manager > tbody > tr:first").clone();$("#modal-update-path table.path-manager > tbody").append(a)}let n=$("#modal-update-path table.path-manager > tbody > tr:nth-child("+(parseInt(t)+1)+")");n.find('input[type="text"].location-path').val(e[t].path),n.find('input[type="text"].location-name').val(e[t].name),n.find('input[type="checkbox"]')[0].checked=e[t].active}fixPathForm()}})}),$(document).on("click","#update_module_path",function(e){e.preventDefault();let t=[];$("#modal-update-path table.path-manager tbody tr").each(function(){let e=$(this),a=e.find('td:nth-child(1) input[type="text"]').val(),n=e.find('td:nth-child(2) input[type="text"]').val(),i=e.find('td:nth-child(3) input[type="checkbox"]')[0].checked;t.push({name:a,path:n,active:i})});let a=$("#current_module_location");t.length>0&&(increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/application-path.php",data:{userAction:"update",paths:t},success:function(e){for(let t in decreaseAjaxPending(),a.empty(),e)a[0].options[a[0].options.length]=new Option(e[t].name+" - "+e[t].path,e[t].path),e[t].active&&a.val(e[t].path);for(;$("#modal-update-path table.path-manager tbody tr").length>1;)$("#modal-update-path table.path-manager tbody tr:last-child").remove();$('#modal-update-path table.path-manager tbody tr input[type="text"]').val("")}})),$("#modal-update-path").modal("hide")}),$(document).on("click","#update_current_location",function(e){e.preventDefault();let t=$("#current_module_location");increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/application-path.php",data:{userAction:"default",selected_path:t.val()},success:function(e){for(let a in decreaseAjaxPending(),t.empty(),e)t[0].options[t[0].options.length]=new Option(e[a].name+" - "+e[a].path,e[a].path),e[a].active&&t.val(e[a].path)}})}),$(document).on("click",".entity-container-file .entity-li a",function(e){e.preventDefault();let t=$(this).attr("data-entity-name"),a=$(this).attr("data-table-name"),n=parseInt($(this).attr("data-error-line-number"));currentEntityName=t,currentTableName=a;let i=$(this);getEntityFile([t],function(){$(".entity-container-file .entity-li").removeClass("selected-file"),i.closest("li").addClass("selected-file")},n)}),$(document).on("click",".validator-container-file .validator-li a",function(e){e.preventDefault();let t=$(this).attr("data-validator-name"),a=parseInt($(this).attr("data-error-line-number"));currentValidatorName=t;let n=$(this);getValidatorFile(t,function(){$(".validator-container-file .validator-li").removeClass("selected-file"),n.closest("li").addClass("selected-file")},a)}),$(document).on("click",".module-list-file .file-li a",function(e){e.preventDefault();let t=$(this).attr("data-file-name"),a=$(this);getModuleFile(t,function(){$(".file-li").removeClass("selected-file"),a.parent().addClass("selected-file")})}),$(document).on("click",".entity-container-query .entity-li a",function(e){e.preventDefault();let t=$(this).attr("data-entity-name"),a=$(".entity-create-new")[0].checked;getEntityQuery([t],!1,a)}),$(document).on("click","#button_save_module_file",function(e){e.preventDefault(),saveModule()}),$(document).on("click","#button_save_entity_file",function(e){e.preventDefault(),saveEntity()}),$(document).on("click","#button_save_entity_file_as",function(e){e.preventDefault(),saveEntityAs()}),$(document).on("click","#button_save_validator_file",function(e){e.preventDefault(),saveValidator()}),$(document).on("click","#button_save_validator_file_as",function(e){e.preventDefault(),saveValidatorAs()}),$(document).on("click","#button_save_entity_query",function(e){e.preventDefault(),saveQuery()}),$("tbody.data-table-manual-sort").each(function(){let e=$(this)[0];Sortable.create(e,{animation:150,scroll:!0,handle:".data-sort-handler",onStart:function(e){if(e.item){e.item.querySelectorAll('input[type="checkbox"]').forEach(function(e){let t=e.checked;e.setAttribute("data-checked",t?"true":"false"),t?e.setAttribute("checked","checked"):e.removeAttribute("checked")});let t=e.item.querySelectorAll('input[type="radio"]');[...new Set([...t].map(e=>e.name))].forEach(function(t){e.item.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(function(e){let t=e.checked||e.getAttribute("checked");e.setAttribute("data-checked",t?"true":"false"),t?e.setAttribute("checked","checked"):e.removeAttribute("checked")})})}},onEnd:function(e){let t=e.item.querySelectorAll('input[type="checkbox"]'),a=e.item.querySelectorAll('input[type="radio"]');setTimeout(function(){t.forEach(function(e){let t="true"===e.getAttribute("data-checked");e.checked=t,t?e.setAttribute("checked","checked"):e.removeAttribute("checked"),e.removeAttribute("data-checked")});[...new Set([...a].map(e=>e.name))].forEach(function(t){e.item.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(function(e){let t="true"===e.getAttribute("data-checked");e.checked=t,t?e.setAttribute("checked","checked"):e.removeAttribute("checked"),e.removeAttribute("data-checked")})})},155)}})}),$(document).on("click",".add_suffix",function(e){let t=$(".rd-entity-name").val();t.endsWith("Min")||(t+="Min",$(".rd-entity-name").val(t))}),$(document).on("click",".generate_entity",function(e){let t=$(".rd-entity-name").val(),a=$(".rd-table-name").val();asyncAlert("Are you sure you want to generate the entity and replace the existing file?","Entity Generation Confirmation",[{caption:"Yes",fn(){increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/entity-generator.php",data:{entityName:t,tableName:a},success:function(e){decreaseAjaxPending(),updateEntityFile(),resetFileManager(),updateEntityQuery(!0),updateEntityRelationshipDiagram()}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("change",".rd-map-key",function(e){onChangeMapKey($(this))}),$(document).on("keyup",".rd-map-key",function(e){onChangeMapKey($(this))}),$(document).on("change","#export_to_excel",function(e){$(this)[0].checked&&($("#export_to_csv")[0].checked=!1,$("#export_use_temporary")[0].disabled=!0,$("#export_use_temporary")[0].checked=!1)}),$(document).on("change","#export_to_csv",function(e){$(this)[0].checked?($("#export_to_excel")[0].checked=!1,$("#export_use_temporary")[0].disabled=!1):($("#export_use_temporary")[0].disabled=!0,$("#export_use_temporary")[0].checked=!1)}),$(document).on("change","#with_approval",function(e){$(this)[0].checked?($("#approval_by_other_user")[0].disabled=!1,$("#approval_type1")[0].disabled=!1,$("#approval_type2")[0].disabled=!1,$("#approval_position1")[0].disabled=!1,$("#approval_position2")[0].disabled=!1,$("#approval_bulk")[0].disabled=!1):($("#approval_by_other_user")[0].checked=!1,$("#approval_by_other_user")[0].disabled=!0,$("#approval_type1")[0].disabled=!0,$("#approval_type2")[0].disabled=!0,$("#approval_position1")[0].disabled=!0,$("#approval_position2")[0].disabled=!0,$("#approval_bulk")[0].disabled=!0)}),$(document).on("change",".entity-container-relationship .entity-checkbox",function(e){loadDiagramMultiple()}),$(document).on("click",".reload-diagram",function(e){loadDiagramMultiple()}),$(document).on("click",".entity-container-relationship .entity-li a",function(e){e.preventDefault();let t=[];(t=addDiagramOption(t)).push("entity[]="+$(this).attr("data-entity-name")),t.push("rnd="+new Date().getTime());let a=$("<img />");a.attr("src","lib.ajax/entity-relationship-diagram.php?"+t.join("&")),$(".erd-image").empty().append(a);let n="lib.ajax/entity-relationship-diagram-map.php?"+t.join("&");$('[name="erd-map"]').load(n,function(e){a.attr("usemap","#erd-map")})}),$(document).on("click",".btn-move-up",function(e){let t=$(this).closest("tr");t.prev().length&&t.insertBefore(t.prev())}),$(document).on("click",".btn-move-down",function(e){let t=$(this).closest("tr");t.next().length&&t.insertAfter(t.next())}),$(document).on("click","table.path-manager .path-remover",function(e){if($(this).closest("tbody").find("tr").length>1){let t=$(this).closest("tr");asyncAlert("Deleting this path will not remove the directory or its files. <br>Do you want to delete this path?","Deletion Confirmation",[{caption:"Yes",fn(){t.remove()},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}fixPathForm()}),$(document).on("click","table.path-manager .add-path",function(e){let t=$(this).closest("table").find("tbody tr:first").clone();t.find('input[type="text"]').val(""),t.find('input[type="checkbox"]').removeAttr("checked"),$(this).closest("table").find("tbody").append(t),fixPathForm()}),$(document).on("change",'[name="application_namespace"]',function(e){let t=$(this),a=t.val();"MagicObject"==a||"MagicApp"==a?t.addClass("invalid-input"):t.removeClass("invalid-input")}),$(document).on("click",".create-new-application",function(e){resetApplicationSearch();let t=$("#modal-create-application");t.find(".alert").length>0&&t.find(".alert").remove();let a=t.find("#create_new_app");a[0].disabled=!0,t.find('[name="application_name"]').val(""),t.find('[name="application_id"]').val(""),t.find('[name="application_directory"]').val(""),t.find('[name="application_workspace_id"]').val(""),t.find('[name="application_namespace"]').val(""),t.find('[name="application_author"]').val(""),t.find('[name="magic_app_version"]').empty(),t.find('[name="installation_method"]').val(""),$("#modal-create-application .modal-body :input").each(function(){$(this)[0].disabled=!0}),increaseAjaxPending(),resetCheckWriretableDirectory(t.find('[name="application_directory"]')),$.ajax({type:"GET",url:"lib.ajax/application-new.php",success:function(e){if(decreaseAjaxPending(),0==e.application_workspace.length){let n=$("<div />");n.addClass("alert alert-warning"),n.html("Please select a workspace before creating a new application."),t.find("form").prepend(n),a[0].disabled=!0}else t.find('[name="application_name"]').val(e.application_name),t.find('[name="application_id"]').val(e.application_id),t.find('[name="application_architecture"]').val(e.application_architecture),t.find('[name="application_directory"]').val(e.application_directory),t.find('[name="application_url"]').val(e.application_url),t.find('[name="composer_online"]').val(e.composer_online?1:0),t.find('[name="application_namespace"]').val(e.application_namespace),t.find('[name="application_workspace_id"]').empty(),t.find('[name="installation_method"]').empty(),t.find('[name="application_author"]').val(e.application_author),t.find('[name="application_description"]').val(e.application_description),updateNewApplicationForm(e),checkWriretableDirectory(t.find('[name="application_directory"]')),a[0].disabled=!1,$("#modal-create-application .modal-body :input").each(function(){$(this)[0].disabled=!1}),t.find('[name="application_name"]')[0].select()}})}),$(document).on("click",".container-translate-entity .entity-list .entity-li a",function(e){e.preventDefault(),e.stopPropagation();let t=$(this);currentEntity2Translated=$(this).attr("data-entity-name"),translateEntity(function(){$(".container-translate-entity .entity-list .entity-li").removeClass("selected-file"),t.closest("li").addClass("selected-file")})}),$(document).on("click","#button-save-entity-translation",function(e){let t=transEd2.getDoc().getValue(),a=$(".entity-name").val(),n=$(".entity-property-name").val(),i=$(".target-language").val();increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/entity-translate.php",dataType:"json",data:{userAction:"set",entityName:a,translated:t,propertyNames:n,targetLanguage:i},success:function(e){decreaseAjaxPending(),resetFileManager()},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click","#button-save-module-translation",function(e){let t=transEd4.getDoc().getValue(),a=$(".module-property-name").val(),n=$(".target-language").val();increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/module-translate.php",dataType:"json",data:{userAction:"set",translated:t,propertyNames:a,targetLanguage:n},success:function(e){decreaseAjaxPending(),resetFileManager()},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click","#button-save-app-translation",function(e){let t=transEd6.getDoc().getValue(),a=$(".app-property-name").val(),n=$(".target-language").val(),i=$("#app_translation_type").val(),l="";"menu"==i?l="lib.ajax/menu-translate.php":"menu-group"==i?l="lib.ajax/menu-group-translate.php":"validation"==i&&(l="lib.ajax/validation-translate.php"),""!=l&&(increaseAjaxPending(),$.ajax({method:"POST",url:l,dataType:"json",data:{userAction:"set",translated:t,propertyNames:a,targetLanguage:n},success:function(e){decreaseAjaxPending()},error:function(e,t,a){decreaseAjaxPending()}}))}),$(document).on("change",".target-language-entity, .target-language-module",function(e){let t=$(this).val(),a=$(this).attr("data-translate-for");$(".target-language").val(t),reloadTranslate(a)}),$(document).on("change",".target-language-app",function(e){let t=$(this).val();$(".target-language").val(t),loadAppTranslation()}),$(document).on("click",".reload-app-translation",function(e){loadAppTranslation()}),$(document).on("change",".filter-translate",function(e){let t=$(this).val(),a=$(this).attr("data-translate-for");$(".filter-translate").val(t),reloadTranslate(a)}),$(document).on("click",".reload-entity-translation",function(e){let t=$(this).parent().find(".filter-translate").val(),a=$(this).parent().find(".filter-translate").attr("data-translate-for");$(".filter-translate").val(t),reloadTranslate(a)}),$(document).on("change",".select-module",function(e){let t=$(this)[0].checked;$(this).closest(".module-group").find("ul li").each(function(e){$(this).find('input[type="checkbox"]')[0].checked=t}),translateModule()}),$(document).on("change",".module-for-translate",function(e){translateModule()}),$(document).on("click","table.language-manager .add-language",function(e){let t=$(this).closest("table").find("tbody tr:first").clone();t.find('input[type="text"]').val(""),t.find('input[type="checkbox"]').removeAttr("checked"),$(this).closest("table").find("tbody").append(t),fixLanguageForm()}),$(document).on("click",".load-menu-translation, .load-validation-translation, .load-menu-group-translation",function(){let e=$(this).hasClass("load-menu-translation"),t=$(this).hasClass("load-validation-translation"),a=$(this).hasClass("load-menu-group-translation");$(".load-menu-translation").toggleClass("btn-primary",e).toggleClass("btn-secondary",!e),$(".load-validation-translation").toggleClass("btn-primary",t).toggleClass("btn-secondary",!t),$(".load-menu-group-translation").toggleClass("btn-primary",a).toggleClass("btn-secondary",!a),e?loadMenuTranslation():t?loadValidationTranslation():a&&loadMenuGroupTranslation()}),$(document).on("click","table.language-manager .language-remover",function(e){if($(this).closest("tbody").find("tr").length>1){let t=$(this).closest("tr");asyncAlert("Deleting this language will not remove the directory or its files. <br>Do you want to delete this language?","Deletion Confirmation",[{caption:"Yes",fn(){t.remove()},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}fixLanguageForm()}),$("#modal-update-language").on("show.bs.modal",function(e){increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/application-language.php",data:{userAction:"get"},success:function(e){for(decreaseAjaxPending();$("#modal-update-language table.language-manager > tbody > tr").length>1;)$("#modal-update-language table.language-manager > tbody > tr:last").remove();for(let t=0;t<e.length;t++){if(t>0){let a=$("#modal-update-language table.language-manager > tbody > tr:first").clone();$("#modal-update-language table.language-manager > tbody").append(a)}let n=$("#modal-update-language table.language-manager > tbody > tr:nth-child("+(t+1)+")");n.length&&(n.find('input[type="text"].language-name').val(e[t].name),n.find('input[type="text"].language-code').val(e[t].code),n.find('input[type="checkbox"]')[0].checked=e[t].active)}fixLanguageForm()}})}),$(document).on("click","#update-application-language",function(e){e.preventDefault();let t=[];$("#modal-update-language table.language-manager tbody tr").each(function(){let e=$(this),a=e.find('td:nth-child(1) input[type="text"]').val(),n=e.find('td:nth-child(2) input[type="text"]').val(),i=e.find('td:nth-child(3) input[type="checkbox"]')[0].checked;t.push({name:a,code:n,active:i})});let a=$(".target-language");t.length>0&&(increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/application-language.php",data:{userAction:"update",languages:t},success:function(e){for(let t in decreaseAjaxPending(),a.empty(),e)for(let n=0;n<a.length;n++)a[n].options[a[n].options.length]=new Option(e[t].name+" - "+e[t].code,e[t].code),e[t].active&&a.val(e[t].code);for(;$("#modal-update-language table.language-manager tbody tr").length>1;)$("#modal-update-language table.language-manager tbody tr:last-child").remove();$('#modal-update-language table.language-manager tbody tr input[type="text"]').val("")},error:function(e,t,a){decreaseAjaxPending()}})),$("#modal-update-language").modal("hide")}),$(document).on("click",".button-execute-query",function(e){e.preventDefault();let t=$(this).closest(".modal");asyncAlert("Do you want to execute the queries on the current database?","Query Execution Confirmation",[{caption:"Yes",fn(){let e=cmEditorSQLExecute.getDoc().getValue();$(".button-execute-query")[0].disabled=!0,increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/query-execute.php",data:{userAction:"execute",query:e},success:function(e){decreaseAjaxPending();let a=getEntitySelection(),n=$(".entity-merge")[0].checked,i=$(".entity-create-new")[0].checked;getEntityQuery(a,n,i),t.modal("hide"),loadTable()},error:function(e,t,a){decreaseAjaxPending()}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}),$(document).on("click",".default-language",function(e){e.preventDefault();let t=$(".target-language");increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/application-language.php",data:{userAction:"default",selected_language:t.val()},success:function(e){for(let a in decreaseAjaxPending(),t.empty(),e)for(let n=0;n<t.length;n++)t[n].options[t[n].options.length]=new Option(e[a].name+" - "+e[a].code,e[a].code),e[a].active&&t.val(e[a].code)},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click","area",function(e){e.preventDefault();let t=$(this).attr("data-type"),a={},n="",i="";if("area-relation"==t){i="lib.ajax/entity-relationship.php",n="Entity Relationship";let l=$(this).attr("data-namespace"),o=$(this).attr("data-entity"),r=$(this).attr("data-table-name"),d=$(this).attr("data-column-name"),c=$(this).attr("data-reference-namespace"),s=$(this).attr("data-reference-entity"),p=$(this).attr("data-reference-table-name"),u=$(this).attr("data-reference-column-name");a={dataType:t,namespaceName:l,entityName:o,tableName:r,columnName:d,referenceNamespaceName:c,referenceEntityName:s,referenceTableName:p,referenceColumnName:u}}else{i="lib.ajax/entity-detail.php",n="Entity Detail";let m=$(this).attr("data-namespace"),f=$(this).attr("data-entity"),h=$(this).attr("data-table-name");a={dataType:t,namespaceName:m,entityName:f,tableName:h}}$(".entity-detail").empty(),$(".entity-detail").append('<div style="text-align: center;"><span class="animation-wave"><span></span></span></div>'),$("#modal-entity-detail .modal-title").html(n),$("#modal-entity-detail").modal("show"),increaseAjaxPending(),$.ajax({type:"GET",dataType:"html",url:i,data:a,success:function(e){decreaseAjaxPending(),$(".entity-detail").empty(),$(".entity-detail").append(e)},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click",".button-application-setting",function(e){e.preventDefault();let t=$("#modal-application-setting .button-save-application-config");t[0].disabled=!0;let a=$(this).closest(".application-item").attr("data-application-id");$("#modal-application-setting .application-setting").empty(),$("#modal-application-setting").modal("show"),increaseAjaxPending(),resetCheckWriretableDirectory($('#modal-application-setting [name="application_base_directory"]')),resetCheckWriretableDirectory($('#modal-application-setting [name="database_database_file_path"]')),$.ajax({type:"GET",url:"lib.ajax/application-setting.php",data:{applicationId:a},dataType:"html",success:function(e){decreaseAjaxPending(),$("#modal-application-setting .application-setting").empty().append(e),checkWriretableDirectory($('#modal-application-setting [name="application_base_directory"]')),checkWriretableDirectory($('#modal-application-setting [name="database_database_file_path"]')),setTimeout(function(){$("#modal-application-setting .application-setting").find('[name="database_password"]').val("")},2e3),t[0].disabled=!1},error:function(e,a,n){decreaseAjaxPending(),t[0].disabled=!1}})}),$(document).on("click",".button-application-option",function(e){e.preventDefault();let t=$("#modal-application-option .button-save-application-option");t[0].disabled=!0,t[0].style.display="none";let a=$(this).closest(".application-item").attr("data-application-id");$("#modal-application-option .application-option").empty(),$("#modal-application-option").modal("show"),increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/application-option.php",data:{applicationId:a},dataType:"html",success:function(e){decreaseAjaxPending(),$("#modal-application-option").attr("data-application-id",a),$("#modal-application-option .application-option").empty().append(e);let n=$("#modal-application-option .application-option").find(".application-valid").attr("data-application-valid");$("#modal-application-option").attr("data-application-valid",n),"false"==n?t[0].style.display="none":(t[0].disabled=!1,t[0].style.display="")},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click",".button-import-application",function(e){e.preventDefault(),$("#tab-pane-from-config .import-message").html('<div class="alert alert-info">Select file to import the application.</div>'),$("#tab-pane-from-existing .import-message").html('<div class="alert alert-info">Type existing application directory to import the application.</div>'),$('#tab-pane-from-config [name="base_application_directory"]').val(""),$('#tab-pane-from-config [name="application_name"]').val(""),$('#tab-pane-from-config [name="application_id"]').val(""),$('#tab-pane-from-config [name="file_name"]').val("");$("#modal-application-import .button-save-application-import")[0].disabled=!0,$("#modal-application-import").modal("show")}),$(document).on("click",".button-select-file-import",function(e){$("#import-application-file").click()}),$(document).on("click",".button-clear-file-import",function(e){$("#import-application-file").val(""),$("#tab-pane-from-config .import-message").html('<div class="alert alert-info">Select file to import the application.</div>'),$('#tab-pane-from-config [name="base_application_directory"]').val(""),$('#tab-pane-from-config [name="application_name"]').val(""),$('#tab-pane-from-config [name="application_id"]').val(""),$('#tab-pane-from-config [name="file_name"]').val("")}),$(document).on("change","#import-application-file",function(){this.files.length>0&&handleApplicationFileUpload(this.files[0],"preview")}),$(document).on("click",".button-save-application-import",function(){let e=document.getElementById("import-application-file"),t=$('#modal-application-import [name="application_id"]').val(),a=$('#modal-application-import [name="application_name"]').val(),n=$('#modal-application-import [name="base_application_directory"]').val();e.files.length>0&&handleApplicationFileUpload(e.files[0],"import",t,a,n)}),$(document).on("click",".button-save-application-option",function(e){e.preventDefault();let t=$(this).closest(".modal").find("form");$.ajax({type:"POST",url:"lib.ajax/application-option.php",data:{userAction:"save",developmentMode:t.find('[name="development_mode"]:checked').val(),bypassRole:t.find('[name="bypass_role"]:checked').val(),accessLocalhostOnly:t.find('[name="access_localhost_only"]:checked').val(),applicationId:t.closest(".modal").attr("data-application-id")},success:function(e){t.closest(".modal").modal("hide")}})}),$(document).on("click","#import-menu",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=$(this).closest(".modal").attr("data-application-id");$.ajax({type:"POST",url:"lib.ajax/application-menu-import.php",data:{applicationId:a},dataType:"html",success:function(e){t.find(".menu-container").empty().append(e)}})}),$(document).on("click","#create-user",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=$(this).closest(".modal").attr("data-application-id");increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-user.php",data:{applicationId:a},dataType:"html",success:function(e){decreaseAjaxPending(),t.find(".user-container").empty().append(e)},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click","#reset-user-password",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=$(this).closest("form"),n=$(this).closest(".modal").attr("data-application-id"),i=[];a.find(".admin_id:checked").each(function(e){let t=$(this).val();i.push(t)}),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-user.php",data:{userAction:"reset-user-password",applicationId:n,adminId:i},success:function(e){decreaseAjaxPending(),t.find(".user-container").empty().append(e)},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click","#set-user-role",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=$(this).closest("form"),n=$(this).closest(".modal").attr("data-application-id"),i=[];a.find(".admin_id:checked").each(function(e){let t=$(this).val();i.push(t)}),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-user.php",data:{userAction:"set-user-role",applicationId:n,adminId:i},success:function(e){decreaseAjaxPending(),t.find(".user-container").empty().append(e)},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click","#delete-user",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=$(this).closest("form"),n=$(this).closest(".modal").attr("data-application-id"),i=[];a.find(".admin_id:checked").each(function(e){let t=$(this).val();i.push(t)}),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-user.php",data:{userAction:"delete",applicationId:n,adminId:i},success:function(e){decreaseAjaxPending(),t.find(".user-container").empty().append(e)},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click",".button-application-database",function(e){e.preventDefault();let t=$(this).closest(".application-item").attr("data-application-id");$("#modal-database-explorer .database-explorer").html('<iframe src="database-explorer/?applicationId='+t+'"></iframe>'),$("#modal-database-explorer").modal("show")}),$(document).on("click","#button_explore_database",function(e){e.preventDefault(),$("#modal-database-explorer .database-explorer").html('<iframe src="database-explorer/"></iframe>'),$("#modal-database-explorer").modal("show")}),$(document).on("click",".button-application-menu",function(e){e.preventDefault();$("#modal-application-menu .button-save-menu")[0].disabled=!0;let t=$(this).closest(".application-item").attr("data-application-id");showApplicationMenuDialog(t)}),$(document).on("click",".button-manage-application-menu",function(e){e.preventDefault();$("#modal-application-menu .button-save-menu")[0].disabled=!0;let t=$('meta[name="application-id"]').attr("content");showApplicationMenuDialog(t)}),$(document).on("click","#modal-application-menu .button-save-menu",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=t.attr("data-application-id"),n=JSON.stringify(serializeMenu());increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-menu-update.php",data:{applicationId:a,data:n},success:function(e){decreaseAjaxPending(),t.modal("hide"),loadMenu()},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click","#modal-application-menu .button-add-menu",function(e){e.preventDefault(),$("#new_menu").val("");$("#modal-application-menu-add").modal("show"),setTimeout(function(){$("#new_menu").val(""),$("#new_menu").focus()},600)}),$(document).on("click","#modal-application-menu-add .button-apply-new-menu",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=!1,n=$("#new_menu").val(),i=serializeMenu();for(let l in i)i[l].title.toLowerCase()==n.toLowerCase()&&(a=!0);if(a)$("#new_menu").select();else{let o="";o+='<li class="sortable-menu-item">\r\n',o+='<span class="sortable-icon icon-move-up" onclick="moveUp(this)"></span>\r\n',o+='<span class="sortable-icon icon-move-down" onclick="moveDown(this)"></span>\r\n',o+='<span class="sortable-icon icon-edit" onclick="editMenu(this)"></span>\r\n',o+='<a class="app-menu app-menu-text" href="#">'+n+"</a>\r\n",o+='<span class="sortable-toggle-icon"></span>\r\n',o+='<ul class="sortable-submenu">\r\n',o+="</ul>\r\n";let r=$(o+="</li>\r\n");$(".sortable-menu").append(r);r.find(".sortable-toggle-icon")[0].addEventListener("click",function(){this.parentNode.classList.toggle("expanded")}),document.querySelectorAll(".sortable-submenu-item").forEach(e=>{e.setAttribute("draggable",!0),e.addEventListener("dragstart",dragStart),e.addEventListener("dragover",dragOver),e.addEventListener("drop",dropToSubmenu)}),r[0].addEventListener("dragover",dragOver),r[0].addEventListener("drop",dropToMenu),t.modal("hide")}}),$(document).on("click",".button-workspace-scan",function(e){e.preventDefault();let t=$(this).closest(".workspace-item").attr("data-workspace-id");resetWorkspaceSearch(),increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/workspace-scan.php",data:{workspaceId:t},success:function(e){decreaseAjaxPending(),loadAllResource()}})}),$(document).on("click",".button-workspace-default",function(e){e.preventDefault();let t=$(this).closest(".workspace-item").attr("data-workspace-id")||"";resetWorkspaceSearch(),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/workspace-default.php",data:{workspaceId:t},success:function(e){decreaseAjaxPending(),onSetDefaultWorkspace(),$('meta[name="workspace-id"]').attr("content",t),window.localStorage.setItem(getLocalStorageKey("workspace-id"),t),resetCheckActiveWorkspace()}})}),$(document).on("click",".button-application-default",function(e){e.preventDefault();let t=$(this).closest(".application-item").attr("data-application-id")||"";resetApplicationSearch(),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-default.php",data:{applicationId:t},success:function(e){decreaseAjaxPending(),onSetDefaultApplication(),$('meta[name="application-id"]').attr("content",t),window.localStorage.setItem(getLocalStorageKey("application-id"),t),resetCheckActiveApplication()},error:function(e,t,a){decreaseAjaxPending()}})}),$(document).on("click",".button-application-export",function(e){e.preventDefault();let t=$(this).closest(".application-item").attr("data-application-id")||"",a=document.createElement("form");a.method="POST",a.action="lib.ajax/application-export.php",a.style.display="none";let n=document.createElement("input");n.type="hidden",n.name="applicationId",n.value=t,a.appendChild(n),document.body.appendChild(a),a.submit(),setTimeout(()=>{document.body.removeChild(a)},1e3)}),$(document).on("click",".button-workspace-export",function(e){e.preventDefault();let t=$(this).closest(".workspace-item").attr("data-workspace-id")||"",a=document.createElement("form");a.method="POST",a.action="lib.ajax/workspace-export.php",a.style.display="none";let n=document.createElement("input");n.type="hidden",n.name="workspaceId",n.value=t,a.appendChild(n),document.body.appendChild(a),a.submit(),setTimeout(()=>{document.body.removeChild(a)},1e3)}),$(document).on("click",".button-application-open",function(e){e.preventDefault();let t=$(this).closest(".application-item").attr("data-path");window.location="vscode://file/"+t}),$(document).on("click",".button-workspace-open",function(e){e.preventDefault();let t=$(this).closest(".workspace-item").attr("data-path");window.location="vscode://file/"+t}),$(document).on("click",".refresh-application-list, .refresh-workspace-list",function(e){e.preventDefault(),resetApplicationSearch(),loadAllResource()}),$(document).on("click",".show-hidden-application",function(e){e.preventDefault(),resetApplicationSearch(),loadAllResource(!0)}),$(document).on("click",".button-save-workspace",function(e){e.preventDefault();let t=$(this).closest(".modal"),a=t.find('[name="workspace_name"]').val(),n=t.find('[name="workspace_description"]').val(),i=t.find('[name="workspace_directory"]').val(),l=t.find('[name="php_path"]').val();increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/workspace-create.php",data:{workspaceName:a,workspaceDirectory:i,workspaceDescription:n,phpPath:l},success:function(e){decreaseAjaxPending(),t.modal("hide"),loadAllResource()},error(e){decreaseAjaxPending()}})}),$(document).on("click",".sortable-menu-item > a, .sortable-submenu-item > a",function(e){e.preventDefault()}),$(document).on("dblclick",".sortable-menu-item > a, .sortable-submenu-item > a",function(e){e.preventDefault();let t=$(this).siblings(".icon-edit")[0];editMenu(t)}),$(document).on("blur",'.sortable-menu-item > input[type="text"], .sortable-submenu-item > input[type="text"]',function(e){e.preventDefault();let t=$(this),a=$(this).siblings("a.app-menu-text");t.css({display:"none"}),a.text(t.val()),a.css({display:""})}),$(document).on("click","#button_execute_entity_query",function(e){e.preventDefault(),$("#modal-query-executor").find("textarea").val(cmEditorSQL.getSelection()),cmEditorSQLExecute.setValue(cmEditorSQL.getSelection()),cmEditorSQLExecute.refresh(),$(".button-execute-query")[0].disabled=!0,$("#modal-query-executor").modal("show")}),$(document).on("change","table select[name=database_driver]",function(e){let t=$(this).find("option:selected").attr("data-base");$(this).closest("table").find("tr.database-credential").attr("data-current-database-type",t)}),$(document).on("click","#test-database-connection",function(e){let t=$(this).closest("table"),a={testConnection:"test"};t.find(":input").each(function(e){void 0!=$(this).attr("name")&&""!=$(this).attr("name")&&(a[$(this).attr("name")]=$(this).val())}),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/database-test.php",data:a,dataType:"json",success:function(e){decreaseAjaxPending(),e.conneted1?e.conneted2?($("#create-database").css({display:"none"}),showAlertUI("Database Connection Test","Successfully connected to the database.")):($("#create-database").css({display:"inline"}),showAlertUI("Database Connection Test","Successfully connected to the server, but database not found.")):($("#create-database").css({display:"none"}),showAlertUI("Database Connection Test","Invalid database credentials."))},error:function(e,t,a){decreaseAjaxPending(),$("#create-database").css("display","none"),showAlertUI("Database Connection Test","There was an error connecting to the server: "+a)}})}),$(document).on("click","#create-database",function(e){let t=$(this).closest("table"),a={createDatabase:"create"};t.find(":input").each(function(e){void 0!=$(this).attr("name")&&""!=$(this).attr("name")&&(a[$(this).attr("name")]=$(this).val())}),increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/database-create.php",data:a,dataType:"json",success:function(e){decreaseAjaxPending(),e.conneted1?e.conneted2?($("#create-database").css({display:"none"}),showAlertUI("Database Connection Test","Successfully created and connected to the database.")):($("#create-database").css({display:"inline"}),showAlertUI("Database Connection Test","Successfully connected to the server, but database creation failed.")):($("#create-database").css({display:"none"}),showAlertUI("Database Connection Test","Invalid database credentials."))},error:function(e,t,a){decreaseAjaxPending(),$("#create-database").css("display","none"),showAlertUI("Database Connection Test","There was an error connecting to the server: "+a)}})}),$(document).on("click",".use-original",function(e){$(".entity-info-key").each(function(e){$(this).val($(this).attr("data-original"))})}),$(document).on("click",".use-indonesian",function(e){$(".entity-info-key").each(function(e){$(this).val($(this).attr("data-indonesian"))})}),$(document).on("keyup","#search-workspace",function(e){doFilterWorkspace($(this))}),$(document).on("keyup","#search-application",function(e){doFilterApplication($(this))}),$(document).on("click",".upload-application-icons",function(){let e=$(this).closest("form").find('input[name="application_id"]').val(),t=document.querySelector("#iconFileInput");t&&t.parentNode.removeChild(t);let a=document.createElement("input");a.type="file",a.accept="image/png, image/svg+xml",a.id="iconFileInput",a.style.position="absolute",a.style.left="-1000000px",a.style.top="-1000000px",a.addEventListener("change",async function(){let t=a.files[0];if(!t){asyncAlert("Please select an image file first.","Notification",[{caption:"Close",fn(){},class:"btn-primary"}]);return}let n=t.type,i=new Image,l=null;if("image/svg+xml"===n){let o=await t.text(),r=new DOMParser,d=r.parseFromString(o,"image/svg+xml"),c=d.querySelector("svg");if(!c){asyncAlert("Invalid SVG content.","Notification",[{caption:"Close",fn(){},class:"btn-primary"}]);return}try{l=await convertSvgToPng(c)}catch(s){console.error("SVG conversion error:",s),asyncAlert("Failed to convert SVG to PNG.","Notification",[{caption:"Close",fn(){},class:"btn-primary"}]);return}}else if("image/png"===n)l=await new Promise((e,a)=>{let n=new FileReader;n.onload=t=>e(t.target.result),n.onerror=a,n.readAsDataURL(t)});else{asyncAlert("Unsupported file type. Please select PNG or SVG.","Notification",[{caption:"Close",fn(){},class:"btn-primary"}]);return}i.onload=function(){if(i.width<512||i.height<512){asyncAlert("The image must be at least 512x512 pixels.","Notification",[{caption:"Close",fn(){},class:"btn-primary"}]);return}let t=document.querySelector(".application-icon-preview");t&&(t.src=l,t.width=256,t.height=256);let a=document.createElement("canvas"),n=a.getContext("2d");[{size:16,name:"favicon-16x16.png"},{size:32,name:"favicon-32x32.png"},{size:48,name:"favicon-48x48.png"},{size:57,name:"apple-icon-57x57.png"},{size:60,name:"apple-icon-60x60.png"},{size:72,name:"apple-icon-72x72.png"},{size:76,name:"apple-icon-76x76.png"},{size:114,name:"apple-icon-114x114.png"},{size:120,name:"apple-icon-120x120.png"},{size:144,name:"apple-icon-144x144.png"},{size:152,name:"apple-icon-152x152.png"},{size:180,name:"apple-icon-180x180.png"},{size:192,name:"android-icon-192x192.png"},{size:256,name:"favicon.png"},{size:512,name:"android-icon-512x512.png"}].forEach(t=>{a.width=t.size,a.height=t.size,n.clearRect(0,0,a.width,a.height),n.drawImage(i,0,0,i.width,i.height,0,0,t.size,t.size);let l=a.toDataURL("image/png");sendIconPngToServer(e,l,t.name)}),generateFaviconICO(e,i),resetFileManager()},i.src=l}),a.click()}),$(document).on("click",".button-open-file",function(e){let t=document.querySelector("#sqlFileInput");t&&t.parentNode.removeChild(t);let a=document.createElement("input");a.type="file",a.accept=".sql",a.id="sqlFileInput",a.style.position="absolute",a.style.left="-1000000px",a.style.top="-1000000px",document.querySelector("body").appendChild(a),a.addEventListener("change",function e(t){let n=t.target.files[0];if(n){let i=new FileReader;i.onload=function(e){let t=e.target.result;a.parentNode.removeChild(a),cmEditorSQLExecute.getDoc().setValue(t),cmEditorSQLExecute.refresh()},i.readAsText(n)}else a.parentNode.removeChild(a)}),a.click()}),$(document).on("change",".include-list",function(e){let t=$(this).closest("tr");$(this)[0].checked?t.attr("data-include-list","true"):t.attr("data-include-list","false")}),$(document).on("change",".include-detail",function(e){let t=$(this).closest("tr");$(this)[0].checked?t.attr("data-include-detail","true"):t.attr("data-include-detail","false")}),$(document).on("click",".button-format-data",function(e){let t=$(this).closest("tr"),a=t.find(".input-field-data-type").val(),n=t.attr("data-field-name"),i=$(this).siblings(".input-format-data").val(),l=parseJsonData(i);null===l&&(l={}),showDataFormatDialog(n,a,l)}),$(document).on("change",".input-element-type",function(e){let t=$(this).closest("tr");$(this)[0].checked&&(isSupportMultiple($(this).val())?t.find(".input-multiple-data")[0].disabled=!1:(t.find(".input-multiple-data")[0].disabled=!0,t.find(".input-multiple-data")[0].checked=!1),t.attr("data-element-type","text"));let a=t.find(".input-element-type:checked").val();""!=a&&t.attr("data-element-type",a)}),$(document).on("change",".input-field-filter",function(e){let t=$(this).closest("tr");$(this)[0].checked&&isSupportMultiple($(this).val())?(t.find(".input-multiple-filter")[0].disabled=!1,t.find(".input-exact-filter")[0].disabled=!1):(t.find(".input-multiple-filter")[0].disabled=!0,t.find(".input-multiple-filter")[0].checked=!1,t.find(".input-exact-filter")[0].disabled=!0,t.find(".input-exact-filter")[0].checked=!1)}),$(document).on("click",".button-reload-application-menu",function(e){e.preventDefault(),loadMenu()}),$(document).on("change",'.directory-container input[type="text"]',function(e){let t=$(this);checkWriretableDirectory(t)}),$(document).on("change keyup",'#modal-create-application input[name="application_name"]',function(e){changeApplicationName($(this).val())}),$(document).on("change keyup",'#modal-create-application input[name="application_id"]',function(e){changeApplicationId($(this).val())}),$(document).on("click","#button-save-data-format",function(e){saveDataFormat()}),$(document).on("change",".rd-table-name, .rd-primary-key, .rd-value-column, .rd-reference-object-name, .rd-reference-property-name",function(e){validateReference()}),$(document).on("change",".rd-entity-name",function(e){validateEntityName()}),$(document).on("focus",".rd-table-name, .rd-primary-key, .rd-value-column, .rd-reference-property-name",function(e){let t=$(this).val(),a=$(this).closest("td");a.find(".column-container a").removeClass("column-selected"),a.find('.column-container a[data-column="'+t+'"]').addClass("column-selected"),a.attr("data-focus","true")}),$(document).on("blur",".rd-table-name, .rd-primary-key, .rd-value-column, .rd-reference-property-name",function(e){let t=$(this).closest("td");setTimeout(function(){t.attr("data-focus","false")},240)}),$(document).on("click",".primary-key-list a, .column-list a",function(e){e.preventDefault();let t=$(this).attr("data-column"),a=$(this).closest("td");a.attr("data-focus","false");let n=a.find('input[type="text"]');n.val(t),n.closest(".input-with-checker").attr("data-valid","true")}),$(document).on("click",".table-list a",function(e){e.preventDefault();let t=$(this).attr("data-table"),a=$(this).closest("td");a.attr("data-focus","false");let n=a.find('input[type="text"]');n.closest(".input-with-checker").attr("data-valid","true");let i=$(this).attr("data-primary-key");n.val(t),n.closest(".input-with-checker").attr("data-valid","true");let l=n.closest("table").find(".rd-primary-key");l.val(i),l.closest(".input-with-checker").attr("data-valid","true"),validateReference()}),$(document).on("change",'select[name="module_menu"]',function(e){e.preventDefault();let t=$(this).val();updateCurrentApplivationMenu(t)});let t=$('meta[name="workspace-id"]').attr("content")||"",a=$('meta[name="application-id"]').attr("content")||"";window.localStorage.setItem(getLocalStorageKey("workspace-id"),t),window.localStorage.setItem(getLocalStorageKey("application-id"),a),loadAllResource(),resetCheckActiveWorkspace(),resetCheckActiveApplication(),loadReferenceResource()};function updateCurrentApplivationMenu(e){let t=$('meta[name="application-id"]').attr("content");increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-menu-default.php",data:{applicationId:t,moduleMenuId:e},success:function(e){decreaseAjaxPending()},error:function(e,t,a){decreaseAjaxPending()}})}function validateClassName(e){return/^[A-Z][a-zA-Z0-9]*$/.test(e)}function validateEntityName(){let e=$(".rd-entity-name").val(),t=validateClassName(e);$(".rd-entity-name-container").attr("data-valid",t?"true":"false")}function validateReference(){$(".column-list").empty(),$(".primary-key-list").empty();let e=$('select[name="source_table"]').val(),t=$(".rd-table-name").val(),a=$(".rd-primary-key").val(),n=$(".rd-value-column").val(),i=$(".rd-reference-object-name").val(),l=$(".rd-reference-property-name").val(),o=$(".rd-table-name-container"),r=$(".rd-primary-key-container"),d=$(".rd-value-column-container"),c=$(".rd-reference-object-name-container"),s=$(".rd-reference-property-name-container");o.attr("data-loading","true"),r.attr("data-loading","true"),d.attr("data-loading","true"),c.attr("data-loading","true"),s.attr("data-loading","true"),$("#data-list-reference").empty(),$.ajax({method:"POST",url:"lib.ajax/entity-reference-test.php",data:{table_name:e,reference_table_name:t,reference_primary_key:a,reference_value_column:n,reference_object_name:i,reference_property_name:l},dataType:"json",success:function(e){o.attr("data-loading","false"),r.attr("data-loading","false"),d.attr("data-loading","false"),c.attr("data-loading","false"),s.attr("data-loading","false"),o.attr("data-valid",e.tableName?"true":"false"),r.attr("data-valid",e.primaryKey?"true":"false"),d.attr("data-valid",e.valueColumn?"true":"false"),c.attr("data-valid",e.referenceObjectName?"true":"false"),s.attr("data-valid",e.referencePropertyName?"true":"false");let t=$("<ul />");for(let a in e.primaryKeys){let n=$(`<li><a href="javascript:;" data-column="${e.primaryKeys[a]}">${e.primaryKeys[a]}</a></li>`);t.append(n)}$(".primary-key-list").append(t);let i=$("<ul />");for(let l in e.columns){let p=$(`<li><a href="javascript:;" data-column="${e.columns[l]}">${e.columns[l]}</a></li>`);i.append(p);let u=camelize(e.columns[l]);$("#data-list-reference").append($("<option>",{value:u,text:u}))}if($(".column-list").append(i),!e.tableName){let m=$("<ul />");for(let f in e.tables){let h=$(`<li><a href="javascript:;" data-table="${e.tables[f].tableName}" data-primary-key="${e.tables[f].primaryKeys[0]}">${e.tables[f].tableName}</a></li>`);m.append(h)}$(".table-list").append(m)}},error:function(e,t){console.error(e)}})}function saveDataFormat(){$("#data-format").modal("hide");let e=$("#input-control-string-format").val()||"",t=$("#input-control-date-format").val()||"",a=$("#input-control-decimal").val()||"",n=$("#input-control-decimal-separator").val()||"",i=$("#input-control-thousands-separator").val()||"",l=$("#data-format").attr("data-field-name");e=e.trim(),t=t.trim(),a=a.trim(),n=n.trim(),i=i.trim();let o={};""!=e?(o.formatType="stringFormat",o.stringFormat=e):""!=t?(o.formatType="dateFormat",o.dateFormat=t):""!=a&&(o.formatType="numberFormat",o.numberFormat={decimal:parseInt(a),decimalSeparator:n,thousandsSeparator:i}),$('.main-table tbody tr[data-field-name="'+l+'"]').find(".input-format-data").val(JSON.stringify(o))}function showDataFormatDialog(e,t,a){$("#data-format").modal("show"),$("#data-format").attr("data-field-name",e);let n="stringFormat";if(a&&a.formatType?n=a.formatType:("timestamp"==t||"datetime"==t||"datetime-local"==t||"date"==t||"time"==t)&&(n="dateFormat"),$("#input-control-string-format").val(""),$("#input-control-date-format").val(""),$("#input-control-decimal").val(""),$("#input-control-decimal-separator").val(""),$("#input-control-thousands-separator").val(""),"stringFormat"==n)$("#input-control-string-format").val(a.stringFormat||"");else if("dateFormat"==n)$("#input-control-date-format").val(a.dateFormat||"");else if("numberFormat"==n){let i=a&&a.numberFormat||{},l=void 0!==i.decimal?i.decimal:"",o=void 0!==i.decimalSeparator?i.decimalSeparator:"",r=void 0!==i.thousandsSeparator?i.thousandsSeparator:"";$("#input-control-decimal").val(l),$("#input-control-decimal-separator").val(o),$("#input-control-thousands-separator").val(r)}let d={stringFormat:"#string-format-tab",dateFormat:"#date-format-tab",numberFormat:"#number-format-tab"}[n];d&&($("#data-format .nav-link.active").removeClass("active"),$("#data-format .tab-pane.active").removeClass("active"),$("#data-format .tab-pane.active").removeClass("show"),$('#data-format .nav-link[data-target="'+d+'"]').addClass("active"),$(d).addClass("active show"),setTimeout(function(){$(d).find("input:first").focus()},380))}function downloadMarkdown(){let e=[];e=addDiagramOption(e),$(".entity-container-relationship .entity-checkbox").each(function(t){$(this)[0].checked&&e.push("entity[]="+$(this).val())}),e.push("rnd="+new Date().getTime());let t="lib.ajax/entity-relationship-diagram-markdown.php?"+e.join("&");window.location=t}let checkTimeout=setTimeout("",1e4);function changeApplicationName(e){let t=e.replace(/[^a-zA-Z]/g,""),a=e.replace(/[^a-zA-Z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"").toLowerCase();$('#modal-create-application input[name="application_namespace"]').val(t),changeApplicationId(a)}function changeApplicationId(e){$('#modal-create-application input[name="application_id"]').val(e),changeApplicationDirectory(e)}function changeApplicationDirectory(e){let t=$('#modal-create-application input[name="application_directory"]').val(),a=$('#modal-create-application input[name="application_url"]').val(),n=replaceBasename(t,e),i=replaceBasename(a,e);$('#modal-create-application input[name="application_directory"]').val(n),$('#modal-create-application input[name="application_url"]').val(i),clearTimeout(checkTimeout),checkTimeout=setTimeout(function(){checkWriretableDirectory($('#modal-create-application input[name="application_directory"]'))},500)}function replaceBasename(e,t){let a=e.replace(/\\/g,"/").split("/");return a[a.length-1]=t,e.includes("\\")?a.join("\\"):a.join("/")}function checkWriretableDirectory(e){let t=$(e).closest(".directory-container"),a=t.attr("data-isfile")||"",n=t.attr("data-failed-if-exists")||"",i=e.val()||"";""!=(i=i.trim())&&"/"!=i&&"\\"!=i&&(t.attr("data-loading","true"),$.ajax({method:"POST",url:"lib.ajax/directory-writeable-test.php",data:{directory:i,isfile:a,failedIfExists:n},dataType:"json",success:function(e){t.attr("data-loading","false"),e.writeable?(t.attr("data-valid","true"),showToast("Success",e.message)):(t.attr("data-valid","false"),showToast("Error",e.message))},error:function(e){t.attr("data-loading","false"),showToast("Error",e.getMessage())}}))}function resetCheckWriretableDirectory(e){let t=$(e).closest(".directory-container");t.removeAttr("data-valid"),t.removeAttr("data-loading")}function updateNewApplicationForm(e){for(let t of e.application_workspace){let a=$("<option />");a.text(t.label),a.attr("value",t.value),t.selected&&a.attr("selected","selected"),$('[name="application_workspace_id"]').append(a)}for(let n of e.installation_method){let i=$("<option />");i.text(n.label),i.attr("value",n.value),n.selected&&i.attr("selected","selected"),n.disabled&&i.attr("disabled","disabled"),$('[name="installation_method"]').append(i)}for(let l in e.magic_app_versions){let o=e.magic_app_versions[l].latest;$('[name="magic_app_version"]')[0].appendChild(new Option(e.magic_app_versions[l].value,e.magic_app_versions[l].key,o,o))}}function showApplicationMenuDialog(e){let t=$("#modal-application-menu"),a=$("#modal-application-menu .button-save-menu");t.find(".modal-body").empty(),t.find(".modal-body").append('<div style="text-align: center;"><span class="animation-wave"><span></span></span></div>'),t.attr("data-application-id",e),t.modal("show"),increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/application-menu.php",data:{applicationId:e},dataType:"html",success:function(e){decreaseAjaxPending(),$("#modal-application-menu .modal-body").empty().append(e),a[0].disabled=!1,initMenu()}})}function loadReferenceResource(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/reference.min.html",success:function(e){referenceResource=e,decreaseAjaxPending()},error:function(e){decreaseAjaxPending()}})}function generateFaviconICO(e,t){let a=document.createElement("canvas"),n=a.getContext("2d"),i=[];[16,32,48].forEach(e=>{a.width=e,a.height=e,n.clearRect(0,0,a.width,a.height),n.drawImage(t,0,0,t.width,t.height,0,0,e,e);let l=a.toDataURL("image/png");i.push(l)}),sendIconToServer(e,i,"favicon.ico")}function doFilterWorkspace(e){let t=$(e).val().toLowerCase().trim();$(".workspace-card > div").filter(function(){$(this).toggle($(this).find(".card-title").text().toLowerCase().includes(t))})}function doFilterApplication(e){let t=$(e).val().toLowerCase().trim();$(".application-card > div").filter(function(){$(this).toggle($(this).find(".card-title").text().toLowerCase().includes(t))})}let toCheckActiveWorkspace=setInterval("",1e7),toCheckActiveApplication=setInterval("",1e7),checkIntervalWorkspace=1e4,checkIntervalApplication=12e3;function resetCheckActiveWorkspace(){clearInterval(toCheckActiveWorkspace),toCheckActiveWorkspace=setInterval(function(){let e=window.localStorage.getItem(getLocalStorageKey("workspace-id"))||"",t=$('meta[name="workspace-id"]').attr("content");""!=e&&""!=t&&t!=e&&loadAllResource()},checkIntervalWorkspace)}function resetCheckActiveApplication(){clearInterval(toCheckActiveApplication),toCheckActiveApplication=setInterval(function(){let e=window.localStorage.getItem(getLocalStorageKey("application-id"))||"",t=$('meta[name="application-id"]').attr("content");""!=e&&""!=t&&t!=e&&loadAllResource()},checkIntervalApplication)}function loadWorkspaceList(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/workspace-list.php",success:function(e){decreaseAjaxPending(),$(".workspace-card").empty().append(e);let t=$('.workspace-item[data-selected="true"]').attr("data-workspace-id")||"";window.localStorage.setItem(getLocalStorageKey("workspace-id"),t),$('meta[name="workspace-id"]').attr("content",t)}})}function loadApplicationList(e=!1){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/application-list.php",data:{showHidden:e?1:0},success:function(e){decreaseAjaxPending(),$(".application-card").empty().append(e);let t=$('.application-item[data-selected="true"]').attr("data-application-id")||"",a=$('.application-item[data-selected="true"]').attr("data-application-name")||"";window.localStorage.setItem(getLocalStorageKey("application-id"),t),$('meta[name="application-id"]').attr("content",t),$('meta[name="application-name"]').attr("content",a);let n=$('meta[name="builder-name"]').attr("content");document.title=""!=a?a+" | "+n:n}})}function loadLanguageList(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/application-path-list.php",dataType:"json",success:function(e){decreaseAjaxPending();let t=$('[name="current_module_location"]');t.empty(),$.each(e,function(e,a){$("<option>",{text:a.name+" - "+a.path,value:a.path,selected:a.active}).appendTo(t)})},error:function(){decreaseAjaxPending(),console.error("Failed to load language list.")}})}function loadPathList(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/application-language-list.php",dataType:"json",success:function(e){decreaseAjaxPending(),setLanguage(e)}})}function updateQuery(){clearEditorSQL(),clearEditorSQLExecute()}function loadAllResource(e=!1){loadWorkspaceList(),loadApplicationList(e),loadPathList(),loadLanguageList(),loadMenu(),loadTable(),updateEntityQuery(!1),updateEntityRelationshipDiagram(),updateEntityFile(),updateValidatorFile(),updateModuleFile(),resetFileManager(),initTooltip()}function onSetDefaultWorkspace(){loadAllResource()}function onSetDefaultApplication(){loadApplicationList(),loadPathList(),loadLanguageList(),loadMenu(),loadTable(),updateEntityQuery(!1),updateEntityRelationshipDiagram(),updateEntityFile(),updateValidatorFile(),updateModuleFile(),resetFileManager(),initTooltip()}function onModuleCreated(){updateEntityQuery(!1),updateEntityRelationshipDiagram(),updateEntityFile(),updateValidatorFile(),updateModuleFile(),resetFileManager(),initTooltip()}function updateErd(){$(".erd-image").empty(),$('[name="erd-map"]').empty()}function initTooltip(){$(document).on("mouseenter",'[name="erd-map"] area, [data-toggle="tooltip"]',function(e){let t=$(this).attr("data-title")||$(this).attr("title"),a=$('<div class="tooltip"></div>').html(t),n="true"==$(this).attr("data-html");$("body").append(a),a.addClass("visible"),n&&a.addClass("multiline"),$(document).on("mousemove",function(e){let t=a.outerWidth(),n=a.outerHeight(),i=e.pageX+15,l=e.pageY+15;i+t>$(window).width()&&(i=e.pageX-t-15),l+n>$(window).height()&&(l=e.pageY-n-15)<16&&(l=16),a.css({left:i,top:l})})}),$(document).on("mouseleave",'[name="erd-map"] area, [data-toggle="tooltip"]',function(e){$(".tooltip").remove(),$(document).off("mousemove")})}function showModal(e,t,a,n){return new Promise((i,l)=>{let o=$("#customAlert"),r=$("#alertOverlay"),d=$("#alertMessage"),c=$("#alertTitle"),s=$("#modalFooter");s.empty(),r.show(),o.modal("show"),d.html(e),c.html(t),a.forEach(e=>{let t=$("<button>").addClass(`btn ${e.class||"btn-secondary"}`).text(e.caption).on("click",()=>{o.modal("hide"),r.hide(),e.fn(),i(e.caption)});s.append(t)}),o.on("hidden.bs.modal",()=>{n&&n()})})}function asyncPrompt(e,t,a,n,i){return new Promise((l,o)=>{let r=$("#customAlert"),d=$("#alertOverlay"),c=$("#alertMessage"),s=$("#alertTitle"),p=$("#modalFooter");p.empty();let u=$("<input>").addClass("form-control").addClass("prompt-input").attr("type","text").attr("placeholder","Enter your text here").val(n);d.show(),r.modal("show");let m=$("<div />").addClass("input-label").text(e);c.empty().append(m),c.append(u),s.html(t),a.forEach(e=>{let t=$("<button>").addClass(`btn ${e.class||"btn-secondary"}`).text(e.caption).on("click",()=>{r.modal("hide"),d.hide(),"OK"===e.caption?l(u.val()):l(e.caption),e.fn($(".prompt-input").val())});p.append(t)}),r.on("hidden.bs.modal",()=>{i&&i()})})}function asyncAlert(e,t,a){showModal(e,t,a,function(){$("#alertOverlay").css({display:"none"}),$(".modal").css({overflow:"","overflow-y":"auto"})})}function getUserInput(e,t,a,n){asyncPrompt(e,t,a,n,function(){$("#alertOverlay").css({display:"none"}),$(".modal").css({overflow:"","overflow-y":"auto"})})}let timeoutEditMenu=setTimeout("",100);function initMenu(){document.querySelectorAll(".sortable-toggle-icon").forEach(e=>{e.addEventListener("click",function(){this.parentNode.classList.toggle("expanded")})}),document.querySelectorAll(".sortable-submenu-item").forEach(e=>{e.setAttribute("draggable",!0),e.addEventListener("dragstart",dragStart),e.addEventListener("dragover",dragOver),e.addEventListener("drop",dropToSubmenu)}),document.querySelectorAll(".icon-move-down").forEach(e=>{e.setAttribute("draggable",!0),e.addEventListener("dragstart",dragStart)}),document.querySelectorAll(".sortable-menu-item").forEach(e=>{e.addEventListener("dragover",dragOver),e.addEventListener("drop",dropToMenu)})}function editMenu(e){let t=$(e),a=t.closest("li"),n=t.siblings(".app-menu-text");a.find("input")&&a.find("input").remove();let i=$("<input />");i.attr({type:"text",class:"form-control"}),n.css("display","none"),n.before(i),i.val(n.text()),i.focus(),i.select(),i.focus()}let draggedItem=null;function dragStart(e){if(e.target.classList.contains("sortable-submenu-item"))draggedItem=e.target,e.dataTransfer.effectAllowed="move";else{let t=e.target.closest(".sortable-submenu-item");null!=t&&(draggedItem=t,t.dataTransfer&&(t.dataTransfer.effectAllowed="move"))}}function dragOver(e){e.preventDefault()}function dropToMenu(e){if(e.preventDefault(),draggedItem){if(0===e.target.classList.length){let t=e.target.closest(".sortable-menu-item");t&&(t.querySelector(".sortable-submenu").appendChild(draggedItem),t.classList.remove("expanded"),t.classList.add("expanded"))}if(e.target.classList.contains("sortable-menu-item")){if(!e.target.querySelector(".sortable-submenu")){let a=document.createElement("ul");a.classList.add("sortable-submenu"),e.target.appendChild(a)}e.target.querySelector(".sortable-submenu").appendChild(draggedItem),e.target.classList.remove("expanded"),e.target.classList.add("expanded")}(e.target.classList.contains("sortable-submenu")||e.target.classList.contains("icon-move"))&&(e.target.appendChild(draggedItem),e.target.parentNode.classList.remove("expanded"),e.target.parentNode.classList.add("expanded")),draggedItem=null}}function dropToSubmenu(e){if(e.preventDefault(),e.target.classList.contains("sortable-submenu-item")){let t=e.offsetY>e.target.offsetHeight/2;t?e.target.parentNode.insertBefore(draggedItem,e.target.nextSibling):e.target.parentNode.insertBefore(draggedItem,e.target)}else e.target.classList.contains("sortable-submenu")&&e.target.appendChild(draggedItem)}function serializeMenu(){let e=[],t=document.querySelectorAll(".sortable-menu-item");return t.forEach(t=>{let a={title:t.querySelector("a.app-menu-text").textContent,icon:t.querySelector("a.app-menu-text").dataset.icon,submenu:[]},n=t.querySelectorAll(".sortable-submenu-item");n.forEach(e=>{a.submenu.push({title:e.querySelector("a.app-menu-text").textContent,code:e.querySelector("a.app-menu-text").dataset.code,href:e.querySelector("a.app-menu-text").getAttribute("href"),icon:e.querySelector("a.app-menu-text").dataset.icon,specialAccess:e.querySelector("a.app-menu-text").dataset.specialAccess})}),e.push(a)}),e}function moveUp(e){let t=e.closest(".sortable-submenu-item")||e.closest(".sortable-menu-item"),a=t.previousElementSibling;a&&t.parentNode.insertBefore(t,a)}function moveDown(e){let t=e.closest(".sortable-submenu-item")||e.closest(".sortable-menu-item"),a=t.nextElementSibling;a&&t.parentNode.insertBefore(a,t)}function reloadTranslate(e){"module"==e?translateModule():"entity"==e&&translateEntity()}let entityTranslationData=[],moduleTranslationData=[],appTranslationData=[];function translateEntity(e){if(""!=(entityName=currentEntity2Translated)){let t=$(".target-language").val(),a=$(".filter-translate").val();increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/entity-translate.php",dataType:"json",data:{userAction:"get",entityName:entityName,targetLanguage:t,filter:a},success:function(e){decreaseAjaxPending(),entityTranslationData=e,$(".entity-translation-status").text("");let t=[],a=[],n=[];for(let i in e)t.push(e[i].original),a.push(e[i].translated),n.push(e[i].propertyName);transEd1.getDoc().setValue(t.join("\r\n")),transEd2.getDoc().setValue(a.join("\r\n")),$(".entity-property-name").val(n.join("|")),$(".entity-name").val(entityName),focused={},transEd1.removeLineClass(lastLine1,"background","highlight-line"),transEd2.removeLineClass(lastLine1,"background","highlight-line"),lastLine1=-1},error:function(e,t,a){decreaseAjaxPending()}})}void 0!==e&&e()}function translateModule(){let e=$(".target-language").val(),t=$(".filter-translate").val(),a=[];$(".module-for-translate").each(function(e){$(this)[0].checked&&a.push($(this).val())}),increaseAjaxPending(),$.ajax({method:"POST",url:"lib.ajax/module-translate.php",dataType:"json",data:{userAction:"get",modules:a,translated:null,propertyNames:null,targetLanguage:e,filter:t},success:function(e){decreaseAjaxPending(),moduleTranslationData=e,$(".module-translation-status").text("");let t=[],a=[],n=[];for(let i in e)t.push(e[i].original),a.push(e[i].translated),n.push(e[i].propertyName);transEd3.getDoc().setValue(t.join("\r\n")),transEd4.getDoc().setValue(a.join("\r\n")),$(".module-property-name").val(n.join("|")),focused={},transEd3.removeLineClass(lastLine2,"background","highlight-line"),transEd4.removeLineClass(lastLine2,"background","highlight-line"),lastLine2=-1},error:function(e){decreaseAjaxPending(),$(".module-translation-status").text("Error: "+e.responseText)}})}function sendIconPngToServer(e,t,a){let n=new FormData;n.append("application_id",e),n.append("image",t),n.append("icon_name",a),increaseAjaxPending(),fetch("lib.ajax/application-icons.php",{method:"POST",body:n}).then(e=>e.json()).then(e=>{decreaseAjaxPending()}).catch(e=>{decreaseAjaxPending()})}function sendIconToServer(e,t,a){let n=new FormData;n.append("application_id",e),n.append("icon_name",a),t.forEach((e,t)=>{n.append("images["+t+"]",e)}),increaseAjaxPending(),fetch("lib.ajax/application-icon.php",{method:"POST",body:n}).then(e=>e.json()).then(e=>{decreaseAjaxPending()}).catch(e=>{decreaseAjaxPending()})}function upperCamelize(e){return e.replaceAll("_"," ").capitalize().prettify().replaceAll(" ","").trim()}function camelize(e){return e.toLowerCase().split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")}function hasKey(e,t){let a=e.length,n;for(n=0;n<a;n++)if(e[n].value==t)return!0;return!1}function loadState(e,t,a){let n;for(n in a.find("tbody tr").each(function(t,n){let i=$(this).find('input[type="hidden"][name="field"]').val();hasKey(e,i)&&$(a).find('input[name$="'+i+'"]').each(function(e,t){$(this)[0].checked=!1})}),e){let i=$(a).find(":input[name="+e[n].name+"]");if(i.length){let l=e[n].value,o=e[n].name,r=i.prop("tagName").toString().toLowerCase(),d=i.attr("type");"radio"==d?$(a).find('[name="'+o+'"][value="'+l+'"]')[0].checked=!0:"checkbox"==d&&null!=l&&0!=l&&"0"!=l?$(a).find('[name="'+o+'"]')[0].checked=!0:"select"==r&&i.val(e[n].value)}}}function fixPathForm(){let e=0;$("table.path-manager tbody tr").each(function(){let t=$(this);t.find('td:nth-child(1) input[type="text"]').attr("name","name["+e+"]"),t.find('td:nth-child(2) input[type="text"]').attr("name","path["+e+"]"),t.find('td:nth-child(3) input[type="checkbox"]').attr("name","checked["+e+"]"),e++})}function fixLanguageForm(){let e=0;$("table.language-manager tbody tr").each(function(){let t=$(this);t.find('td:nth-child(1) input[type="text"]').attr("name","language_name["+e+"]"),t.find('td:nth-child(2) input[type="text"]').attr("name","language_code["+e+"]"),t.find('td:nth-child(3) input[type="checkbox"]').attr("name","checked["+e+"]"),e++})}function addDiagramOption(e){return e.push("maximum_level="+$('[name="maximum_level"]').val()),e.push("maximum_column="+$('[name="maximum_column"]').val()),e.push("margin_x="+$('[name="margin_x"]').val()),e.push("margin_y="+$('[name="margin_y"]').val()),e.push("entity_margin_x="+$('[name="entity_margin_x"]').val()),e.push("entity_margin_y="+$('[name="entity_margin_y"]').val()),e.push("zoom="+$('[name="zoom"]').val()),e}function loadDiagramMultiple(){let e=[];e=addDiagramOption(e),$(".entity-container-relationship .entity-checkbox").each(function(t){$(this)[0].checked&&e.push("entity[]="+$(this).val())}),e.push("rnd="+new Date().getTime());let t=$("<img />"),a="lib.ajax/entity-relationship-diagram.php?"+e.join("&"),n="lib.ajax/entity-relationship-diagram-map.php?"+e.join("&");t.attr("src",a),$(".erd-image").empty().append(t),$('[name="erd-map"]').load(n,function(e){t.attr("usemap","#erd-map")})}function downloadSVG(){let e=document.querySelector(".erd-image img"),t=e.getAttribute("src"),a=document.createElement("a");a.href=t,a.download="downloaded-image.svg",document.body.appendChild(a),a.click(),document.body.removeChild(a)}function downloadPNG(){let e=document.querySelector(".erd-image img"),t=e.getAttribute("src"),a=document.createElement("canvas"),n=a.getContext("2d");a.width=e.width,a.height=e.height;let i=new Image;i.onload=function(){n.drawImage(i,0,0),URL.revokeObjectURL(t);let e=a.toDataURL("image/png"),l=document.createElement("a");l.href=e,l.download="downloaded-image.png",document.body.appendChild(l),l.click(),document.body.removeChild(l)},i.src=t}function onChangeMapKey(e){let t=e.val();"label"==t.toLowerCase()||"value"==t.toLowerCase()||"goup"==t.toLowerCase()||"selected"==t.toLowerCase()?e.hasClass("input-invalid-value")||(e.addClass("input-invalid-value"),setTimeout(function(){e.val("data-"+t.toLowerCase()),onChangeMapKey(e)},500)):e.hasClass("input-invalid-value")&&e.removeClass("input-invalid-value")}function showAlertUI(e,t){$("#alert-dialog .modal-title").text(e),$("#alert-dialog .modal-body").html(t),$("#alert-dialog").modal("show")}function closeAlertUI(){$("#alert-dialog").modal("hide")}function saveModule(){if(""!=currentModule){$("#button_save_module_file").attr("disabled","disabled");let e=cmEditorModule.getDoc().getValue();increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/module-update.php",data:{content:e,module:currentModule},dataType:"html",success:function(e){decreaseAjaxPending(),$("#button_save_module_file").removeAttr("disabled")}})}else showAlertUI("Alert","No file open")}function saveEntity(){if(""!=currentEntity){$("#button_save_entity_file").attr("disabled","disabled");let e=cmEditorFile.getDoc().getValue();increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/entity-update.php",dataType:"json",data:{content:e,entity:currentEntity},success:function(t){decreaseAjaxPending(),$("#button_save_entity_file").removeAttr("disabled"),updateEntityFile(function(){setEntityFile(e),updateSelectedEntity()}),updateEntityQuery(!0),updateEntityRelationshipDiagram(),removeHilightLineError(cmEditorFile),addHilightLineError(cmEditorFile,t.error_line-1),t.success||(showAlertUI(t.title,t.message),setTimeout(function(){closeAlertUI()},5e3))}})}else showAlertUI("Alert","No file open")}function saveValidator(){if(""!=currentValidator){$("#button_save_validator_file").attr("disabled","disabled");let e=cmEditorValidator.getDoc().getValue();increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/validator-file.php",dataType:"json",data:{userAction:"set",content:e,validator:currentValidator},success:function(t){decreaseAjaxPending(),$("#button_save_validator_file").removeAttr("disabled"),updateValidatorFile(function(){setValidatorFile(e),updateSelectedValidator(),removeHilightLineError(cmEditorValidator),addHilightLineError(cmEditorValidator,t.error_line-1)}),removeHilightLineError(cmEditorValidator),addHilightLineError(cmEditorValidator,t.error_line-1),t.success||(showAlertUI(t.title,t.message),setTimeout(function(){closeAlertUI()},5e3))},error:function(e){$("#button_save_validator_file").removeAttr("disabled"),decreaseAjaxPending()}})}else showAlertUI("Alert","No file open")}function saveValidatorAs(){if(""!=currentValidator){let e=cmEditorValidator.getDoc().getValue();getUserInput("New Validator Name","Save Validator As",[{caption:"Yes",fn(){let t=$(".prompt-input").val();increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/validator-file.php",dataType:"json",data:{userAction:"set",content:e,validator:currentValidator,newValidator:t},success:function(e){currentValidator=t,decreaseAjaxPending(),$("#button_save_validator_file").removeAttr("disabled"),updateValidatorFile(function(){setValidatorFile(e.new_content),updateSelectedValidator(),removeHilightLineError(cmEditorValidator),addHilightLineError(cmEditorValidator,e.error_line-1)}),resetFileManager(),removeHilightLineError(cmEditorValidator),addHilightLineError(cmEditorValidator,e.error_line-1),e.success||(showAlertUI(e.title,e.message),setTimeout(function(){closeAlertUI()},5e3))},error:function(e){decreaseAjaxPending()}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}],currentEntity)}else showAlertUI("Alert","No file open")}function updateSelectedEntity(){$(".entity-list .entity-li").removeClass("selected-file"),$('.entity-list [data-entity-name="'+currentEntity.split("\\").join("\\\\")+'"]').closest(".entity-li").addClass("selected-file")}function updateSelectedValidator(){$(".validator-list .validator-li").removeClass("selected-file"),$('.validator-list [data-validator-name="'+currentValidator.split("\\").join("\\\\")+'"]').closest(".validator-li").addClass("selected-file")}function saveEntityAs(){if(""!=currentEntity){let e=cmEditorFile.getDoc().getValue();getUserInput("New Etity Name","Save Entity As",[{caption:"Yes",fn(){let t=$(".prompt-input").val();increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/entity-save-as.php",dataType:"json",data:{content:e,entity:currentEntity,newEntity:t},success:function(e){decreaseAjaxPending(),updateEntityFile(),resetFileManager(),updateEntityQuery(!0),updateEntityRelationshipDiagram(),removeHilightLineError(cmEditorFile),addHilightLineError(cmEditorFile,e.error_line-1),e.success||(showAlertUI(e.title,e.message),setTimeout(function(){closeAlertUI()},5e3))}})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}],currentEntity)}else showAlertUI("Alert","No file open")}function addHilightLineError(e,t){-1!=t&&e.addLineClass(t,"background","highlight-line"),lastErrorLine=t}function removeHilightLineError(e){-1!=lastErrorLine&&e.removeLineClass(lastErrorLine,"background","highlight-line")}function saveQuery(){let e=new Blob([cmEditorSQL.getDoc().getValue()],{type:"application/x-sql;charset=utf-8"}),t=new Date().getTime()+".sql",a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}function getEntitySelection(){let e=[];return $(".entity-checkbox").each(function(){$(this)[0].checked&&e.push($(this).val())}),e}function getEntityQuery(e,t,a){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/entity-query.php",data:{entity:e,merged:t?1:0,createNew:a?1:0},dataType:"text",success:function(e){decreaseAjaxPending(),cmEditorSQL.getDoc().setValue(e),setTimeout(function(){cmEditorSQL.refresh()},1),$("#button_save_entity_query").removeAttr("disabled")},error:function(e,t,a){decreaseAjaxPending()}})}function getEntityFile(e,t,a){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/entity-file.php",data:{entity:e},dataType:"text",success:function(n){decreaseAjaxPending(),cmEditorFile.getDoc().setValue(n),setTimeout(function(){cmEditorFile.refresh(),a&&a>-1&&focusOnLine(cmEditorFile,a)},1),$("#button_save_entity_file").removeAttr("disabled"),$("#button_delete_entity_file").removeAttr("disabled"),currentEntity=e[0],t&&t()},error:function(e,t,a){decreaseAjaxPending()}})}function getValidatorFile(e,t,a){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/validator-file.php",data:{validator:e},dataType:"text",success:function(n){decreaseAjaxPending(),cmEditorValidator.getDoc().setValue(n),setTimeout(function(){cmEditorValidator.refresh(),a&&a>-1&&focusOnLine(cmEditorValidator,a)},1),$("#button_save_validator_file").removeAttr("disabled"),$("#button_save_validator_file_as").removeAttr("disabled"),$("#button_delete_validator_file").removeAttr("disabled"),$("#button_test_validator").removeAttr("disabled"),$("#button_update_validator_file").removeAttr("disabled"),currentValidator=e,t&&t()},error:function(e,t,a){decreaseAjaxPending()}})}function getModuleFile(e,t){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/module-file.php",data:{module:e},dataType:"html",success:function(a){decreaseAjaxPending(),cmEditorModule.getDoc().setValue(a),setTimeout(function(){cmEditorModule.refresh()},1),$("#button_save_module_file").removeAttr("disabled"),$("#button_delete_module_file").removeAttr("disabled"),currentModule=e,t&&t()},error:function(e,t,a){decreaseAjaxPending()}})}function updateEntityQuery(e){e=e||!1,increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/entity-list-with-checkbox.php",data:{autoload:e},dataType:"html",success:function(t){decreaseAjaxPending(),$(".entity-container-query .entity-list").empty().append(t);let a=getEntitySelection(),n=$(".entity-merge"),i=$(".entity-create-new");n.length>0&&i.length>0&&e&&getEntityQuery(a,n[0].checked,i[0].checked)}})}function updateEntityRelationshipDiagram(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/entity-list-for-diagram.php",dataType:"html",success:function(e){decreaseAjaxPending(),$(".entity-container-relationship .entity-list").empty().append(e),updateErd()},error:function(e,t,a){decreaseAjaxPending()}})}function updateEntityFile(e){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/entity-list.php",dataType:"html",success:function(t){decreaseAjaxPending(),$(".entity-container-file .entity-list").empty().append(t),$(".container-translate-entity .entity-list").empty().append(t),$("button#entity-file-tab").removeClass("text-danger");$(".entity-container-file .entity-list").find('a[data-error="true"]').length&&$("button#entity-file-tab").addClass("text-danger"),clearEntityFile(),"function"==typeof e&&e(),clearTtransEd3(),clearTtransEd4()},error:function(e,t,a){decreaseAjaxPending()}})}function updateValidatorFile(e){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/validator-list.php",dataType:"html",success:function(t){decreaseAjaxPending(),$(".validator-container-file .validator-list").empty().append(t),$(".container-translate-validator .validator-list").empty().append(t),$("button#validator-file-tab").removeClass("text-danger");$(".validator-container-file .validator-list").find('a[data-error="true"]').length&&$("button#validator-file-tab").addClass("text-danger"),clearValidatorFile(),"function"==typeof e&&e(),clearTtransEd5(),clearTtransEd6()},error:function(e,t,a){decreaseAjaxPending()}})}function updateModuleFile(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/module-list-file.php",dataType:"html",success:function(e){decreaseAjaxPending(),$(".module-container .module-list-file").empty().append(e),clearModuleFile()},error:function(e,t,a){decreaseAjaxPending()}}),increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/module-list-translate.php",dataType:"html",success:function(e){decreaseAjaxPending(),$(".container-translate-module .module-list-translate").empty().append(e),clearTtransEd1(),clearTtransEd2()},error:function(e,t,a){decreaseAjaxPending()}})}function saveReference(e,t,a){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/reference-save.php",data:{fieldName:e,key:t,value:a},dataType:"json",success:function(e){decreaseAjaxPending()},error:function(e,t,a){decreaseAjaxPending()}})}function loadReference(e,t,a){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/reference-load.php",data:{fieldName:e,key:t},dataType:"json",success:function(e){decreaseAjaxPending(),a(e)},error:function(e,t,a){decreaseAjaxPending()}})}function updateTableName(e,t,a,n,i){e=e.replaceAll("_","-"),t=t.replaceAll("_","-"),a=ucWord(a.replaceAll("_"," "));let l=upperCamelize(n),o=n+"_apv",r=n+"_trash";$(this).attr("data-value",n),$('[name="primary_key_master"]').val(i),$('[name="entity_master_name"]').val(l),$('[name="entity_approval_name"]').val(l+"Apv"),$('[name="entity_trash_name"]').val(l+"Trash"),$('[name="table_approval_name"]').val(o),$('[name="primary_key_approval"]').val(o+"_id"),$('[name="table_trash_name"]').val(r),$('[name="primary_key_trash"]').val(r+"_id"),$('[name="module_file"]').val(e),$('[name="module_code"]').val(t),$('[name="module_name"]').val(a),$('[name="module_icon"]').val("fa fa-file"),$('[name="insert_validator_class"]').val(l+"InsertValidator"),$('[name="update_validator_class"]').val(l+"UpdateValidator")}function ucWord(e){return(e=e.toLowerCase()).replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(e){return e.toUpperCase()})}function prepareReferenceData(e,t){let a=t.closest("tr");"select"==e?a.find(".reference_button_data").css("display","inline"):a.find(".reference_button_data").css("display","none")}function prepareReferenceFilter(e,t){let a=t.closest("tr");"select"==e?a.find(".reference_button_filter").css("display","inline"):a.find(".reference_button_filter").css("display","none")}function switchApplication(e){increaseAjaxPending(),$.ajax({type:"post",url:"lib.ajax/application-switch.php",dataType:"json",data:{currentApplication:e},success:function(e){decreaseAjaxPending(),window.location.reload()}})}function generateScript(e){let t=[];$(e).find("tr").each(function(e){let a=$(this).attr("data-field-name"),n=$(this).attr("data-field-type"),i=$(this).find("input.input-field-name").val(),l=$(this).find("input.include-insert")[0].checked,o=$(this).find("input.include-edit")[0].checked,r=$(this).find("input.include-detail")[0].checked,d=$(this).find("input.include-list")[0].checked,c=$(this).find("input.include-export")[0].checked,s=$(this).find("input.include-key")[0].checked,p=$(this).find("input.include-required")[0].checked,u=$(this).find("input.input-element-type:checked").val(),m=$(this).find("input.input-field-filter:checked").length>0?$(this).find("input.input-field-filter:checked").val():null,f=$(this).find("select.input-field-data-type").val(),h=$(this).find("input.input-format-data").val(),y={};-1!=h.indexOf("{")&&-1!=h.indexOf("}")&&(y=JSON.parse(h));let v=$(this).find("select.input-data-filter").val(),g=parseJsonData($(this).find("input.reference-data").val()),b=parseJsonData($(this).find("input.reference-filter").val()),x=$(this).find("input.input-multiple-data")[0].checked,k=$(this).find("input.input-multiple-filter")[0].checked,A=$(this).find("input.input-exact-filter")[0].checked,j={fieldName:a,fieldLabel:i,fieldType:n,includeInsert:l,includeEdit:o,includeDetail:r,includeList:d,includeExport:c,isKey:s,isInputRequired:p,elementType:u,filterElementType:m,dataType:f,dataFormat:y,inputFilter:v,referenceData:g,referenceFilter:b,multipleData:x,multipleFilter:k,exactFilter:A};t.push(j)});let a=$("#subquery")[0].checked&&!0,n=$("#with_approval")[0].checked&&!0,i=$("#with_trash")[0].checked&&!0,l=$("#manual_sort_order")[0].checked&&!0,o=$("#export_to_excel")[0].checked&&!0,r=$("#export_to_csv")[0].checked&&!0,d=$("#export_use_temporary")[0].checked&&!0,c=$("#activate_deactivate")[0].checked&&!0,s=$("#user_activity_logger")[0].checked&&!0,p=$("#with_approval_note")[0].checked&&!0,u=$('[name="approval_by_other_user"]')[0].checked&&!0,m=$("#ajax_support")[0].checked&&!0,f=$("#backend_only")[0].checked&&!0,h=$("#with_validation")[0].checked&&!0,y=$('[name="approval_position"]:checked').val(),v=$('[name="approval_bulk"]:checked').val(),g=$('[name="approval_type"]:checked').val(),b={mainEntity:{entityName:$('[name="entity_master_name"]').val(),tableName:$('[name="source_table"]').val(),primaryKey:$('[name="primary_key_master"]').val()},approvalRequired:n,trashRequired:i};n&&(b.approvalEntity={entityName:$('[name="entity_approval_name"]').val(),tableName:$('[name="table_approval_name"]').val(),primaryKey:$('[name="primary_key_approval"]').val()}),i&&(b.trashEntity={entityName:$('[name="entity_trash_name"]').val(),tableName:$('[name="table_trash_name"]').val(),primaryKey:$('[name="primary_key_trash"]').val()});let x=getSpecificationModule(),k=getSortableModule(),A=buildValidationDefinition(t),j={insertValidatorClass:$('[name="insert_validator_class"]').val(),updateValidatorClass:$('[name="update_validator_class"]').val(),updateValidationDefintion:$('[name="update_validation_definition"]').prop("checked"),validationDefinition:A},T={entity:b,fields:t,validator:j,specification:x,sortable:k,features:{activateDeactivate:c,sortOrder:l,exportToExcel:o,exportToCsv:r,exportUseTemporary:d,userActivityLogger:s,approvalRequired:n,approvalNote:p,trashRequired:i,approvalType:g,approvalPosition:y,approvalByAnotherUser:u,approvalBulk:v,withValidation:h,backendOnly:f,subquery:a,ajaxSupport:m},moduleCode:$('[name="module_code"]').val(),moduleName:$('[name="module_name"]').val(),moduleFile:$('[name="module_file"]').val(),moduleIcon:$('[name="module_icon"]').val(),moduleAsMenu:$('[name="module_as_menu"]').val(),moduleMenu:$('[name="module_menu"]').val(),target:$("#current_module_location").val(),updateEntity:$('[name="update_entity"]')[0].checked};generateAllCode(T)}let validation={};function buildValidationDefinition(e){if(void 0!==validation&&validation){let t=[],a=0;for(let n in e)if(e.hasOwnProperty(n)){let i=e[n].fieldName,l=e[n].fieldType;if(validation.hasOwnProperty(i)){let o=validation[i];t[a]={},t[a].fieldName=i,t[a].fieldType=l,t[a].validation=[],o.forEach(e=>{t[a].validation.push(e)}),a++}}return t}}function extractValidationDefinition(e){let t={};if(void 0!==e&&e){for(let a in e)if("undefined"!==e[a]&&e[a]){let n=e[a].fieldName,i=e[a].validation;t[n]=i}}return t}function getSpecificationModule(){let e=[];return $(".table-data-filter").find("tbody").find("tr").each(function(t){let a=$(this);if(a.find(".data-filter-column-name").length&&a.find(".data-filter-column-value").length){let n=a.find(".data-filter-column-name").val(),i=a.find(".data-filter-column-value").val(),l=a.find(".data-filter-column-comparison").val();void 0===n&&(n=""),void 0===i&&(i=""),void 0===l&&(l=""),""==l&&(l="equals"),n.length>0&&e.push({column:n.trim(),value:i.trim(),comparison:l})}}),e}function getSortableModule(){let e=[];return $(".table-data-order").find("tbody").find("tr").each(function(t){let a=$(this);if(a.find(".data-order-column-name").length&&a.find(".data-order-order-type").length){let n=a.find(".data-order-column-name").val(),i=a.find(".data-order-order-type").val();n=n?n.trim():"",i=i?i.trim():"",n.length>0&&e.push({sortBy:n,sortType:i})}}),e}function safeJsonParse(e){try{return JSON.parse(e)}catch(t){return null}}function parseJsonData(e){if("string"!=typeof e)return null;let t=safeJsonParse(e);return"object"==typeof t&&null!==t?t:null}function generateAllCode(e){increaseAjaxPending(),fetch("lib.ajax/script-generator.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.success&&showToast(e.title,e.message),decreaseAjaxPending(),updateEntityFile(),updateValidatorFile(),updateEntityQuery(!0),updateEntityRelationshipDiagram(),e.success&&(onModuleCreated(),setTimeout(function(){closeAlertUI()},2e3))}).catch(e=>{decreaseAjaxPending()})}function showToast(e,t){let a="toast-"+new Date().getTime(),n=`
    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-autohide="true" data-delay="3000" id="${a}" style="z-index:10000000">
      <div class="toast-header">
        <strong class="mr-auto">${e}&nbsp;&nbsp;</strong>
        <small>just now</small>
        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="toast-body">
        ${t}
      </div>
    </div>
  `;$(".toast-container").prepend(n);let i=$("#"+a)[0];new bootstrap.Toast(i).show(),$(i).on("hidden.bs.toast",function(){$(i).remove()})}function updateCurrentApplivation(e){increaseAjaxPending(),$.ajax({type:"POST",url:"lib.ajax/application-update.php",data:e,success:function(e){for(let t in decreaseAjaxPending(),$('select[name="source_table"]').empty(),e)$('select[name="source_table"]')[0].append(new Option(e[t].table_name,e[t].table_name));let a=$('select[name="source_table"]').attr("data-value");null!=a&&""!=a&&$('select[name="source_table"]').val(a),loadAllResource()}})}function loadTable(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/database-table-list.php",dataType:"json",success:function(e){decreaseAjaxPending();let t=$('select[name="source_table"]');t.empty(),$("<option>",{text:"- Select Table -",value:""}).appendTo(t);let a={custom:[],system:[]};$.each(e,function(e,t){let n="system"===t.table_group?"system":"custom",i=$("<option>",{text:t.table_name,value:t.table_name});Array.isArray(t.primary_key)&&t.primary_key.length>0&&i.attr("data-primary-key",t.primary_key[0]),a[n].push(i)});let n={custom:"Custom Tables",system:"System Tables"};["custom","system"].forEach(e=>{if(a[e].length>0){let i=$("<optgroup>",{label:n[e]});a[e].forEach(e=>{i.append(e)}),t.append(i)}});let i=t.attr("data-value");i&&t.val(i)},error:function(){decreaseAjaxPending()}})}function loadMenu(){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/application-menu-json.php",dataType:"json",success:function(e){decreaseAjaxPending();let t=$('select[name="module_menu"]');t.empty(),e.menu&&e.menu.length>0&&$.each(e.menu,function(e,a){$("<option>",{text:a.title,value:a.title,selected:!0===a.active}).appendTo(t)})},error:function(){decreaseAjaxPending()}})}function loadColumn(e,t){increaseAjaxPending(),$.ajax({type:"post",url:"lib.ajax/database-column-list.php",data:{table_name:e},dataType:"json",success:function(e){currentTableStructure=e,decreaseAjaxPending(),$(t).empty();let a=e.fields,n,i,l,o,r=e.skipped_insert_edit;for(n in $("#data-list-column").empty(),a){let d=camelize(i=a[n].column_name);$("#data-list-column").append($("<option>",{value:d,text:d})),o=generateRow(i,l={data_type:a[n].data_type,column_type:a[n].column_type},r);let c=$(o);c.attr("data-include-detail","true"),c.attr("data-include-list","true"),c.attr("data-element-type","text"),c.attr("data-field-type",a[n].data_type),c.attr("data-maximum-length",a[n].maximum_length),c.attr("data-has-validation","false"),$(t).append(c)}if(void 0!==e.primary_keys&&e.primary_keys.length)for(let s in e.primary_keys){let p=e.primary_keys[s];$('[data-field-name="'+p+'"]').find('[name="include_key_'+p+'"]')[0].checked=!0}$('[name="module_load_previous"]')[0].checked?loadSavedModuleData($("#module_file").val(),$("#current_module_location").val(),function(){$(".define-wrapper").css("display","block"),$("#define-column-tab").click()}):($(".define-wrapper").css("display","block"),$("#define-column-tab").click()),loadDateTimeFormat()}})}function loadDateTimeFormat(){$("#data-list-date-format").load("lib.ajax/date-time-format.php")}function isTrue(e){return!0===e||"true"==e}function isSupportMultiple(e){return"text"==e||"select"==e}function isExactFilter(e){return!0===e||"true"==e}function restoreForm(e){if(void 0!==e.fields){for(let t in e.fields)if(e.fields.hasOwnProperty(t)){let a=$('.main-table tbody tr[data-field-name="'+e.fields[t].fieldName+'"]');if(a.length>0){a.appendTo(a.parent());let n=a.find(".include-insert")[0].disabled,i=a.find(".include-edit")[0].disabled;if(a.find(".include-insert")[0].checked=isTrue(e.fields[t].includeInsert)&&!n,a.find(".include-edit")[0].checked=isTrue(e.fields[t].includeEdit)&&!i,a.find(".include-detail")[0].checked=isTrue(e.fields[t].includeDetail),a.find(".include-list")[0].checked=isTrue(e.fields[t].includeList),a.find(".include-export")[0].checked=isTrue(e.fields[t].includeExport),a.find(".include-key")[0].checked=isTrue(e.fields[t].isKey),a.find(".include-required")[0].checked=isTrue(e.fields[t].isInputRequired),a.find('.input-element-type[value="'+e.fields[t].elementType+'"]')[0].checked=!0,a.find('.input-element-type[value="'+e.fields[t].elementType+'"]')[0].setAttribute("checked","checked"),isTrue(e.fields[t].includeDetail)?a.attr("data-include-detail","true"):a.attr("data-include-detail","false"),isTrue(e.fields[t].includeList)?a.attr("data-include-list","true"):a.attr("data-include-list","false"),"select"==e.fields[t].elementType&&(a.find(".reference-data").val(JSON.stringify(e.fields[t].referenceData)),a.find(".reference_button_data").css("display","inline")),"text"==e.fields[t].elementType){let l=e.fields[t].dataFormat||{};a.find(".input-format-data").val(JSON.stringify(l))}a.attr("data-element-type",e.fields[t].elementType),a.attr("data-type",e.fields[t].dataType),"select"==e.fields[t].filterElementType&&(a.find(".reference-filter").val(JSON.stringify(e.fields[t].referenceFilter)),a.find(".reference_button_filter").css("display","inline"),a.find('.input-field-filter[value="select"]')[0].checked=!0,a.find(".input-multiple-filter")[0].disabled=!1,a.find(".input-exact-filter")[0].disabled=!1),"text"==e.fields[t].filterElementType&&(a.find('.input-field-filter[value="text"]')[0].checked=!0,a.find(".input-multiple-filter")[0].disabled=!1,a.find(".input-exact-filter")[0].disabled=!1),isSupportMultiple(e.fields[t].elementType)?(a.find(".input-multiple-data")[0].disabled=!1,isTrue(e.fields[t].multipleData)&&(a.find(".input-multiple-data")[0].checked=!0)):a.find(".input-multiple-data")[0].disabled=!0,isSupportMultiple(e.fields[t].filterElementType)&&(a.find(".input-multiple-filter")[0].disabled=!1,isTrue(e.fields[t].multipleFilter)&&(a.find(".input-multiple-filter")[0].checked=!0)),isExactFilter(e.fields[t].exactFilter)&&(a.find(".input-exact-filter")[0].disabled=!1,isTrue(e.fields[t].exactFilter)&&(a.find(".input-exact-filter")[0].checked=!0)),a.find(".input-field-data-type").val(e.fields[t].dataType),a.find(".input-data-filter").val(e.fields[t].inputFilter)}}e.validator&&(validation=extractValidationDefinition(e.validator.validationDefinition),validatorBuilder.setValidation(validation),validatorBuilder.markValidation()),e.features?($("#activate_deactivate")[0].checked=isTrue(e.features.activateDeactivate),$("#manual_sort_order")[0].checked=isTrue(e.features.sortOrder),$("#export_to_excel")[0].checked=isTrue(e.features.exportToExcel),$("#export_to_csv")[0].checked=isTrue(e.features.exportToCsv),$("#export_use_temporary")[0].checked=isTrue(e.features.exportUseTemporary),isTrue(e.features.exportToCsv)?($("#export_to_excel")[0].disabled=!1,$("#export_use_temporary")[0].disabled=!1):($("#export_to_excel")[0].disabled=!1,$("#export_use_temporary")[0].disabled=!0),$("#user_activity_logger")[0].checked=isTrue(e.features.userActivityLogger),$("#with_approval")[0].checked=isTrue(e.features.approvalRequired),isTrue(e.features.approvalRequired)?($("#approval_by_other_user")[0].disabled=!1,$("#approval_type1")[0].disabled=!1,$("#approval_type2")[0].disabled=!1,$("#approval_position1")[0].disabled=!1,$("#approval_position2")[0].disabled=!1,$("#approval_bulk")[0].disabled=!1):($("#approval_by_other_user")[0].disabled=!0,$("#approval_type1")[0].disabled=!0,$("#approval_type2")[0].disabled=!0,$("#approval_position1")[0].disabled=!0,$("#approval_position2")[0].disabled=!0,$("#approval_bulk")[0].disabled=!0),$("#with_approval_note")[0].checked=isTrue(e.features.approvalNote),$("#approval_by_other_user")[0].checked=isTrue(e.features.approvalByAnotherUser),$("#with_trash")[0].checked=isTrue(e.features.trashRequired),$("#subquery")[0].checked=isTrue(e.features.subquery),$("#with_validation")[0].checked=isTrue(e.features.withValidation),$("#ajax_support")[0].checked=isTrue(e.features.ajaxSupport),$("#backend_only")[0].checked=isTrue(e.features.backendOnly),isTrue(e.features.backendOnly)?$("#ajax_support")[0].disabled=!0:$("#ajax_support")[0].disabled=!1,$('[name="approval_type"][value="'+e.features.approvalType+'"]')[0].checked=!0,$('[name="approval_position"][value="'+e.features.approvalPosition+'"]')[0].checked=!0):resetFeatureForm()}else resetFeatureForm();let o,r;for(o=0,r="#modal-filter-data tbody tr:last-child";$("#modal-filter-data tbody tr").length>1;)$(r).remove();if($(r).find(".data-filter-column-name").val(""),$(r).find(".data-filter-column-value").val(""),null==e.specification||void 0===e.specification&&0==e.specification.length)$(r).find(".data-filter-column-name").val(""),$(r).find(".data-filter-column-comparison").val(""),$(r).find(".data-filter-column-value").val("");else for(let d in e.specification)if(e.specification.hasOwnProperty(d)){if(o>0){let c=$(r)[0].outerHTML;$(r).parent().append(c)}let s=e.specification[d].column||"",p=e.specification[d].comparison||"",u=e.specification[d].value||"";null==s&&(s=""),null==u&&(u=""),null==p&&(p=""),""==p&&(p="equals"),$(r).find(".data-filter-column-name").val(s),$(r).find(".data-filter-column-comparison").val(p),$(r).find(".data-filter-column-value").val(u),o++}for(r="#modal-order-data tbody tr:last-child";$("#modal-order-data tbody tr").length>1;)$(r).remove();if($(r).find(".data-filter-column-name").val(""),$(r).find(".data-filter-column-value").val(""),o=0,e.sortable&&0!==e.sortable.length){for(let m in e.sortable)if(e.sortable.hasOwnProperty(m)){if(o>0){let f=$(r).clone(!0);$(r).parent().append(f)}$(r).find(".data-order-column-name").val(e.sortable[m].sortBy),$(r).find(".data-order-order-type").val(e.sortable[m].sortType),o++}}else $(r).find(".data-order-column-name").val(""),$(r).find(".data-order-order-type").val("PicoSort::ORDER_TYPE_ASC")}function resetFeatureForm(){$("#activate_deactivate")[0].checked=!1,$("#manual_sort_order")[0].checked=!1,$("#export_to_excel")[0].checked=!1,$("#export_to_csv")[0].checked=!1,$("#export_use_temporary")[0].checked=!1,$("#export_to_excel")[0].disabled=!1,$("#export_use_temporary")[0].disabled=!0,$("#user_activity_logger")[0].checked=!1,$("#with_approval")[0].checked=!1,$("#approval_by_other_user")[0].disabled=!0,$("#approval_type1")[0].disabled=!0,$("#approval_type2")[0].disabled=!0,$("#approval_position1")[0].disabled=!0,$("#approval_position2")[0].disabled=!0,$("#approval_bulk")[0].disabled=!0,$('[name="approval_type"][value="2"]')[0].checked=!0,$('[name="approval_position"][value="after-data"]')[0].checked=!0,$("#with_approval_note")[0].checked=!1,$("#approval_by_other_user")[0].checked=!1,$("#with_trash")[0].checked=!1,$("#backend_only")[0].checked=!1,$("#ajax_support")[0].checked=!1,$("#ajax_support")[0].disabled=!1,$("#subquery")[0].checked=!1}function loadSavedModuleData(e,t,a){increaseAjaxPending(),$.ajax({type:"GET",url:"lib.ajax/module-data.php",data:{moduleFile:e,target:t},dataType:"json",success:function(e){decreaseAjaxPending(),restoreForm(e),a()},error:function(e){a()}})}function generateSelectFilter(e,t){let a;(t=t||{}).column_type=t.column_type||"text";let n=t.column_type,i={FILTER_SANITIZE_BOOL:["tinyint(1)","bool","boolean",],FILTER_SANITIZE_NUMBER_INT:["bit","varbit","smallint","int","integer","bigint","smallserial","serial","bigserial","tinyint",],FILTER_SANITIZE_NUMBER_FLOAT:["numeric","double","real","money"],FILTER_SANITIZE_SPECIAL_CHARS:["char","character","varchar","character varying","text","date","timestamp","time",]};a=$(`
    <select class="form-control input-data-filter" name="filter_type_${e}" id="filter_type_${e}">
        <option value="FILTER_DEFAULT">DEFAULT</option>
        <option value="FILTER_SANITIZE_BOOL">BOOL</option>
        <option value="FILTER_SANITIZE_NUMBER_INT">NUMBER_INT</option>
        <option value="FILTER_SANITIZE_NUMBER_UINT">NUMBER_UINT</option>
        <option value="FILTER_SANITIZE_NUMBER_OCTAL">NUMBER_OCTAL</option>
        <option value="FILTER_SANITIZE_NUMBER_HEXADECIMAL">NUMBER_HEXADECIMAL</option>
        <option value="FILTER_SANITIZE_NUMBER_FLOAT">NUMBER_FLOAT</option>
        <option value="FILTER_SANITIZE_STRING">STRING</option>
        <option value="FILTER_SANITIZE_STRING_INLINE">STRING_INLINE</option>
        <option value="FILTER_SANITIZE_NO_DOUBLE_SPACE">NO_DOUBLE_SPACE</option>
        <option value="FILTER_SANITIZE_STRIPPED">STRIPPED</option>
        <option value="FILTER_SANITIZE_SPECIAL_CHARS">SPECIAL_CHARS</option>
        <option value="FILTER_SANITIZE_ALPHA">ALPHA</option>
        <option value="FILTER_SANITIZE_ALPHANUMERIC">ALPHANUMERIC</option>
        <option value="FILTER_SANITIZE_ALPHANUMERICPUNC">ALPHANUMERICPUNC</option>
        <option value="FILTER_SANITIZE_STRING_BASE64">STRING_BASE64</option>
        <option value="FILTER_SANITIZE_EMAIL">EMAIL</option>
        <option value="FILTER_SANITIZE_URL">URL</option>
        <option value="FILTER_SANITIZE_IP">IP</option>
        <option value="FILTER_SANITIZE_ENCODED">ENCODED</option>
        <option value="FILTER_SANITIZE_COLOR">COLOR</option>
        <option value="FILTER_SANITIZE_MAGIC_QUOTES">MAGIC_QUOTES</option>
        <option value="FILTER_SANITIZE_PASSWORD">PASSWORD</option>
    </select>
  `);let l,o,r,d="FILTER_SANITIZE_SPECIAL_CHARS",c=!1;for(l in i){for(r in o=i[l])if(-1!=n.toLowerCase().indexOf(o[r].toLowerCase())){d=l,c=!0;break}if(c)break}return a.find("option").each(function(e,t){$(this).removeAttr("selected")}),a.find('option[value="'+d+'"]').attr("selected","selected"),a[0].outerHTML}function generateDataFormat(e,t){return`<button type="button" id="format_data_${e}" class="btn btn-sm btn-primary button-format-data" data-type="${t.data_type}">Format</button><input type="hidden" class="input-format-data" value="">`}function generateSelectType(e,t){let a;(t=t||{}).data_type=t.data_type||"text";let n=t.data_type,i={int:["bit","varbit","smallint","int","integer","bigint","smallserial","serial","bigserial","bool","boolean",],float:["numeric","double","real","money"],text:["char","character","varchar","character varying","text"],"datetime-local":["datetime","timestamp"],color:["char","character","varchar","character varying","text"],month:["char","character","varchar","character varying","text"],week:["char","character","varchar","character varying","text"],date:["date"],time:["time"],file:["char","character","varchar","character varying","text"],image:["char","character","varchar","character varying","text"],audio:["char","character","varchar","character varying","text"],video:["char","character","varchar","character varying","text"]};a=$(`
    <select class="form-control input-field-data-type" name="data_type_${e}" id="data_type_${e}">
        <option value="text" title="&lt;input type=&#39;text&#39;&gt;">text</option>
        <option value="email" title="&lt;input type=&#39;email&#39;&gt;">email</option>
        <option value="url" title="&lt;input type=&#39;url&#39;&gt;">url</option>
        <option value="tel" title="&lt;input type=&#39;tel&#39;&gt;">tel</option>
        <option value="password" title="&lt;input type=&#39;password&#39;&gt;">password</option>
        <option value="int" title="&lt;input type=&#39;number&#39;&gt;">int</option>
        <option value="float" title="&lt;input type=&#39;number&#39; step=&#39;any&#39;&gt;">float</option>
        <option value="date" title="&lt;input type=&#39;date&#39;&gt;">date</option>
        <option value="time" title="&lt;input type=&#39;time&#39;&gt;">time</option>
        <option value="datetime-local" title="&lt;input type=&#39;datetime-local&#39;&gt;">datetime</option>
        <option value="month" title="&lt;input type=&#39;month&#39;&gt;">month</option>
        <option value="week" title="&lt;input type=&#39;week&#39;&gt;">week</option>
        <option value="color" title="&lt;input type=&#39;color&#39;&gt;">color</option>
        <option value="file" title="&lt;input type=&#39;file&#39;&gt;">file</option>
        <option value="image" title="&lt;input type=&#39;file&#39;&gt;">image</option>
        <option value="audio" title="&lt;input type=&#39;file&#39;&gt;">audio</option>
        <option value="video" title="&lt;input type=&#39;file&#39;&gt;">video</option>
    </select>
  `);let l,o,r,d="text",c=!1;for(l in i){for(r in o=i[l])if(-1!=n.toLowerCase().indexOf(o[r].toLowerCase())){d=l,c=!0;break}if(c)break}return a.find("option").each(function(e,t){$(this).removeAttr("selected")}),a.find('option[value="'+d+'"]').attr("selected","selected"),a[0].outerHTML}function arrayUnique(e){let t,a=[];for(t=0;t<e.length;t++)-1==a.indexOf(e[t])&&a.push(e[t]);return a}function isKeyWord(e){e=e.toString();let t,a=keyWords.split(",");for(t in a)if(e.equalIgnoreCase(a[t]))return!0;return!1}function generateRow(e,t,a){let n=isKeyWord(e),i=[],l="";i.push("row-column"),i.push("validation-item"),n&&i.push("reserved"),l=' class="'+i.join(" ")+'"';let o="",r="",d="",c="";return -1!=$.inArray(e,a)?(o=`
      <td align="center">
        <input type="checkbox" class="include-insert" name="include_insert_${e}" value="0" disabled="disabled">
      </td>
    `,r=`
      <td align="center">
        <input type="checkbox" class="include-edit" name="include_edit_${e}" value="0" disabled="disabled">
      </td>
    `,d=`
      <td align="center">
        <input type="checkbox" class="include-list" name="include_list_${e}" value="1">
      </td>
    `):(o=`
      <td align="center">
        <input type="checkbox" class="include-insert" name="include_insert_${e}" value="1" checked="checked">
      </td>
    `,r=`
      <td align="center">
        <input type="checkbox" class="include-edit" name="include_edit_${e}" value="1" checked="checked">
      </td>
    `,d=`
      <td align="center">
        <input type="checkbox" class="include-list" name="include_list_${e}" value="1" checked="checked">
      </td>
    `),`
    <tr data-field-name="${e}" ${l}>
      <td class="data-sort data-sort-body data-sort-handler"></td>
      <td class="field-name">
        ${e}
        <input type="hidden" name="field" value="${e}">
      </td>
      <td>
        <input type="hidden" class="input-field-name" name="caption_${e}" 
          value="${e.replaceAll("_"," ").capitalize().prettify().trim()}" 
          autocomplete="off" spellcheck="false">
        ${e.replaceAll("_"," ").capitalize().prettify().trim()}
      </td>
      ${o} ${r}
      <td align="center">
        <input type="checkbox" class="include-detail" name="include_detail_${e}" value="1" checked="checked">
      </td>
      ${d}
      ${c=`
    <td align="center">
      <input type="checkbox" class="include-export" name="include_export_${e}" value="1" checked="checked">
    </td>
  `}
      <td align="center">
        <input type="checkbox" class="include-key" name="include_key_${e}" value="1">
      </td>
      <td align="center">
        <input type="checkbox" class="include-required" name="include_required_${e}" value="1">
      </td>
      <td align="center">
        <input type="radio" class="input-element-type" name="element_type_${e}" value="text" checked="checked">
      </td>
      <td align="center">
        <input type="radio" class="input-element-type" name="element_type_${e}" value="textarea">
      </td>
      <td align="center">
        <input type="radio" class="input-element-type" name="element_type_${e}" value="checkbox">
      </td>
      <td align="center">
        <input type="radio" class="input-element-type" name="element_type_${e}" value="select">
      </td>
      <td align="center">
        <input type="hidden" class="reference-data" name="reference_data_${e}" value="{}">
        <button type="button" class="btn btn-sm btn-primary reference-button reference_button_data">Source</button>
      </td>
      <td align="center">
        <input type="checkbox" class="input-multiple-data" name="multiple_data_${e}" value="1">
      </td>
      <td align="center">
        <input type="checkbox" name="list_filter_${e}" value="text" class="input-field-filter">
      </td>
      <td align="center">
        <input type="checkbox" name="list_filter_${e}" value="select" class="input-field-filter">
      </td>
      <td align="center">
        <input type="hidden" class="reference-filter" name="reference_filter_${e}" value="{}">
        <button type="button" class="btn btn-sm btn-primary reference-button reference_button_filter">Source</button>
      </td>
      <td align="center">
        <input type="checkbox" class="input-multiple-filter" name="multiple_filter_${e}" value="1" disabled="disabled">
      </td>
      <td align="center">
        <input type="checkbox" class="input-exact-filter" name="exact_filter_${e}" value="1" disabled="disabled">
      </td>
      <td>
        ${generateSelectType(e,t)}
      </td>
      <td>
        ${generateDataFormat(e,t)}
      </td>
      <td>
        ${generateSelectFilter(e,t)}
      </td>
      <td>
        <button type="button" class="btn btn-sm btn-primary validation-button">Validation</button>
      </td>
    </tr>
  `}function serializeForm(){let e=null;$(".reference_type").each(function(t){$(this)[0].checked&&(e=$(this).val())});let t=getEntityData(),a=getMapData();return{type:e,entity:t,map:a,yesno:null,truefalse:null,onezero:null}}function deserializeForm(e){$("#modal-create-reference-data").find(".modal-body").empty(),$("#modal-create-reference-data").find(".modal-body").append(getReferenceResource()),selectReferenceType(e),setEntityData(e),setMapData(e)}function addRow(e){let t=e.find("tbody").find("tr:last-child").prop("outerHTML");return e.find("tbody").append(t),e.find("tbody").find("tr:last-child")}function addColumn(e){let t=e.find("thead").find("tr").find("td").length-parseInt(e.attr("data-offset"))-2;e.find("thead").find("tr").find("td:nth("+t+")").after('<td><input class="form-control rd-map-key" type="text" value="" placeholder="Additional attribute name"></td>'),e.find("tbody").find("tr").each(function(e){$(this).find("td:nth("+t+")").after('<td><input class="form-control rd-map-value" type="text" value="" placeholder="Additional attribute value"></td>')}),e.find("tfoot").find("tr").find("td").attr("colspan",e.find("thead").find("tr").find("td").length+1)}function removeLastColumn(e){let t=e.find("thead").find("tr").find("td").length,a=parseInt(e.attr("data-offset")),n=parseInt(e.attr("data-number-of-column")),i=t-a-2;i>n?(e.find("thead").find("tr").find("td:nth("+i+")").remove(),e.find("tbody").find("tr").each(function(e){$(this).find("td:nth("+i+")").remove()}),e.find("tfoot").find("tr").find("td").attr("colspan",e.find("thead").find("tr").find("td").length+1)):(e.find("thead").find("tr").find("td:nth("+i+")").find(":input").val(""),e.find("tbody").find("tr").each(function(e){$(this).find("td:nth("+i+")").find(":input").val("")}))}function clearGroup(e){asyncAlert("Do you want to clear the groups?","Confirmation",[{caption:"Yes",fn(){e.find(".rd-group").val("")},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}function selectReferenceType(e){let t=e.type?e.type:"entity",a=$("#modal-create-reference-data .modal-dialog");"entity"==t||"map"==t?(a.addClass("modal-lg"),a.hasClass("modal-md")&&a.removeClass("modal-md")):(a.addClass("modal-md"),a.hasClass("modal-lg")&&a.removeClass("modal-lg")),$('.reference_type[value="'+t+'"]').length>0&&($('.reference_type[value="'+t+'"]')[0].checked=!0),$(".reference-section").css({display:"none"}),"entity"==t?$(".entity-section").css({display:"block"}):"map"==t&&$(".map-section").css({display:"block"})}function setEntityData(e){e.entity=e&&e.entity?e.entity:{};let t=e.entity;t.entityName=t.entityName?t.entityName:"",t.tableName=t.tableName?t.tableName:"",t.primaryKey=t.primaryKey?t.primaryKey:"",t.value=t.value?t.value:"",t.objectName=t.objectName?t.objectName:"",t.propertyName=t.propertyName?t.propertyName:"",t.textNodeFormat=t.textNodeFormat?t.textNodeFormat:"",t.indent=t.indent?t.indent:"";let a='[data-name="entity"]';$(a).find(".rd-entity-name").val(t.entityName),$(a).find(".rd-table-name").val(t.tableName),$(a).find(".rd-primary-key").val(t.primaryKey),$(a).find(".rd-value-column").val(t.value),$(a).find(".rd-reference-object-name").val(t.objectName),$(a).find(".rd-reference-property-name").val(t.propertyName),$(a).find(".rd-option-text-node-format").val(t.textNodeFormat),$(a).find(".rd-option-indent").val(t.indent),setSpecificationData(e),setSortableData(e),setGroupData(e),setAdditionalOutputData(e)}function getEntityData(){let e='[data-name="entity"]';return{entityName:$(e).find(".rd-entity-name").val().trim(),tableName:$(e).find(".rd-table-name").val().trim(),primaryKey:$(e).find(".rd-primary-key").val().trim(),value:$(e).find(".rd-value-column").val().trim(),objectName:$(e).find(".rd-reference-object-name").val().trim(),propertyName:$(e).find(".rd-reference-property-name").val().trim(),textNodeFormat:$(e).find(".rd-option-text-node-format").val(),indent:$(e).find(".rd-option-indent").val(),specification:getSpecificationData(),sortable:getSortableData(),group:getGroupData(),additionalOutput:getAdditionalOutputData()}}function setSpecificationData(e){let t=$('[data-name="specification"]'),a=e.entity.specification;if(void 0!==a&&null!=a&&a.length>0)for(let n in a){n>0&&addRow(t);let i=t.find("tr:last-child"),l=a[n],o=l.comparison,r=l.column,d=l.value;void 0===r&&(r=""),void 0===d&&(d=""),void 0===o&&(o=""),""==o&&(o="equals"),i.find(".rd-column-name").val(r),i.find(".rd-comparison").val(o),i.find(".rd-value").val(d)}}function getSpecificationData(){let e=[];return $('[data-name="specification"]').find("tbody").find("tr").each(function(t){let a=$(this),n=a.find(".rd-column-name").val(),i=a.find(".rd-value").val(),l=a.find(".rd-comparison").val();void 0===n&&(n=""),void 0===i&&(i=""),void 0===l&&(l=""),""==l&&(l="equals"),""==l&&(l="equals"),n.length>0&&e.push({column:n.trim(),value:fixValue(i.trim()),comparison:l.trim()})}),e}function setSortableData(e){let t=$('[data-name="sortable"]'),a=e.entity.sortable;if(void 0!==a&&null!=a&&a.length>0)for(let n in a){n>0&&addRow(t);let i=t.find("tr:last-child"),l=a[n];i.find(".rd-column-name").val(l.sortBy),i.find(".rd-order-type").val(l.sortType)}}function getSortableData(){let e=[];return $('[data-name="sortable"]').find("tbody").find("tr").each(function(t){let a=$(this),n=a.find(".rd-column-name").val().trim(),i=a.find(".rd-order-type").val().trim();n.length>0&&e.push({sortBy:n,sortType:i})}),e}function setGroupData(e){let t=$('[data-name="grouping"]');if(e&&e.entity&&e.entity.group){t.attr("data-group-source",e.entity.group.source),t.find(".rd-group-value").val(e.entity.group.value),t.find(".rd-group-label").val(e.entity.group.label),t.find(".group-reference").filter('[value="'+e.entity.group.source+'"]')[0].checked=!0,t.find(".rd-group-entity").val(e.entity.group.entity);let a=t.find("table.table-reference"),n=e.entity.group;if(n&&Array.isArray(n.map)&&n.map.length>0)for(let i in n.map){i>0&&addRow(a);let l=a.find("tr:last-child"),o=n.map[i];l.find(".rd-map-value").val(o.value),l.find(".rd-map-label").val(o.label)}}}function getGroupData(){let e={},t=[],a=$('[data-name="grouping"]'),n=a.find(".rd-group-value").val(),i=a.find(".rd-group-label").val(),l=a.find(".group-reference:checked").val(),o=a.find(".rd-group-entity").val();return e.value=n,e.label=i,e.source=l,e.entity=o,$(a).find(".table-reference tbody tr").each(function(){let e=$(this),a=e.find(".rd-map-value").val().trim(),n=e.find(".rd-map-label").val().trim();a.length>0&&t.push({value:a,label:n})}),e.map=t,e}function setAdditionalOutputData(e){let t=$('[data-name="additional-output"]'),a=e.entity.additionalOutput;if(void 0!==a&&null!=a&&a.length>0)for(let n in a){n>0&&addRow(t);let i=t.find("tr:last-child"),l=a[n];i.find(".rd-column-name").val(l.column)}}function getAdditionalOutputData(){let e=[];return $('[data-name="additional-output"]').find("tbody").find("tr").each(function(t){let a=$(this).find(".rd-column-name").val().trim();a.length>0&&e.push({column:a})}),e}function setMapData(e){let t=$('[data-name="map"]'),a=[];e.map=e.map?e.map:[];let n=e.map;if(n.length>0){let i=n[0],l=0;for(let o in i)i.hasOwnProperty(o)&&(++l>5&&addColumn(t),"value"!=o&&"label"!=o&&"group"!=o&&"selected"!=o&&a.push(o));for(let r in a)t.find("thead tr .rd-map-key")[r].value=a[r];for(let d in n){d>0&&addRow(t);let c=t.find("tr:last-child"),s=n[d];for(let p in c.find(".rd-value").val(s.value),c.find(".rd-label").val(s.label),c.find(".rd-group").val(s.group),isTrue(n[d].selected)&&(c.find(".rd-selected")[0].checked=!0),a)c.find(".rd-map-value")[p].value=n[d][a[p]]}}}function getMapData(){let e=[],t='[data-name="map"]',a=[];return $(t).find("thead").find("tr").find(".rd-map-key").length>0&&$(t).find("thead").find("tr").find(".rd-map-key").each(function(e){a.push($(this).val().trim())}),$(t).find("tbody").find("tr").each(function(t){let n=$(this),i=n.find(".rd-value").val().trim(),l=n.find(".rd-label").val().trim(),o,r={value:i,label:l,group:n.find(".rd-group").val().trim(),selected:n.find(".rd-selected")[0].checked?"true":"false"};if(a.length>0){let d=0;n.find(".rd-map-value").each(function(e){let t=$(this).val();a[d].length>0&&(r[a[d]]=t),d++})}e.push(r)}),e}function fixValue(e){return"true"==e||"false"!=e&&("null"==e?null:isNumeric(e)?parseNumber(e):e)}function parseNumber(e){return -1!==e.indexOf(".")?parseFloat(e):parseInt(e)}function isNumeric(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}function setLanguage(e){$("select.target-language").each(function(){let t=$(this);for(let a in t.empty(),e)t[0].options[t[0].options.length]=new Option(e[a].name+" - "+e[a].code,e[a].code)})}function getReferenceResource(){return referenceResource}function loadTranslation(e,t){let a=$(".container-translate-app .target-language").val();increaseAjaxPending(),$.ajax({method:"GET",url:e,data:{userAction:"get",targetLanguage:a},success:function(e){appTranslationData=e,decreaseAjaxPending(),$(".module-translation-status").text("");let a=[],n=[],i=[];for(let l of e)a.push(l.original),n.push(l.translated),i.push(l.propertyName);transEd5.getDoc().setValue(a.join("\r\n")),transEd6.getDoc().setValue(n.join("\r\n")),setTimeout(()=>{transEd5.refresh(),transEd6.refresh()},50),$(".app-property-name").val(i.join("|")),$("#app_translation_type").val(t),focused={},transEd5.removeLineClass(lastLine2,"background","highlight-line"),transEd6.removeLineClass(lastLine2,"background","highlight-line"),lastLine2=-1},error:function(e){decreaseAjaxPending()}})}function loadAppTranslation(){let e=$("#app_translation_type").val(),t="";"menu"==e?t="lib.ajax/menu-translate.php":"menu-group"==e?t="lib.ajax/menu-group-translate.php":"validation"==e&&(t="lib.ajax/validation-translate.php"),loadTranslation(t,e)}function loadMenuTranslation(){loadTranslation("lib.ajax/menu-translate.php","menu")}function loadMenuGroupTranslation(){loadTranslation("lib.ajax/menu-group-translate.php","menu-group")}function loadValidationTranslation(){loadTranslation("lib.ajax/validation-translate.php","validation")}