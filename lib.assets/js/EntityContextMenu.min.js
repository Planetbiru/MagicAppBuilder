let selectedElement=null;function hideContextMenu(){document.querySelectorAll(".context-menu").forEach(e=>{e.style.display="none"})}function initDiagramContextMenu(e){let t=document.querySelector("#context-menu");e.addEventListener("contextmenu",function(e){let n=e.target.closest("g.svg-entity");if(selectedElement=n,n){e.preventDefault(),t.style.top=`${e.pageY}px`,t.style.left=`${e.pageX}px`,t.style.display="block";let l=document.querySelector("#menu-make-reference"),a=document.querySelector("#reference-submenu"),c=null;a.querySelectorAll("li").forEach(e=>{let t=e.querySelector("input");t&&"id1"===t.id?c=t:e.remove()});let r=renderReferenceSubmenu(n,a),i=r.count;null!=c&&(c.checked=r.count==r.checked),l.style.display=i>0?"block":"none";let o=window.innerWidth,d=e.pageX>o/2;a.style.left=d?"-240px":"96%",a.style.right=d?"96%":"auto"}else t.style.display="none"})}function initAllEntitiesContextMenu(e){let t=document.querySelector("#context-menu-all-entities");e.addEventListener("contextmenu",function(e){let n=e.target.closest("g.svg-entity");selectedElement=n,n?(e.preventDefault(),t.style.top=`${e.pageY}px`,t.style.left=`${e.pageX}px`,t.style.display="block"):t.style.display="none"})}function renderReferenceSubmenu(e,t){let n=e.dataset.entity,l=e.querySelectorAll(".diagram-column-name"),a=0,c=0;return l.forEach((e,l)=>{let r=e.textContent.trim(),i=r.substring(0,r.length-3);if(i!==n&&r.endsWith("_id")){let o=document.querySelector(`.table-list input[data-name="${i}"]`);if(o){let d=document.createElement("li"),u=document.createElement("input"),s=`reference-checkbox-${l}`;u.type="checkbox",u.dataset.name=i,u.id=s;let p=isSelectedTable(i);u.checked=p,p&&c++,u.addEventListener("change",selectTable);let y=document.createElement("label");y.setAttribute("for",s),y.textContent=` ${r}`,d.appendChild(u),d.appendChild(y),t.appendChild(d),a++}}}),{count:a,checked:c}}function renderContextMenu(e){let t=document.querySelector("#context-menu"),n=t.querySelector("ul"),l=e.dataset.entity,a=e.querySelectorAll(".diagram-column-name"),c=0;return a.forEach((e,t)=>{let a=e.textContent.trim(),r=a.substring(0,a.length-3);if(r!=l&&a.endsWith("_id")&&null!=document.querySelector(`.table-list input[data-name="${r}"]`)){let i=document.createElement("li");i.dataset.type="relation";let o=document.createElement("label"),d=document.createElement("input"),u=`relation-${t}`;d.type="checkbox",d.id=u,d.dataset.name=r,d.addEventListener("change",function(e){selectTable(e)}),d.checked=isSelectedTable(r),o.setAttribute("for",u),o.appendChild(d);let s=` ${a}`;o.appendChild(document.createTextNode(s)),i.appendChild(o),n.appendChild(i),c++}}),c}function selectTable(e){let t=e.target.dataset.name,n=document.querySelector(`.table-list input[data-name="${t}"]`);null!=n&&(n.checked=e.target.checked,n.dispatchEvent(new Event("change",{bubbles:!0})))}function isSelectedTable(e){let t=document.querySelector(`.table-list input[data-name="${e}"]`);return!!t&&t.checked}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(e){document.querySelectorAll(".context-menu").forEach(t=>{e.target.closest(".context-menu")||(t.style.display="none")})})});