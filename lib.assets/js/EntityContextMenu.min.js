let selectedElement=null;function hideContextMenu(){let e=document.querySelector("#context-menu");e.style.display="none"}function initDiagramContextMenu(e){let t=document.querySelector("#context-menu");e.addEventListener("contextmenu",function(e){let n=e.target.closest("g.svg-entity");if(selectedElement=n,n){e.preventDefault(),t.style.top=`${e.pageY}px`,t.style.left=`${e.pageX}px`,t.style.display="block";let l=document.querySelector("#menu-make-reference"),a=document.querySelector("#reference-submenu");a.querySelectorAll("li").forEach(e=>{let t=e.querySelector("input");t&&"id1"===t.id?t.checked=!1:e.remove()});let r=renderReferenceSubmenu(n,a);l.style.display=r>0?"block":"none";let c=window.innerWidth,i=e.pageX>c/2;a.style.left=i?"-240px":"97%",a.style.right=i?"97%":"auto"}else t.style.display="none"})}function renderReferenceSubmenu(e,t){let n=e.dataset.entity,l=e.querySelectorAll(".diagram-column-name"),a=0;return l.forEach((e,l)=>{let r=e.textContent.trim(),c=r.substring(0,r.length-3);if(c!==n&&r.endsWith("_id")){let i=document.querySelector(`.table-list input[data-name="${c}"]`);if(i){let d=document.createElement("li"),u=document.createElement("input"),o=`reference-checkbox-${l}`;u.type="checkbox",u.checked=isSelectedTable(c),u.dataset.name=c,u.id=o,u.addEventListener("change",selectTable);let s=document.createElement("label");s.setAttribute("for",o),s.textContent=` ${r}`,d.appendChild(u),d.appendChild(s),t.appendChild(d),a++}}}),a}function renderContextMenu(e){let t=document.querySelector("#context-menu"),n=t.querySelector("ul"),l=e.dataset.entity,a=e.querySelectorAll(".diagram-column-name"),r=0;return a.forEach((e,t)=>{let a=e.textContent.trim(),c=a.substring(0,a.length-3);if(c!=l&&a.endsWith("_id")&&null!=document.querySelector(`.table-list input[data-name="${c}"]`)){let i=document.createElement("li");i.dataset.type="relation";let d=document.createElement("label"),u=document.createElement("input"),o=`relation-${t}`;u.type="checkbox",u.id=o,u.dataset.name=c,u.addEventListener("change",function(e){selectTable(e)}),u.checked=isSelectedTable(c),d.setAttribute("for",o),d.appendChild(u);let s=` ${a}`;d.appendChild(document.createTextNode(s)),i.appendChild(d),n.appendChild(i),r++}}),r}function selectTable(e){let t=e.target.dataset.name,n=document.querySelector(`.table-list input[data-name="${t}"]`);null!=n&&(n.checked=e.target.checked,n.dispatchEvent(new Event("change",{bubbles:!0})))}function isSelectedTable(e){let t=document.querySelector(`.table-list input[data-name="${e}"]`);return!!t&&t.checked}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(e){let t=document.querySelector("#context-menu");e.target.closest("#context-menu")||(t.style.display="none")})});