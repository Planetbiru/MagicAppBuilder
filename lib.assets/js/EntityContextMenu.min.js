let selectedElement=null;function hideContextMenu(){let e=document.querySelector("#context-menu");e.style.display="none"}function initDiagramContextMenu(e){let t=document.querySelector("#context-menu");e.addEventListener("contextmenu",function(e){let n=e.target.closest("g.svg-entity");if(selectedElement=n,n){e.preventDefault(),t.style.top=`${e.pageY}px`,t.style.left=`${e.pageX}px`,t.style.display="block";let l=document.querySelector("#menu-make-reference"),a=document.querySelector("#reference-submenu"),c=null;a.querySelectorAll("li").forEach(e=>{let t=e.querySelector("input");t&&"id1"===t.id?c=t:e.remove()});let r=renderReferenceSubmenu(n,a),i=r.count;null!=c&&(c.checked=r.count==r.checked),l.style.display=i>0?"block":"none";let d=window.innerWidth,u=e.pageX>d/2;a.style.left=u?"-240px":"97%",a.style.right=u?"97%":"auto"}else t.style.display="none"})}function renderReferenceSubmenu(e,t){let n=e.dataset.entity,l=e.querySelectorAll(".diagram-column-name"),a=0,c=0;return l.forEach((e,l)=>{let r=e.textContent.trim(),i=r.substring(0,r.length-3);if(i!==n&&r.endsWith("_id")){let d=document.querySelector(`.table-list input[data-name="${i}"]`);if(d){let u=document.createElement("li"),o=document.createElement("input"),s=`reference-checkbox-${l}`;o.type="checkbox",o.dataset.name=i,o.id=s;let p=isSelectedTable(i);o.checked=p,p&&c++,o.addEventListener("change",selectTable);let m=document.createElement("label");m.setAttribute("for",s),m.textContent=` ${r}`,u.appendChild(o),u.appendChild(m),t.appendChild(u),a++}}}),{count:a,checked:c}}function renderContextMenu(e){let t=document.querySelector("#context-menu"),n=t.querySelector("ul"),l=e.dataset.entity,a=e.querySelectorAll(".diagram-column-name"),c=0;return a.forEach((e,t)=>{let a=e.textContent.trim(),r=a.substring(0,a.length-3);if(r!=l&&a.endsWith("_id")&&null!=document.querySelector(`.table-list input[data-name="${r}"]`)){let i=document.createElement("li");i.dataset.type="relation";let d=document.createElement("label"),u=document.createElement("input"),o=`relation-${t}`;u.type="checkbox",u.id=o,u.dataset.name=r,u.addEventListener("change",function(e){selectTable(e)}),u.checked=isSelectedTable(r),d.setAttribute("for",o),d.appendChild(u);let s=` ${a}`;d.appendChild(document.createTextNode(s)),i.appendChild(d),n.appendChild(i),c++}}),c}function selectTable(e){let t=e.target.dataset.name,n=document.querySelector(`.table-list input[data-name="${t}"]`);null!=n&&(n.checked=e.target.checked,n.dispatchEvent(new Event("change",{bubbles:!0})))}function isSelectedTable(e){let t=document.querySelector(`.table-list input[data-name="${e}"]`);return!!t&&t.checked}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(e){let t=document.querySelector("#context-menu");e.target.closest("#context-menu")||(t.style.display="none")})});