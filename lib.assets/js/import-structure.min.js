function init(){let e=document.getElementById("queryTranslatorModal"),t=document.getElementById("entityEditorModal"),a=document.querySelectorAll(".cancel-button"),r=document.querySelector(".import-structure"),n=document.querySelector(".open-entity-editor"),o=document.querySelector(".open-structure"),i=document.querySelector(".translate-structure"),l=document.querySelector(".import-from-entity"),c=document.querySelector(".clear"),s=document.querySelector(".original"),d=document.querySelector(".query-generated"),u=document.querySelector('[name="query"]'),y=document.querySelectorAll(".cell-delete a");r.onclick=function(){e.style.display="block",s.focus()},n.onclick=function(){t.style.display="block",resizablePanels.loadPanelWidth()},a.forEach(function(e){e.onclick=function(e){e.target.closest(".modal").style.display="none"}}),c.onclick=function(){s.value=""},i.onclick=function(){let t=s.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),r=converter.translate(t,a);document.querySelector('[name="query"]').value=r,e.style.display="none"},o.onclick=function(){document.querySelector(".structure-sql").click()},l.onclick=function(){let e=d.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),r="";r="mysql"!=a.toLowerCase()&&"mariadb"!=a.toLowerCase()?converter.translate(e,a):e,document.querySelector('[name="query"]').value=r,t.style.display="none"},y.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let t=e.target.getAttribute("data-schema"),a=e.target.getAttribute("data-table"),r=e.target.getAttribute("data-primary-key"),n=e.target.getAttribute("data-value"),o="";o=`DELETE FROM ${""==t?`${t}.${a}`:a} WHERE ${r} = '${n}';\r
`;u.value.startsWith("DELETE FROM ")&&(o=u.value+o),u.value=o})}),window.onclick=function(t){t.target==e&&(e.style.display="none")},document.querySelector(".structure-sql").addEventListener("change",function(e){openStructure(this.files[0])}),document.querySelector(".draw-relationship").addEventListener("change",function(e){editor.renderEntities()})}function openStructure(e){let t=new FileReader;t.onload=function(e){try{document.querySelector(".original").value=e.target.result}catch(t){console.log("Error parsing JSON: "+t.message)}},t.readAsText(e)}const converter=new SQLConverter;let editor,renderer,resizablePanels;function sendEntityToServer(e,t,a,r,n){let o={applicationId:e,databaseType:t,databaseName:a,databaseSchema:r,entities:JSON.stringify(n)},i=new XMLHttpRequest,l=buildUrl("entity",e,t,a,r,"");i.open("POST",l,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||console.log("An error occurred while sending data to the server"))};let c=new URLSearchParams(o).toString();i.send(c)}function fetchEntityFromServer(e,t,a,r,n,o){let i=new XMLHttpRequest,l=buildUrl("entity",e,t,a,r,"");i.open("GET",l,!0),i.onreadystatechange=function(){if(4===i.readyState){if(200===i.status){let e=i.responseText;try{let t=JSON.parse(e);editor.entities=editor.createEntitiesFromJSON(t),editor.renderEntities(),o&&o(null,t)}catch(a){}}else console.error("An error occurred while fetching data from the server. Status:",i.status)}},i.send()}function sendTemplateToServer(e,t,a,r,n){let o={applicationId:e,databaseType:t,databaseName:a,databaseSchema:r,template:JSON.stringify(n)},i=new XMLHttpRequest,l=buildUrl("template",e,t,a,r,"");i.open("POST",l,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||console.log("An error occurred while sending data to the server"))};let c=new URLSearchParams(o).toString();i.send(c)}function fetchTemplateFromServer(e,t,a,r,n,o){let i=new XMLHttpRequest,l=buildUrl("template",e,t,a,r,"");i.open("GET",l,!0),i.onreadystatechange=function(){if(4===i.readyState){if(200===i.status){let e=i.responseText;try{let t=JSON.parse(e);editor.template=editor.createTemplateFromJSON(t)}catch(a){console.error(a)}}else console.error("An error occurred while fetching data from the server. Status:",i.status)}},i.send()}function buildUrl(e,t,a,r,n,o){return"template"==e?`lib.ajax/load-template-data.php?applicationId=${encodeURIComponent(t)}&databaseType=${encodeURIComponent(a)}&databaseName=${encodeURIComponent(r)}&databaseSchema=${encodeURIComponent(n)}&entities=${encodeURIComponent(JSON.stringify(o))}`:`lib.ajax/load-entity-data.php?applicationId=${encodeURIComponent(t)}&databaseType=${encodeURIComponent(a)}&databaseName=${encodeURIComponent(r)}&databaseSchema=${encodeURIComponent(n)}&entities=${encodeURIComponent(JSON.stringify(o))}`}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll(".collapsible .button-toggle"),t=document.querySelector(".erd-svg");renderer=new EntityRenderer(t),e.forEach(function(e){e.addEventListener("click",function(e){e.target.closest(".collapsible").classList.toggle("open")})}),editor=new EntityEditor(".entity-editor",{defaultDataType:"VARCHAR",defaultDataLength:50,primaryKeyDataType:"BIGINT",primaryKeyDataLength:20,callbackLoadEntity:function(){let e=document.querySelector('meta[name="application-id"]').getAttribute("content"),t=document.querySelector('meta[name="database-name"]').getAttribute("content"),a=document.querySelector('meta[name="database-schema"]').getAttribute("content");fetchEntityFromServer(e,document.querySelector('meta[name="database-type"]').getAttribute("content"),t,a)},callbackSaveEntity:function(e){let t=document.querySelector('meta[name="application-id"]').getAttribute("content"),a=document.querySelector('meta[name="database-name"]').getAttribute("content"),r=document.querySelector('meta[name="database-schema"]').getAttribute("content");sendEntityToServer(t,document.querySelector('meta[name="database-type"]').getAttribute("content"),a,r,e)},callbackLoadTemplate:function(){let e=document.querySelector('meta[name="application-id"]').getAttribute("content"),t=document.querySelector('meta[name="database-name"]').getAttribute("content"),a=document.querySelector('meta[name="database-schema"]').getAttribute("content");fetchTemplateFromServer(e,document.querySelector('meta[name="database-type"]').getAttribute("content"),t,a)},callbackSaveTemplate:function(e){let t=document.querySelector('meta[name="application-id"]').getAttribute("content"),a=document.querySelector('meta[name="database-name"]').getAttribute("content"),r=document.querySelector('meta[name="database-schema"]').getAttribute("content"),n=document.querySelector('meta[name="database-type"]').getAttribute("content");console.log(e),sendTemplateToServer(t,n,a,r,e)}}),document.addEventListener("click",function(e){e.target.closest(".erd-svg .move-down-icon")&&editor.moveEntityUp(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .move-up-icon")&&editor.moveEntityDown(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .edit-icon")&&editor.editEntity(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .delete-icon")&&editor.deleteEntity(parseInt(e.target.getAttribute("data-index")))}),window.addEventListener("resize",function(){editor.renderEntities()}),resizablePanels=new ResizablePanels(".entity-editor",".left-panel",".right-panel",".resize-bar",200),init()});