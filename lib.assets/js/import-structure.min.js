function init(){let e=document.getElementById("queryTranslatorModal"),t=document.getElementById("entityEditorModal"),r=document.querySelectorAll(".cancel-button"),a=document.querySelector(".import-structure"),n=document.querySelector(".open-entity-editor"),i=document.querySelector(".open-structure"),o=document.querySelector(".translate-structure"),l=document.querySelector(".import-from-entity"),c=document.querySelector(".clear"),u=document.querySelector(".original"),s=document.querySelector(".query-generated"),d=document.querySelector('[name="query"]'),y=document.querySelectorAll(".cell-delete a");a.onclick=function(){e.style.display="block",u.focus()},n.onclick=function(){t.style.display="block",resizablePanels.loadPanelWidth()},r.forEach(function(e){e.onclick=function(e){e.target.closest(".modal").style.display="none"}}),c.onclick=function(){u.value=""},o.onclick=function(){let t=u.value,r=document.querySelector('meta[name="database-type"]').getAttribute("content"),a=converter.translate(t,r);document.querySelector('[name="query"]').value=a,e.style.display="none"},i.onclick=function(){document.querySelector(".structure-sql").click()},l.onclick=function(){let e=s.value,r=document.querySelector('meta[name="database-type"]').getAttribute("content"),a=converter.translate(e,r);document.querySelector('[name="query"]').value=a,t.style.display="none"},y.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let t=e.target.getAttribute("data-schema"),r=e.target.getAttribute("data-table"),a=e.target.getAttribute("data-primary-key"),n=e.target.getAttribute("data-value"),i="";i=`DELETE FROM ${""==t?`${t}.${r}`:r} WHERE ${a} = '${n}';\r
`;d.value.startsWith("DELETE FROM ")&&(i=d.value+i),d.value=i})}),window.onclick=function(t){t.target==e&&(e.style.display="none")},document.querySelector(".structure-sql").addEventListener("change",function(e){openStructure(this.files[0])}),document.querySelector(".draw-relationship").addEventListener("change",function(e){editor.renderEntities()})}function openStructure(e){let t=new FileReader;t.onload=function(e){try{document.querySelector(".original").value=e.target.result}catch(t){console.log("Error parsing JSON: "+t.message)}},t.readAsText(e)}const converter=new SQLConverter;let editor,renderer,resizablePanels;function sendToServer(e,t,r,a,n){let i={applicationId:e,databaseType:t,databaseName:r,databaseSchema:a,entities:JSON.stringify(n)},o=new XMLHttpRequest;o.open("POST","lib.ajax/entity-structure.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status||console.log("An error occurred while sending data to the server"))};let l=new URLSearchParams(i).toString();o.send(l)}function fetchDataFromServer(e,t,r,a,n,i){let o=new XMLHttpRequest,l=buildUrl(e,t,r,a,n);o.open("GET",l,!0),o.onreadystatechange=function(){if(4===o.readyState){if(200===o.status){let e=o.responseText;try{let t=JSON.parse(e);editor.entities=editor.createEntitiesFromJSON(t),editor.renderEntities(),i&&i(null,t)}catch(r){}}else console.error("An error occurred while fetching data from the server. Status:",o.status)}},o.send()}function buildUrl(e,t,r,a,n){return`lib.ajax/entity-structure.php?applicationId=${encodeURIComponent(e)}&databaseType=${encodeURIComponent(t)}&databaseName=${encodeURIComponent(r)}&databaseSchema=${encodeURIComponent(a)}&entities=${encodeURIComponent(JSON.stringify(n))}`}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll(".collapsible .button-toggle"),t=document.querySelector(".erd-svg");renderer=new EntityRenderer(t),e.forEach(function(e){e.addEventListener("click",function(e){e.target.closest(".collapsible").classList.toggle("open")})}),editor=new EntityEditor(".entity-editor",{defaultDataType:"VARCHAR",defaultDataLength:50,primaryKeyDataType:"BIGINT",primaryKeyDataLength:20,callbackLoadEntity:function(){let e=document.querySelector('meta[name="application-id"]').getAttribute("content"),t=document.querySelector('meta[name="database-name"]').getAttribute("content"),r=document.querySelector('meta[name="database-schema"]').getAttribute("content");fetchDataFromServer(e,document.querySelector('meta[name="database-type"]').getAttribute("content"),t,r)},callbackSaveEntity:function(e){let t=document.querySelector('meta[name="application-id"]').getAttribute("content"),r=document.querySelector('meta[name="database-name"]').getAttribute("content"),a=document.querySelector('meta[name="database-schema"]').getAttribute("content");sendToServer(t,document.querySelector('meta[name="database-type"]').getAttribute("content"),r,a,e)}}),document.addEventListener("click",function(e){e.target.closest(".erd-svg .move-down-icon")&&editor.moveEntityUp(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .move-up-icon")&&editor.moveEntityDown(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .edit-icon")&&editor.editEntity(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .delete-icon")&&editor.deleteEntity(parseInt(e.target.getAttribute("data-index")))}),window.addEventListener("resize",function(){editor.renderEntities()}),resizablePanels=new ResizablePanels(".entity-editor",".left-panel",".right-panel",".resize-bar",200),init()});