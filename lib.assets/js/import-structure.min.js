function init(){let e=document.getElementById("queryTranslatorModal"),t=document.getElementById("entityEditorModal"),a=document.querySelectorAll(".cancel-button"),n=document.querySelector(".import-structure"),r=document.querySelector(".open-entity-editor"),o=document.querySelector(".translate-structure"),l=document.querySelector(".import-from-entity"),i=document.querySelector(".clear"),c=document.querySelector("#original"),u=document.querySelector(".query-generated"),s=document.querySelector('[name="query"]'),d=document.querySelectorAll(".cell-delete a");n.onclick=function(){e.style.display="block",c.focus()},r.onclick=function(){t.style.display="block",resizablePanels.loadPanelWidth()},a.forEach(function(e){e.onclick=function(e){e.target.closest(".modal").style.display="none"}}),i.onclick=function(){c.value=""},o.onclick=function(){let t=c.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),n=converter.translate(t,a);document.querySelector('[name="query"]').value=n,e.style.display="none"},l.onclick=function(){let e=u.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),n=converter.translate(e,a);document.querySelector('[name="query"]').value=n,t.style.display="none"},d.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let t=e.target.getAttribute("data-schema"),a=e.target.getAttribute("data-table"),n=e.target.getAttribute("data-primary-key"),r=e.target.getAttribute("data-value"),o="";o=`DELETE FROM ${""==t?`${t}.${a}`:a} WHERE ${n} = '${r}' `,s.value=o})}),window.onclick=function(t){t.target==e&&(e.style.display="none")}}const converter=new SQLConverter;let editor,resizablePanels;function sendToServer(e,t,a,n,r){let o={applicationId:e,databaseType:t,databaseName:a,databaseSchema:n,entities:JSON.stringify(r)},l=new XMLHttpRequest;l.open("POST","lib.ajax/entity-structure.php",!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4===l.readyState&&(200===l.status||console.log("An error occurred while sending data to the server"))};let i=new URLSearchParams(o).toString();l.send(i)}function fetchDataFromServer(e,t,a,n,r,o){let l=new XMLHttpRequest,i=buildUrl(e,t,a,n,r);l.open("GET",i,!0),l.onreadystatechange=function(){if(4===l.readyState){if(200===l.status){let e=l.responseText;try{let t=JSON.parse(e);editor.entities=editor.createEntitiesFromJSON(t),editor.renderEntities(),o&&o(null,t)}catch(a){}}else console.error("An error occurred while fetching data from the server. Status:",l.status)}},l.send()}function buildUrl(e,t,a,n,r){return`lib.ajax/entity-structure.php?applicationId=${encodeURIComponent(e)}&databaseType=${encodeURIComponent(t)}&databaseName=${encodeURIComponent(a)}&databaseSchema=${encodeURIComponent(n)}&entities=${encodeURIComponent(JSON.stringify(r))}`}document.addEventListener("DOMContentLoaded",()=>{editor=new EntityEditor(".entity-editor",{defaultDataType:"VARCHAR",defaultDataLength:50,callbackLoadEntity:function(){let e=document.querySelector('meta[name="application-id"]').getAttribute("content"),t=document.querySelector('meta[name="database-name"]').getAttribute("content"),a=document.querySelector('meta[name="database-schema"]').getAttribute("content");fetchDataFromServer(e,document.querySelector('meta[name="database-type"]').getAttribute("content"),t,a)},callbackSaveEntity:function(e){let t=document.querySelector('meta[name="application-id"]').getAttribute("content"),a=document.querySelector('meta[name="database-name"]').getAttribute("content"),n=document.querySelector('meta[name="database-schema"]').getAttribute("content");sendToServer(t,document.querySelector('meta[name="database-type"]').getAttribute("content"),a,n,e)}}),resizablePanels=new ResizablePanels(".entity-editor",".left-panel",".right-panel",".resize-bar",200),init()});