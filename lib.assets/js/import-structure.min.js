function init(){let e=document.getElementById("queryTranslatorModal"),t=document.getElementById("entityEditorModal"),a=document.querySelectorAll(".cancel-button"),n=document.querySelector(".import-structure"),r=document.querySelector(".open-entity-editor"),l=document.querySelector(".translate-structure"),o=document.querySelector(".import-from-entity"),i=document.querySelector(".clear"),c=document.querySelector("#original"),u=document.querySelector(".query-generated"),s=document.querySelector('[name="query"]'),d=document.querySelectorAll(".cell-delete a");n.onclick=function(){e.style.display="block",c.focus()},r.onclick=function(){t.style.display="block",resizablePanels.loadPanelWidth()},a.forEach(function(e){e.onclick=function(e){e.target.closest(".modal").style.display="none"}}),i.onclick=function(){c.value=""},l.onclick=function(){let t=c.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),n=converter.translate(t,a);document.querySelector('[name="query"]').value=n,e.style.display="none"},o.onclick=function(){let e=u.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),n=converter.translate(e,a);document.querySelector('[name="query"]').value=n,t.style.display="none"},d.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let t=e.target.getAttribute("data-schema"),a=e.target.getAttribute("data-table"),n=e.target.getAttribute("data-primary-key"),r=e.target.getAttribute("data-value"),l="";l=`DELETE FROM ${""==t?`${t}.${a}`:a} WHERE ${n} = '${r}' `,s.value=l})}),window.onclick=function(t){t.target==e&&(e.style.display="none")}}const converter=new SQLConverter;let editor,resizablePanels;function sendToServer(e,t,a,n,r){let l={applicationId:e,databaseType:t,databaseName:a,databaseSchema:n,entities:JSON.stringify(r)},o=new XMLHttpRequest;o.open("POST","lib.ajax/entity-structure.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status||console.log("An error occurred while sending data to the server"))};let i=new URLSearchParams(l).toString();o.send(i)}function fetchDataFromServer(e,t,a,n,r,l){let o=new XMLHttpRequest,i=buildUrl(e,t,a,n,r);o.open("GET",i,!0),o.onreadystatechange=function(){if(4===o.readyState){if(200===o.status){let e=o.responseText;try{let t=JSON.parse(e);editor.entities=editor.createEntitiesFromJSON(t),editor.renderEntities(),l&&l(null,t)}catch(a){}}else console.error("An error occurred while fetching data from the server. Status:",o.status)}},o.send()}function buildUrl(e,t,a,n,r){return`lib.ajax/entity-structure.php?applicationId=${encodeURIComponent(e)}&databaseType=${encodeURIComponent(t)}&databaseName=${encodeURIComponent(a)}&databaseSchema=${encodeURIComponent(n)}&entities=${encodeURIComponent(JSON.stringify(r))}`}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll(".collapsible .button-toggle");e.forEach(function(e){e.addEventListener("click",function(e){e.target.closest(".collapsible").classList.toggle("open")})}),editor=new EntityEditor(".entity-editor",{defaultDataType:"VARCHAR",defaultDataLength:50,primaryKeyDataType:"BIGINT",primaryKeyDataLength:20,callbackLoadEntity:function(){let e=document.querySelector('meta[name="application-id"]').getAttribute("content"),t=document.querySelector('meta[name="database-name"]').getAttribute("content"),a=document.querySelector('meta[name="database-schema"]').getAttribute("content");fetchDataFromServer(e,document.querySelector('meta[name="database-type"]').getAttribute("content"),t,a)},callbackSaveEntity:function(e){let t=document.querySelector('meta[name="application-id"]').getAttribute("content"),a=document.querySelector('meta[name="database-name"]').getAttribute("content"),n=document.querySelector('meta[name="database-schema"]').getAttribute("content");sendToServer(t,document.querySelector('meta[name="database-type"]').getAttribute("content"),a,n,e)}}),resizablePanels=new ResizablePanels(".entity-editor",".left-panel",".right-panel",".resize-bar",200),init()});