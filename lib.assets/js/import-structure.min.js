function init(){let e=document.getElementById("queryTranslatorModal"),t=document.getElementById("entityEditorModal"),a=document.querySelectorAll(".cancel-button"),r=document.querySelector(".import-structure"),n=document.querySelector(".open-entity-editor"),i=document.querySelector(".translate-structure"),o=document.querySelector(".import-from-entity"),l=document.querySelector(".clear"),c=document.querySelector(".original"),d=document.querySelector(".query-generated"),s=document.querySelector('[name="query"]'),u=document.querySelectorAll(".cell-delete a");r.onclick=function(){e.style.display="block",c.focus()},n.onclick=function(){t.style.display="block",resizablePanels.loadPanelWidth()},a.forEach(function(e){e.onclick=function(e){e.target.closest(".modal").style.display="none"}}),l.onclick=function(){c.value=""},i.onclick=function(){let t=c.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),r=converter.translate(t,a);document.querySelector('[name="query"]').value=r,e.style.display="none"},o.onclick=function(){let e=d.value,a=document.querySelector('meta[name="database-type"]').getAttribute("content"),r=converter.translate(e,a);document.querySelector('[name="query"]').value=r,t.style.display="none"},u.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let t=e.target.getAttribute("data-schema"),a=e.target.getAttribute("data-table"),r=e.target.getAttribute("data-primary-key"),n=e.target.getAttribute("data-value"),i="";i=`DELETE FROM ${""==t?`${t}.${a}`:a} WHERE ${r} = '${n}';\r
`;s.value.startsWith("DELETE FROM ")&&(i=s.value+i),s.value=i})}),window.onclick=function(t){t.target==e&&(e.style.display="none")}}const converter=new SQLConverter;let editor,renderer,resizablePanels;function sendToServer(e,t,a,r,n){let i={applicationId:e,databaseType:t,databaseName:a,databaseSchema:r,entities:JSON.stringify(n)},o=new XMLHttpRequest;o.open("POST","lib.ajax/entity-structure.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status||console.log("An error occurred while sending data to the server"))};let l=new URLSearchParams(i).toString();o.send(l)}function fetchDataFromServer(e,t,a,r,n,i){let o=new XMLHttpRequest,l=buildUrl(e,t,a,r,n);o.open("GET",l,!0),o.onreadystatechange=function(){if(4===o.readyState){if(200===o.status){let e=o.responseText;try{let t=JSON.parse(e);editor.entities=editor.createEntitiesFromJSON(t),editor.renderEntities(),i&&i(null,t)}catch(a){}}else console.error("An error occurred while fetching data from the server. Status:",o.status)}},o.send()}function buildUrl(e,t,a,r,n){return`lib.ajax/entity-structure.php?applicationId=${encodeURIComponent(e)}&databaseType=${encodeURIComponent(t)}&databaseName=${encodeURIComponent(a)}&databaseSchema=${encodeURIComponent(r)}&entities=${encodeURIComponent(JSON.stringify(n))}`}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll(".collapsible .button-toggle"),t=document.querySelector(".erd-svg");renderer=new EntityRenderer(t),e.forEach(function(e){e.addEventListener("click",function(e){e.target.closest(".collapsible").classList.toggle("open")})}),editor=new EntityEditor(".entity-editor",{defaultDataType:"VARCHAR",defaultDataLength:50,primaryKeyDataType:"BIGINT",primaryKeyDataLength:20,callbackLoadEntity:function(){let e=document.querySelector('meta[name="application-id"]').getAttribute("content"),t=document.querySelector('meta[name="database-name"]').getAttribute("content"),a=document.querySelector('meta[name="database-schema"]').getAttribute("content");fetchDataFromServer(e,document.querySelector('meta[name="database-type"]').getAttribute("content"),t,a)},callbackSaveEntity:function(e){let t=document.querySelector('meta[name="application-id"]').getAttribute("content"),a=document.querySelector('meta[name="database-name"]').getAttribute("content"),r=document.querySelector('meta[name="database-schema"]').getAttribute("content");sendToServer(t,document.querySelector('meta[name="database-type"]').getAttribute("content"),a,r,e)}}),document.addEventListener("click",function(e){e.target.closest(".erd-svg .move-down-btn")&&editor.moveEntityUp(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .move-up-btn")&&editor.moveEntityDown(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .edit-icon")&&editor.editEntity(parseInt(e.target.getAttribute("data-index"))),e.target.closest(".erd-svg .delete-icon")&&editor.deleteEntity(parseInt(e.target.getAttribute("data-index")))}),window.addEventListener("resize",function(){editor.renderEntities()}),resizablePanels=new ResizablePanels(".entity-editor",".left-panel",".right-panel",".resize-bar",200),init()});