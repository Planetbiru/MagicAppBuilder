const DIALECT_TYPE_MAP={mysql:{int:"INT",bigint:"BIGINT",varchar:"VARCHAR",boolean:"TINYINT(1)",text:"TEXT",datetime:"DATETIME",timestamp:"TIMESTAMP",decimal:"DECIMAL",enum:"ENUM",set:"SET"},postgresql:{int:"INTEGER",bigint:"BIGINT",varchar:"CHARACTER VARYING",boolean:"BOOLEAN",tinyint1:"BOOLEAN",text:"TEXT",datetime:"TIMESTAMP",timestamp:"TIMESTAMP",decimal:"NUMERIC",enum:"TEXT",set:"TEXT"},sqlite:{int:"INTEGER",bigint:"INTEGER",varchar:"NVARCHAR",boolean:"BOOLEAN",tinyint1:"BOOLEAN",text:"TEXT",datetime:"DATETIME",timestamp:"TIMESTAMP",decimal:"REAL",enum:"TEXT",set:"TEXT"},sqlserver:{int:"INT",bigint:"BIGINT",varchar:"NVARCHAR",boolean:"BIT",tinyint1:"BIT",text:"TEXT",datetime:"DATETIME",decimal:"DECIMAL",enum:"NVARCHAR",set:"NVARCHAR"}};class Column{constructor(e,t="VARCHAR",i="",s=!1,a="",l=!1,n=!1,r=""){this.name=e,this.type=t,this.length=i,this.nullable=s,this.default=a,this.primaryKey=l,this.autoIncrement=n,this.values=r}fixColumnType(e){if(!e)return"";let t=e.match(/^(\w+)\s*\((\d+)\)$/i);if(t){let i=t[1].toLowerCase();if("boolean"===i||"bool"===i)return i.toUpperCase()}return e}toSQL(e="mysql"){let t=this.type.toLowerCase();"tinyint"==t&&1==this.length&&(t="tinyint1");let i=(DIALECT_TYPE_MAP[e]||DIALECT_TYPE_MAP.mysql)[t]||this.type;i=this.fixColumnType(i);let s=["enum","set"].includes(t),a=["numeric","decimal","double","float"].includes(t),l=["varchar","char","binary","varbinary","bit","tinyint","smallint","mediumint","int","bigint"].includes(t),n=`${this.name} ${i}`;if(s&&this.values){let r=this.values.split(",").map(e=>`'${e.trim()}'`).join(", ");"mysql"===e&&(n=`${this.name} ${i}(${r})`)}else if(a&&this.values){let o=this.values.split(",").map(e=>e.trim()).filter(e=>/^\d+$/.test(e)).join(", ");o&&(n+=`(${o})`)}else l&&this.length&&(n+=`(${this.length})`);return this.primaryKey?n+=" NOT NULL PRIMARY KEY":n+=this.nullable?" NULL":" NOT NULL",this.autoIncrement&&("mysql"===e?n+=" AUTO_INCREMENT":"postgresql"===e?n=`${this.name} SERIAL PRIMARY KEY`:"sqlite"===e?n+=" AUTOINCREMENT":"sqlserver"===e&&(n+=" IDENTITY(1,1)")),this.hasDefault()&&(this.isTypeBoolean(this.type,this.length)?n+=` DEFAULT ${this.toBoolean(this.default,e)}`:this.isTypeNumeric(this.type,Object.values(DIALECT_TYPE_MAP[e]))&&!isNaN(this.default)?n+=` DEFAULT ${this.default}`:n+=` DEFAULT ${this.fixDefaultColumnValue(this.default,e)}`),n}toNumeric(e){let t=e;return""==(t=(t=t.replace(/^"(.*)"$/,"$1")).replace(/^'(.*)'$/,"$1"))?"0":t}isTypeNumeric(e,t){return t.includes(e.toUpperCase())}fixDefaultColumnValue(e,t){return e?-1!=e.toUpperCase().indexOf("NULL")?e="NULL":this.isNumber(e)?e="'"+e.toString()+"'":/^(CURRENT_TIMESTAMP|NOW\(\))$/i.test(e)?e=e.toUpperCase():e.startsWith("'")&&e.endsWith("'")&&/\d{4}-\d{2}-\d{2}/.test(e.slice(1,-1))?e="'"+e.slice(1,-1)+"'":/\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}/.test(e)?e="'"+e+"'":/\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}\.\d{6}/.test(e)?e="'"+e+"'":/^(TRUE|FALSE)$/i.test(e)?e=e.toUpperCase():/^CURRENT_TIMESTAMP\s+ON\s+UPDATE\s+CURRENT_TIMESTAMP$/i.test(e)?e=e.toUpperCase():/^CURRENT_TIMESTAMP\s+ON\s+INSERT\s+CURRENT_TIMESTAMP$/i.test(e)?e=e.toUpperCase():this.isInQuotes(e)&&(e="'"+e.slice(1,-1)+"'"):e=null,e}isInQuotes(e){return e.startsWith("'")&&e.endsWith("'")}isNumber(e){return!isNaN(e)&&""!==e}toBoolean(e,t){let i="string"==typeof e?e.trim().toLowerCase():String(e).toLowerCase(),s="true"===i||"1"===i||0!==parseInt(i),a=["sqlite","sqlserver"].includes(t.toLowerCase());return a?s?"1":"0":s?"TRUE":"FALSE"}fixDefaultValue(e,t,i){let s=e;return this.isTypeBoolean(t,i)?s=0!=e&&"true"===e.toString().toLowerCase()?"true":"false":this.isNativeValue(e)?s=e:this.isTypeText(t)?s=`'${e.replace(/'/g,"\\'")}'`:this.isTypeInteger(t)?s=parseInt(e.replace(/[^\d]/g,""),10):this.isTypeFloat(t)&&(s=parseFloat(e.replace(/[^\d.]/g,""))),s}isTypeBoolean(e,t){return"boolean"===e.toLowerCase()||"bool"===e.toLowerCase()||"bit"===e.toLowerCase()||"tinyint"===e.toLowerCase()&&1==t}isNativeValue(e){return"true"===e.toLowerCase()||"false"===e.toLowerCase()||"null"===e.toLowerCase()}isTypeText(e){return["char","varchar","text","tinytext","mediumtext","longtext","enum","set"].includes(e.toLowerCase())}isTypeInteger(e){return["tinyint","smallint","mediumint","int","bigint","integer"].includes(e.toLowerCase())}isTypeFloat(e){return["float","double","decimal","numeric"].includes(e.toLowerCase())}isTypeDate(e){return["date","datetime","timestamp","time","year"].includes(e.toLowerCase())}isTypeBinary(e){return["blob","tinyblob","mediumblob","longblob"].includes(e.toLowerCase())}hasRange(e){return e.includes(this.type)&&this.values}hasValue(e){return e.includes(this.type)&&this.values}hasLength(e){return this.length&&e.includes(this.type)}hasDefault(){return this.default&&"null"!==this.default.toLowerCase()}}