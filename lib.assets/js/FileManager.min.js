let selectedItem=null,contentModified=!0,currentMode=null;function initFileManager(){document.getElementById("dir-tree").addEventListener("click",function(e){if(e.target){if(e.target.classList.contains("dir")){let t=e.target.dataset.dir,n=e.target.closest("li"),l=n.querySelector("ul");l?n.setAttribute("data-open","true"===n.getAttribute("data-open")?"false":"true"):(l=document.createElement("ul"),n.appendChild(l),loadDirContent(t,l,n),n.setAttribute("data-open","true"))}else if(e.target.classList.contains("file")){let a=e.target;openFile(a.dataset.file,a.dataset.extension)}}}),document.querySelector(".btn-save-file").addEventListener("click",function(e){let t;saveFile(document.querySelector(".file-path").value,fileManagerEditor.getValue())}),document.querySelector(".btn-open-file").addEventListener("click",function(e){let t=document.querySelector(".file-path").value,n=getFileExtension(t);openTextFile(t,n)});let e=document.getElementById("dir-tree"),t=document.getElementById("context-menu");e.addEventListener("contextmenu",function(e){e.preventDefault();let n=e.target.closest("li");if(n&&n.dataset&&n.dataset.type){selectedItem=e.target;let l="",a=n.dataset.type;"file"===a?l=n.querySelector("span").dataset.file:"dir"===a&&(l=n.querySelector("span").dataset.dir);let i=e.pageX,r=e.pageY;t.className="context-menu";let o=t.querySelector("ul");o.innerHTML="","file"===a?(o.innerHTML=`
              <li data-type="file" data-operation="open" data-file="${l}">Open File</li>
              <li data-type="file" data-operation="rename" data-file="${l}">Rename File</li>
              <li data-type="file" data-operation="download" data-file="${l}">Download File</li>
              <li data-type="file" data-operation="delete" data-file="${l}">Delete File</li>
              `,r+t.offsetHeight>window.innerHeight&&(r=window.innerHeight-t.offsetHeight-10),t.style.left=`${i}px`,t.style.top=`${r}px`,t.style.display="block"):"dir"===a?(o.innerHTML=`
              <li data-type="dir" data-operation="new-file" data-dir="${l}">Create New File</li>
              <li data-type="dir" data-operation="new-dir" data-dir="${l}">Create New Directory</li>
              <li data-type="dir" data-operation="upload-file" data-dir="${l}">Upload Files</li>
              <li data-type="dir" data-operation="open" data-dir="${l}">Expand Directory</li>
              <li data-type="dir" data-operation="refresh-dir" data-dir="${l}">Reload Directory</li>
              <li data-type="dir" data-operation="rename" data-dir="${l}">Rename Directory</li>
              <li data-type="dir" data-operation="compress" data-dir="${l}">Download Directory</li>
              <li data-type="dir" data-operation="delete" data-dir="${l}">Delete Directory</li>
              `,r+t.offsetHeight>window.innerHeight&&(r=window.innerHeight-t.offsetHeight-10),t.style.left=`${i}px`,t.style.top=`${r}px`,t.style.display="block"):(showRootContextMenu(e,t),e.preventDefault(),e.stopPropagation())}else showRootContextMenu(e,t),e.preventDefault(),e.stopPropagation()}),document.querySelector(".root-directory").addEventListener("contextmenu",function(e){showRootContextMenu(e,t),e.stopPropagation(),e.preventDefault()}),document.addEventListener("click",function(){t.style.display="none"}),t.addEventListener("click",function(e){let n=e.target.closest("li");if(null!=n){let l=n.dataset.operation;if(l){let a="",i=n.dataset.type;switch("file"===i?a=n.dataset.file:"dir"===i&&(a=n.dataset.dir),l){case"root-new-file":createNewFile("");break;case"reset":resetFileManager();break;case"root-dowload":downloadFile("","dir");break;case"new-file":createNewFile(a);break;case"upload-file":uploadFile(a);break;case"new-dir":createNewDirectory(a);break;case"root-new-dir":createNewDirectory("");break;case"open":selectedItem.click();break;case"refresh-dir":refreshDirectory(a);break;case"rename":renameFile(a,i);break;case"download":downloadFile(a,i);break;case"delete":deleteFile(a,i);break;case"compress":compressDirectory(a)}t.style.display="none"}}}),document.querySelector(".file-path").addEventListener("change",function(e){let t=e.target.value,n=getFileExtension(t);n&&changeMode(t,n)}),initCodeMirror(),fileManagerEditor.refresh()}function showRootContextMenu(e,t){e.preventDefault(),selectedItem=null;let n=e.pageX,l=e.pageY;t.className="context-menu";let a=t.querySelector("ul");a.innerHTML=`
    <li data-type="dir" data-operation="root-new-file" data-dir="">Create New File</li>
    <li data-type="dir" data-operation="root-new-dir" data-dir="">Create New Directory</li>
    <li data-type="dir" data-operation="upload-file" data-dir="">Upload Files</li>
    <li data-type="dir" data-operation="reset" data-dir="">Reset Content</li>
    <li data-type="dir" data-operation="root-dowload" data-dir="">Download All</li>
    `,l+t.offsetHeight>window.innerHeight&&(l=window.innerHeight-t.offsetHeight-10),t.style.left=`${n}px`,t.style.top=`${l}px`,t.style.display="block"}function uploadFile(e){let t=document.createElement("input");t.type="file",t.accept="*",t.multiple=!0,t.style.display="none",t.addEventListener("change",function(t){let n=t.target.files;if(n){let l=new FormData;for(let a=0;a<n.length;a++)l.append("files[]",n[a]);l.append("dir",e),increaseAjaxPending(),fetch("lib.ajax/file-manager-upload.php",{method:"POST",body:l}).then(e=>e.json()).then(e=>{if(decreaseAjaxPending(),"success"==e.status){if(null!=selectedItem){let t=selectedItem.closest("li"),n=t.querySelector("ul");null==n&&(n=document.createElement("ul"),t.appendChild(n)),null!=t&&(displayDirContent(e.dirs,n,!0),t.setAttribute("data-open","true"))}else resetFileManager()}else console.error("Error uploading file:",e.error)}).catch(e=>{decreaseAjaxPending(),console.error("Error uploading file:",e)})}}),t.click()}function createNewFile(e){let t=""!==e?e+"/new-file.txt":"new-file.txt";document.querySelector(".file-path").value=t,document.querySelector(".btn-save-file").disabled=!1,fileManagerEditor.setValue(""),changeMode(t,"txt"),setDisplayMode("text"),fileManagerEditor.focus()}function createNewDirectory(e){let t="new-directory";""!=e&&(t=e+"/"+t),asyncPrompt("Enter new directory name","Create Directory",[{caption:"OK",fn:function(e){let t=null,n=null,l="/";null!=selectedItem&&(t=selectedItem.closest("li"),n=selectedItem.closest("li").querySelector("ul"),l=t?t.querySelector("span").dataset.dir:"/"),increaseAjaxPending(),fetch("lib.ajax/file-manager-create-directory.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({name:e,type:"dir",dir:l})}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{decreaseAjaxPending(),null!=t&&t.removeAttribute("data-loading"),e.dirs?null!=t&&null!=n?displayDirContent(e.dirs,n,!0):resetFileManager():"/"==l?resetFileManager():loadDirContent(l,n,t,!0)}).catch(e=>{decreaseAjaxPending(),null!=t&&t.removeAttribute("data-loading")})},class:"btn-primary"},{caption:"Cancel",fn:function(){},class:"btn-secondary"}],t,function(){})}function renameFile(e,t){asyncPrompt("Enter new name for "+e,"Rename",[{caption:"OK",fn:function(n){let l=selectedItem.closest("ul").closest("li"),a=selectedItem.closest("ul"),i=l?l.querySelector("span").dataset.dir:"/";increaseAjaxPending(),fetch("lib.ajax/file-manager-rename.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({name:e,newName:n,type:t})}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{decreaseAjaxPending(),null!=l&&l.removeAttribute("data-loading"),e.dirs?displayDirContent(e.dirs,a,!0):"/"==i?resetFileManager():loadDirContent(i,a,l,!0)}).catch(e=>{decreaseAjaxPending(),null!=l&&l.removeAttribute("data-loading")})},class:"btn-primary"},{caption:"Cancel",fn:function(){},class:"btn-secondary"}],e,function(e){})}function downloadFile(e,t){let n=`lib.ajax/file-manager-download.php?name=${encodeURIComponent(e)}&type=${encodeURIComponent(t)}`,l=document.createElement("a");l.href=n,l.download=e,l.click()}function deleteFile(e,t){asyncAlert("Do you want to delete "+e+"?","Confirmation",[{caption:"Yes",fn(){let n=selectedItem.closest("li");increaseAjaxPending(),fetch("lib.ajax/file-manager-delete.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({name:e,type:t})}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{decreaseAjaxPending(),null!=n&&n.parentNode.removeChild(n)}).catch(e=>{decreaseAjaxPending(),null!=n&&n.removeAttribute("data-loading")})},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}function compressDirectory(e){asyncAlert("Do you want to compress "+e+"?","Confirmation",[{caption:"Yes",fn(){let t=`lib.ajax/file-manager-download.php?name=${encodeURIComponent(e)}&type=dir`,n=document.createElement("a");n.href=t,n.download=e,n.click()},class:"btn-primary"},{caption:"No",fn(){},class:"btn-secondary"}])}function getCaller(){try{throw Error()}catch(e){let t=e.stack.split("\n");if(t.length>2){let n=t[2],l=n.match(/at (\w+)/);return l?l[1]:"Unknown"}return"Unknown"}}function resetFileManager(){let e=document.querySelector("#dir-tree");fileManagerEditor&&fileManagerEditor.setValue(""),document.querySelector(".btn-save-file").disabled=!0,document.querySelector("#dir-tree").innerHTML="",document.querySelector(".file-path").value="",loadDirContent("",e,null,!0)}function getFileExtension(e){let t=/\.(\w+)$/.exec(e);return t?t[1]:""}function getFileBaseName(e){let t=e.split(/[\\/]/).pop(),n=t.lastIndexOf(".");return -1===n?t:t.substring(0,n)}function format(){let e=fileManagerEditor.lineCount();fileManagerEditor.autoFormatRange({line:0,ch:0},{line:e})}function refreshDirectory(e){let t=selectedItem.closest("li"),n=t.querySelector("ul");null==n&&(n=document.createElement("ul"),t.appendChild(n)),loadDirContent(e,n,t,!0),null!=t&&t.setAttribute("data-open","true")}function loadDirContent(e,t,n,l){null!=n&&n.setAttribute("data-loading","true"),increaseAjaxPending(),$.ajax({url:"lib.ajax/file-manager-load-dir.php",method:"GET",data:{dir:e},dataType:"json",success:function(e){decreaseAjaxPending(),null!=n&&n.removeAttribute("data-loading"),displayDirContent(e,t,l)},error:function(e,t,l){decreaseAjaxPending(),null!=n&&n.removeAttribute("data-loading"),console.error("AJAX Error:",t,l)}})}function displayDirContent(e,t,n){t.innerHTML="",e.forEach(function(e){if("dir"===e.type){let n=document.createElement("li");n.dataset.type=e.type;let l=document.createElement("span");l.textContent=e.name,l.dataset.dir=e.path,l.classList.add("dir"),n.appendChild(l),t.appendChild(n)}else if("file"===e.type){let a=document.createElement("li");a.dataset.type=e.type;let i=document.createElement("span");i.textContent=e.name,i.dataset.file=e.path,i.dataset.extension=e.extension,i.classList.add("file"),a.appendChild(i),t.appendChild(a)}})}function getDirectoryName(e){if("string"!=typeof e||""===e.trim())return console.warn("Invalid path provided"),"";e=e.trim().replace(/\/+$/,"");let t=e.lastIndexOf("/");return t<=0?"":e.substring(0,t).replace(/^\/+/,"")}function saveFile(e,t){let n=new FormData;n.append("file",e),n.append("content",t),increaseAjaxPending(),fetch("lib.ajax/file-manager-save-file.php",{method:"POST",body:n}).then(e=>e.json()).then(e=>{decreaseAjaxPending();let t=null,n=null,l=getDirectoryName(document.querySelector(".file-path").value);if(l.length>0){let a=`span[data-dir="${l}"]`;n=document.querySelector(a).closest("li")}null!=selectedItem?(n=selectedItem.closest("li"),null==(t=selectedItem.closest("li").querySelector("ul"))&&(t=document.createElement("ul"),n.appendChild(t)),e.dirs)?(n.removeAttribute("data-loading"),displayDirContent(e.dirs,t,!0),null!=n&&n.setAttribute("data-open","true")):loadDirContent("",document.querySelector("#dir-tree"),null,!0):null!=n&&e.dirs?(n.removeAttribute("data-loading"),displayDirContent(e.dirs,t,!0),null!=n&&n.setAttribute("data-open","true")):loadDirContent("",document.querySelector("#dir-tree"),null,!0)}).catch(e=>{decreaseAjaxPending()})}function openFile(e,t){t||(t=getFileExtension(e)),["jpg","jpeg","png","gif","webp","bmp","svg","ico","mp4","mp3","avi","exe","pdf","sqlite","db"].includes(t.toLowerCase())?["jpg","jpeg","png","gif","webp","bmp","svg","ico"].includes(t.toLowerCase())?(setDisplayMode("image"),increaseAjaxPending(),fetch("lib.ajax/file-manager-load-image.php?file="+encodeURIComponent(e)).then(e=>e.text()).then(e=>{let t=document.querySelector(".media-display"),n=document.createElement("img");n.src=e,n.style.maxWidth="100%",n.style.maxHeight="400px",t.innerHTML="",t.appendChild(n),decreaseAjaxPending()}).catch(e=>{decreaseAjaxPending()})):["sqlite","db"].includes(t.toLowerCase())?(document.querySelector(".database-display").innerHTML=createDatabaseResource(),curretDatabaseName=getFileBaseName(e),loadDatabaseFromUrl("lib.ajax/file-manager-load-file.php?file="+encodeURIComponent(e)),setDisplayMode("database")):fileDiv.textContent="Cannot open this file.":(null===currentMode&&changeMode(e,t),setDisplayMode("text"),openTextFile(e,t))}let currentData=null,selectedRowIndex=null,columnInfo=[],db,currentSqliteTableName=null,curretDatabaseName=null,exportType="";function loadDatabaseFromUrl(e){fetch(e).then(e=>{if(!e.ok)throw Error("Failed to load database. Please check the URL.");return e.arrayBuffer()}).then(e=>{let t=new Uint8Array(e);initSqlJs({locateFile:e=>"lib.assets/wasm/sql-wasm.wasm"}).then(e=>{let n=(db=new e.Database(t)).exec("SELECT name FROM sqlite_master WHERE type='table';"),l=document.querySelector("#sqlite-table-sidebar #sqlite-table-list");l.innerHTML="",n.length&&n[0]&&n[0].values&&n[0].values.length?(n[0].values.forEach(e=>{let t=document.createElement("li"),n=e[0],a=document.createElement("a");a.href="#",a.innerText=n,a.classList.add("sqlite-table-content"),a.addEventListener("click",function(e){e.preventDefault(),displayTableData(db,n),hilightTable(e)});let i=document.createElement("a");i.href="#",i.innerText="☰",i.classList.add("sqlite-table-structure"),i.addEventListener("click",function(e){e.preventDefault(),displayTableStructure(db,n),hilightTable(e)}),t.appendChild(i),t.appendChild(document.createTextNode(" ")),t.appendChild(a),l.appendChild(t)}),document.getElementById("sqliteDownloadAllSqlButton").disabled=!1):db=null})}).catch(e=>{alert(`Error loading database from server: ${e.message}`)})}function displayTableStructure(e,t){currentSqliteTableName=t;let n=e.exec(`PRAGMA table_info(${t});`),l=document.getElementById("sqlite-output");if(l.innerHTML="",exportType="structure",document.getElementById("sqliteDownloadSqlButton").disabled=!1,n.length>0){let a=`<h3>Table Structure: ${t}</h3>
                           <table class="sqlite-table-data">
                               <thead>
                                   <tr>
                                       <th>Column Name</th>
                                       <th>Data Type</th>
                                       <th>Not Null</th>
                                       <th>Default</th>
                                       <th>Primary Key</th>
                                   </tr>
                               </thead>
                               <tbody>`;n[0].values.forEach(e=>{a+="<tr>",a+=`<td>${e[1]}</td>`,a+=`<td>${e[2]}</td>`,a+=`<td>${1===e[3]?"Yes":"No"}</td>`,a+=`<td>${null===e[4]?"":e[4]}</td>`,a+=`<td>${1===e[5]?"Yes":"No"}</td>`,a+="</tr>"}),a+="</tbody></table>",l.innerHTML=a}else l.innerHTML="No structure found."}function displayTableData(e,t){currentSqliteTableName=t;let n=e.exec("SELECT * FROM "+t),l=document.getElementById("sqlite-output");l.innerHTML="",exportType="structure+data",document.getElementById("sqliteDownloadSqlButton").disabled=!1,columnInfo=e.exec(`PRAGMA table_info(${t});`)[0].values,n.length>0?(l.innerHTML=`<h3>Table Content: ${t}</h3>`+createTable(n[0]),currentData=n[0]):l.innerHTML=`<h3>Table Content: ${t}</h3><p>No data found.</p>`}function createTable(e){let t='<table class="sqlite-table-data"><thead><tr>';return e.columns.forEach(e=>{t+=`<th>${e}</th>`}),t+="</tr></thead><tbody>",e.values.forEach(e=>{t+="<tr>",e.forEach(e=>{t+=`<td>${null!==e?e:""}</td>`}),t+="</tr>"}),t+="</tbody></table>"}function getDataType(e){let t=columnInfo.find(t=>t[1]===e);return t?t[2]:"UNKNOWN"}function hilightTable(e){let t=e.target.closest("li"),n=t.closest("ul").querySelectorAll("li");n.forEach(e=>{e.classList.remove("highlight")}),t.classList.add("highlight")}const SQLITE_EXPORT_BATCH_SIZE=50;function sqliteDownloadAllSql(){let e=db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%';");if(0===e.length||0===e[0].values.length)return;let t=e[0].values.map(e=>e[0]),n="-- SQL Export for All Tables\r\n\r\n";t.forEach(e=>{let t=db.exec(`PRAGMA table_info(${e});`),l={};if(t.length>0){let a=t[0].values.map(e=>{let t=e[1],n=e[2];l[t]=n.toUpperCase();let a=1===e[3]?"NOT NULL":"",i=e[4]?`DEFAULT ${e[4]}`:"",r=1===e[5]?"PRIMARY KEY":"";return`${t} ${n} ${a} ${i} ${r}`.trim()}).join(",\r\n  ");n+=`-- Table: ${e}\r
`,n+=`CREATE TABLE ${e} (\r
  ${a}\r
);\r
\r
`}let i=db.exec(`SELECT * FROM ${e};`);if(i.length>0){let r=i[0].columns,o=i[0].values;for(let d=0;d<o.length;d+=50){let s=o.slice(d,d+50),c=s.map(e=>{let t=e.map((e,t)=>{if(null===e)return"NULL";let n=r[t],a=l[n]||"";return/(INT|REAL|NUM|DECIMAL|DOUBLE|FLOAT|BOOL)/.test(a)?e:`'${e.toString().replace(/'/g,"''")}'`});return`(${t.join(", ")})`});n+=`INSERT INTO ${e} (${r.join(", ")}) VALUES\r
${c.join(",\r\n")}\r
;\r
`}n+="\r\n"}});let l=new Blob([n],{type:"text/sql"}),a=URL.createObjectURL(l),i=document.createElement("a");i.href=a,i.download=`${curretDatabaseName}.sql`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}function sqliteDownloadSql(){let e=db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%';");if(0===e.length||0===e[0].values.length)return;let t=currentSqliteTableName;if(!t)return;let n=`-- SQL Export for Table ${t}\r
\r
`,l=db.exec(`PRAGMA table_info(${t});`),a={};if(-1!=exportType.indexOf("structure")&&l.length>0){let i=l[0].values.map(e=>{let t=e[1],n=e[2];a[t]=n.toUpperCase();let l=1===e[3]?"NOT NULL":"",i=e[4]?`DEFAULT ${e[4]}`:"",r=1===e[5]?"PRIMARY KEY":"";return`${t} ${n} ${l} ${i} ${r}`.trim()}).join(",\r\n  ");n+=`-- Table: ${t}\r
`,n+=`CREATE TABLE ${t} (\r
  ${i}\r
);\r
\r
`}if(-1!=exportType.indexOf("data")){let r=db.exec(`SELECT * FROM ${t};`);if(r.length>0){let o=r[0].columns,d=r[0].values;for(let s=0;s<d.length;s+=50){let c=d.slice(s,s+50),p=c.map(e=>{let t=e.map((e,t)=>{if(null===e)return"NULL";let n=o[t],l=a[n]||"";return/(INT|REAL|NUM|DECIMAL|DOUBLE|FLOAT|BOOL)/.test(l)?e:`'${e.toString().replace(/'/g,"''")}'`});return`(${t.join(", ")})`});n+=`INSERT INTO ${t} (${o.join(", ")}) VALUES\r
${p.join(",\r\n")}\r
;\r
`}n+="\r\n"}}let u=new Blob([n],{type:"text/sql"}),f=URL.createObjectURL(u),m=document.createElement("a");m.href=f,m.download=`${t}.sql`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(f)}function createDatabaseResource(){return`
    <div id="sqlite-app-container">
      <aside id="sqlite-table-sidebar" class="sqlite-sidebar">
        <div class="sqlite-header-section">Tables</div>
        <div id="sqlite-table-container">
          <ul id="sqlite-table-list"></ul>
        </div>
      </aside>

      <main id="sqlite-table-main" class="sqlite-main">
        <div class="sqlite-input-area sqlite-header-section">
          <button class="btn btn-primary" id="sqliteDownloadSqlButton" onclick="sqliteDownloadSql()" disabled>Export Table to SQL</button>
          <button class="btn btn-primary" id="sqliteDownloadAllSqlButton" onclick="sqliteDownloadAllSql()" disabled>Export Database to SQL</button>
        </div>
        <div id="sqlite-output"></div>
      </main>
    </div>
  `}function openTextFile(e,t){document.querySelector(".btn-open-file").disabled=!0,document.querySelector(".btn-save-file").disabled=!0,setDisplayMode("text"),document.querySelector(".file-path").value=e,fileManagerEditor.setValue("Loading..."),changeMode("any.txt","txt"),increaseAjaxPending(),fetch("lib.ajax/file-manager-load-file.php?file="+encodeURIComponent(e)).then(e=>e.text()).then(n=>{changeMode(e,t),fileManagerEditor.setValue(n),document.querySelector(".btn-open-file").disabled=!1,document.querySelector(".btn-save-file").disabled=!1,decreaseAjaxPending()}).catch(e=>{document.querySelector(".btn-open-file").disabled=!1,document.querySelector(".btn-save-file").disabled=!1,setDisplayMode(""),decreaseAjaxPending()})}function setDisplayMode(e){"text"===e?(document.querySelector(".image-mode").style.display="none",document.querySelector(".database-mode").style.display="none",document.querySelector(".text-mode").style.display="block"):"image"===e?(document.querySelector(".text-mode").style.display="none",document.querySelector(".database-mode").style.display="none",document.querySelector(".image-mode").style.display="block"):"database"===e&&(document.querySelector(".text-mode").style.display="none",document.querySelector(".image-mode").style.display="none",document.querySelector(".database-mode").style.display="block")}function changeMode(e,t){currentMode=t;let n=e,l,a,i=/.+\.([^.]+)$/.exec(n);if(i){let r=CodeMirror.findModeByExtension(i[1]);r&&(l=r.mode,a=r.mime)}else if(/\//.test(n)){let o=CodeMirror.findModeByMIME(n);o&&(l=o.mode,a=n)}else l=a=n;l&&(fileManagerEditor.setOption("mode",a),CodeMirror.autoLoadMode(fileManagerEditor,l))}const editorModeMap={yaml:{mode:"text/x-yaml",indentUnit:2},yml:{mode:"text/x-yaml",indentUnit:2},js:{mode:"text/javascript",indentUnit:2},json:{mode:"application/json",indentUnit:2},css:{mode:"text/css",indentUnit:2},xml:{mode:"application/xml",indentUnit:2},html:{mode:"text/html",indentUnit:2},htm:{mode:"text/html",indentUnit:2},md:{mode:"text/x-markdown",indentUnit:2},markdown:{mode:"text/x-markdown",indentUnit:2},ts:{mode:"text/typescript",indentUnit:2},tsx:{mode:"text/typescript",indentUnit:2},jsx:{mode:"text/jsx",indentUnit:2},vue:{mode:"text/x-vue",indentUnit:2},rb:{mode:"text/x-ruby",indentUnit:2},sh:{mode:"text/x-sh",indentUnit:2},conf:{mode:"text/x-properties",indentUnit:2},cfg:{mode:"text/x-properties",indentUnit:2},properties:{mode:"text/x-properties",indentUnit:2},ini:{mode:"text/x-properties",indentUnit:2},env:{mode:"text/x-properties",indentUnit:2},php:{mode:"application/x-httpd-php",indentUnit:4},py:{mode:"text/x-python",indentUnit:4},java:{mode:"text/x-java",indentUnit:4},c:{mode:"text/x-csrc",indentUnit:4},cpp:{mode:"text/x-csrc",indentUnit:4},h:{mode:"text/x-csrc",indentUnit:4},go:{mode:"text/x-go",indentUnit:4},sql:{mode:"text/x-sql",indentUnit:4},log:{mode:"text/plain",indentUnit:2},txt:{mode:"text/plain",indentUnit:2},csv:{mode:"text/plain",indentUnit:2}};function initCodeMirror(){if("undefined"==typeof CodeMirror){console.error("CodeMirror library not found. Please ensure codemirror.js is loaded.");return}modeInput=document.getElementById("filename"),CodeMirror.modeURL="lib.assets/cm/mode/%N/%N.js",fileManagerEditor=CodeMirror.fromTextArea(document.getElementById("code"),{lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,indentUnit:4,indentWithTabs:!1}),window.setEditorModeByFilename=function(e){let t="text/plain",n=2,l=!1,a=e.lastIndexOf("."),i=a>-1?e.substring(a+1).toLowerCase():"",r=editorModeMap[i];if(r)t=r.mode,n=r.indentUnit,void 0!==r.indentWithTabs&&(l=r.indentWithTabs);else if(i){let o=CodeMirror.findModeByExtension(i);o&&(t=o.mime)}fileManagerEditor.setOption("mode",t),fileManagerEditor.setOption("indentWithTabs",l),fileManagerEditor.setOption("indentUnit",n);let d=CodeMirror.findModeByMIME(t)?.mode||t;CodeMirror.autoLoadMode(fileManagerEditor,d),console.log(`Editor mode set to: ${t} for file: ${e} (Indent: ${n} spaces, Tabs: ${l?"Yes":"No"})`)},window.addEventListener("resize",function(e){let t=document.querySelector("#file-content").offsetWidth-16,n=document.innerHeight-160;fileManagerEditor.setSize(t,n)});let e=document.querySelector("#file-content").offsetWidth-16,t=document.innerHeight-160;fileManagerEditor.setSize(e,t)}