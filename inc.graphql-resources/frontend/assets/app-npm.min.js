let graphqlApp=null,backendBaseUrl="http://localhost:4000/",frontendBaseUrl="";function backToList(e){let a=sessionStorage.getItem("notification"===e?"lastNotificationListUrl":"lastMessageListUrl");a&&a!==location.href?location.href=a:(history.pushState(null,"",`#${e}`),graphqlApp.handleRouteChange())}async function handleProfileUpdate(e){let a=document.getElementById("profile-update-form"),t=new FormData(a);try{let r=await fetch("user-profile",{method:"POST",headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),window.location.hash="#user-profile"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(p){console.error("Error updating profile:",p),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handlePasswordUpdate(e){let a=document.getElementById("password-update-form"),t=new FormData(a);try{let r=await fetch("update-password",{method:"POST",headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),window.location.hash="#user-profile"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(p){console.error("Error updating password:",p),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handleSettingsUpdate(e){let a=document.getElementById("settings-update-form"),t=new FormData(a),r=parseInt(a.querySelector('[name="pageSize"]').value);try{let n=await fetch("settings",{method:"POST",headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),p=await n.json();p.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message}),isNaN(r)||(graphqlApp.state.limit=r),window.location.hash="#settings"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:p.message})}catch(l){console.error("Error updating settings:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handleAdminSave(e,a=null){e.preventDefault();let t=document.getElementById("admin-form"),r=new FormData(t);r.append("action",a?"update":"create"),a&&r.append("adminId",a);try{let n=await fetch("admin",{method:"POST",body:r,headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId}}),p=await n.json();p.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message}),window.location.hash="#admin"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:p.message})}catch(l){console.error("Error saving admin:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}async function handleAdminChangePassword(e,a){e.preventDefault();let t=document.getElementById("change-password-form"),r=new FormData(t);r.append("action","change_password"),r.append("adminId",a);try{let n=await fetch("admin",{method:"POST",body:r,headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId}}),p=await n.json();p.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message}),window.location.hash=`#admin/detail/${a}`):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:p.message})}catch(l){console.error("Error changing password:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}async function handleAdminToggleActive(e,a){let t=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_toggle_active",graphqlApp.t(a?"deactivate":"activate")),okText:graphqlApp.t("yes"),cancelText:graphqlApp.t("no")});if(!t)return;graphqlApp.closeConfirmModal();let r=new FormData;r.append("action","toggle_active"),r.append("adminId",e);try{let n=await fetch("admin",{method:"POST",body:r,headers:{"X-Requested-With":"xmlhttprequest"}}),p=await n.json();p.success?graphqlApp.handleRouteChange():await graphqlApp.customAlert({title:graphqlApp.t("error"),message:p.message})}catch(l){console.error("Error toggling admin status:",l)}}async function handleAdminDelete(e){let a=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_delete")});if(!a)return;graphqlApp.closeConfirmModal();let t=new FormData;t.append("action","delete"),t.append("adminId",e);try{await fetch("admin",{method:"POST",body:t,headers:{"X-Requested-With":"xmlhttprequest"}}),graphqlApp.handleRouteChange()}catch(r){console.error("Error deleting admin:",r)}}function handleAdminSearch(e){e.preventDefault();let a=document.getElementById("admin-search-form"),t=a.querySelector('input[name="search"]'),r=t.value.trim(),n=r?`#admin?search=${encodeURIComponent(r)}`:"#admin";window.location.hash=n}async function handleMessageDelete(e){let a=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_delete")});if(!a)return;graphqlApp.closeConfirmModal();let t=new FormData;t.append("action","delete"),t.append("messageId",e);try{let r=await fetch("message",{method:"POST",body:t,headers:{"X-Requested-With":"xmlhttprequest"}}),n=await r.json();if(n.success){await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message});let p=window.location.hash;p.includes("messageId=")?backToList("message"):graphqlApp.handleRouteChange()}else await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(l){console.error("Error deleting message:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}function handleMessageSearch(e){e.preventDefault();let a=document.getElementById("message-search-form"),t=a.querySelector('input[name="search"]'),r=t.value.trim(),n=r?`#message?search=${encodeURIComponent(r)}`:"#message";window.location.hash=n}async function handleNotificationDelete(e){let a=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_delete")});if(!a)return;graphqlApp.closeConfirmModal();let t=new FormData;t.append("action","delete"),t.append("notificationId",e);try{let r=await fetch("notification",{method:"POST",body:t,headers:{"X-Requested-With":"xmlhttprequest"}}),n=await r.json();if(n.success){let p=window.location.hash;p.includes("notificationId=")?backToList("notification"):graphqlApp.handleRouteChange()}}catch(l){console.error("Error deleting notification:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}function handleNotificationSearch(e){e.preventDefault();let a=document.getElementById("notification-search-form"),t=a.querySelector('input[name="search"]'),r=t.value.trim(),n=r?`#notification?search=${encodeURIComponent(r)}`:"#notification";window.location.hash=n}async function markMessageAsUnread(e,a="list"){let t=new FormData;t.append("action","mark_as_unread"),t.append("messageId",e);try{let r=await fetch("message",{method:"POST",headers:{"X-Requested-with":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),r.ok&&("detail"===a?backToList("message"):graphqlApp.handleRouteChange())}catch(p){console.error("Error marking message as unread:",p)}}async function markNotificationAsUnread(e,a="list"){let t=new FormData;t.append("action","mark_as_unread"),t.append("notificationId",e);try{let r=await fetch("notification",{method:"POST",headers:{"X-Requested-with":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),r.ok&&("detail"===a?backToList("notification"):graphqlApp.handleRouteChange())}catch(p){console.error("Error marking notification as unread:",p)}}document.addEventListener("DOMContentLoaded",()=>{(graphqlApp=new GraphQLClientApp({configUrl:backendBaseUrl+"frontend-config",apiUrl:backendBaseUrl+"graphql",loginUrl:backendBaseUrl+"login",logoutUrl:backendBaseUrl+"logout",entityLanguageUrl:frontendBaseUrl+"entity-language-{lang}.json",i18nUrl:frontendBaseUrl+"language-{lang}.json",themeConfigUrl:frontendBaseUrl+"available-theme.json",languageConfigUrl:frontendBaseUrl+"available-language.json",defaultActiveField:"active",defaultDisplayField:"name",languageId:null,defaultLanguage:"en",customRenderers:{}})).pages.dashboard={url:"dashboard",title:"dashboard",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["user-profile"]={url:"user-profile",title:"profile",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["user-profile-update"]={url:"user-profile-update",title:"profile",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.settings={url:"settings",title:"settings",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["settings-update"]={url:"settings-update",title:"settings",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.message={url:"message",title:"message",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.notification={url:"notification",title:"notification",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.admin={url:"admin",title:"admin",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["update-password"]={url:"update-password",title:"update_password",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(e,a)},render(e,a,t){}}}),window.addEventListener("hashchange",()=>{let e=location.hash;e.startsWith("#message")&&!e.includes("messageId=")&&sessionStorage.setItem("lastMessageListUrl",location.href),e.startsWith("#notification")&&!e.includes("notificationId=")&&sessionStorage.setItem("lastNotificationListUrl",location.href)});