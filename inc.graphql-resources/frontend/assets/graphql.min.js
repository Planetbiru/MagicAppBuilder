    class GraphQLClientApp{constructor(t={}){let e={configUrl:"frontend-config.php",apiUrl:"graphql.php",loginUrl:"login.php",logoutUrl:"logout.php",entityLanguageUrl:"entity-language.php?lang={lang}",i18nUrl:"language.php?lang={lang}",languageConfigUrl:"available-language.php",themeConfigUrl:"available-theme.php",defaultThemeUrl:"assets/style.min.css",customRenderers:{},defaultActiveField:"active",defaultDisplayField:"name",languageId:null,defaultLanguage:"en",useBrowserLanguage:!0,maxMergedFilters:0,pages:{}};Object.assign(this,e,t),this.supportedLanguages={},this.availableThemes=[],this.uiTranslations={},this.entityLanguagePack={},this.config=null,this.currentEntity=null,this.currentEntityDisplayName="",this.state={page:1,limit:10,filters:{},orderBy:{}},this.i18n={},this.dom={menu:document.getElementById("entity-menu"),menuFilterInput:document.getElementById("entity-menu-filter"),title:document.getElementById("content-title"),body:document.getElementById("content-body"),modal:document.getElementById("form-modal"),modalTitle:document.getElementById("modal-title"),form:document.getElementById("entity-form"),closeModalBtn:document.querySelector(".close-button"),loginModal:document.getElementById("login-modal"),loginForm:document.getElementById("login-form"),logoutBtn:document.querySelector(".logout-link"),reloadConfigBtn:document.getElementById("reload-config-btn"),logoutBtnDropdown:document.getElementById("logout-btn-dropdown"),sidebarToggle:document.getElementById("sidebar-toggle"),sidebar:document.getElementById("sidebar-nav"),mainContent:document.getElementById("main-content"),langMenu:document.getElementById("lang-menu"),themeMenu:document.getElementById("theme-menu"),filterContainer:document.getElementById("filter-container"),tableDataContainer:document.getElementById("table-data-container"),paginationContainer:document.getElementById("pagination-container"),loadingBar:document.getElementById("loading-bar"),themeToggle:document.getElementById("theme-toggle"),pageWrapper:document.getElementById("page-wrapper"),infoModal:document.getElementById("infoModal"),infoModalTitle:document.getElementById("infoModalTitle"),infoModalMessage:document.getElementById("infoModalMessage"),infoModalOk:document.getElementById("infoModalOk"),themeStylesheet:document.getElementById("theme-stylesheet")},this.applicationTitle=document.querySelector('meta[name="title"]').getAttribute("content"),this.init()}initPage(){this.dom.sidebarToggle&&this.dom.sidebar&&this.dom.mainContent&&this.dom.sidebarToggle.addEventListener("click",()=>{let t=document.documentElement.classList.toggle("sidebar-collapsed");localStorage.setItem("sidebarCollapsed",t)}),this.dom.sidebar.classList.add("sidebar-animated"),document.querySelectorAll("[data-dropdown]").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();let i=t.dataset.dropdown,a=document.getElementById(i);a&&(document.querySelectorAll(".dropdown-menu.active").forEach(t=>{t!==a&&t.classList.remove("active")}),a.classList.toggle("active"))})}),window.addEventListener("click",()=>{document.querySelectorAll(".dropdown-menu.active").forEach(t=>t.classList.remove("active"))}),this.dom.logoutBtnDropdown&&(this.dom.logoutBtnDropdown.onclick=t=>this.handleLogout(t)),this.dom.reloadConfigBtn&&(this.dom.reloadConfigBtn.onclick=t=>this.reloadConfiguration(t)),this.dom.langMenu.addEventListener("click",t=>{if(t.target.matches("a[data-lang]")){t.preventDefault();let e=t.target.dataset.lang;this.changeLanguage(e)}}),this.dom.themeMenu.addEventListener("click",t=>{if(t.target.matches("a[data-theme-name]")){t.preventDefault();let e=t.target.dataset.themeName;this.changeTheme(e),this.dom.themeMenu.classList.remove("active")}}),this.dom.themeToggle.addEventListener("click",()=>this.toggleTheme()),window.addEventListener("storage",t=>{"themeName"===t.key?this.applyTheme(t.newValue):"colorMode"===t.key?this.applyThemeMode(t.newValue):"userLanguage"===t.key&&this.changeLanguage(t.newValue)}),this.dom.menuFilterInput&&this.dom.menuFilterInput.addEventListener("input",t=>this.filterMenu(t.target.value)),window.addEventListener("click",t=>{t.target.classList.contains("modal")&&(t.target.id===this.dom.modal.id?this.closeModal():t.target.id===this.dom.loginModal.id||("customConfirmModal"===t.target.id?this.closeConfirmModal():t.target.id===this.dom.infoModal.id&&this.dom.infoModal.classList.remove("show")))}),document.addEventListener("keydown",t=>{if("Escape"===t.key){let e=Array.from(document.querySelectorAll(".modal")).filter(t=>"block"===t.style.display||t.classList.contains("show")).sort((t,e)=>{let i=parseInt(window.getComputedStyle(t).zIndex,10)||0,a=parseInt(window.getComputedStyle(e).zIndex,10)||0;return a-i});e.length>0&&e[0].click()}})}handleUnauthorized(){"block"!==this.dom.loginModal.style.display&&(this.hidePageWrapper(),document.getElementById("login-error").textContent=this.t("session_expired"),this.openLoginModal())}async init(){this.dom.loginForm.onsubmit=t=>this.handleLogin(t),this.dom.logoutBtn.onclick=t=>this.handleLogout(t);try{await this.initializeLanguage(),await this.initializeTheme(),await this.loadI18n(),await this.loadLanguage(),this.applyI18n(),await this.loadConfig(),this.showPageWrapper(),this.buildMenu(),this.initPage(),window.onclick=t=>{},document.addEventListener("click",t=>{let e=t.target.closest('[data-dismiss="modal"]');if(e){let i=e.closest(".modal");i&&(i.id===this.dom.modal.id?this.closeModal():i.id===this.dom.loginModal.id?this.closeLoginModal():(i.id,this.dom.infoModal.id,i.classList.remove("show")))}}),window.addEventListener("popstate",()=>this.handleRouteChange()),this.handleRouteChange()}catch(t){this.dom.body.innerHTML=`<p style="color: red;">Error: ${t.message}</p>`}}_invokeRenderHook(t,e){let i=e.entity.name;return!!this.customRenderers[i]&&"function"==typeof this.customRenderers[i][t]&&(this.customRenderers[i][t](e),!0)}async initializeLanguage(){try{let t=await fetch(this.languageConfigUrl,{headers:{"X-Requested-With":"xmlhttprequest","X-Language-Id":this.languageId,"Accept-Language":this.languageId}});if(!t.ok)throw Error(`Could not fetch ${this.languageConfigUrl}`);let e=await t.json();this.supportedLanguages=e.supported,this.defaultLanguage=e.default;let i=localStorage.getItem("userLanguage"),a=this.defaultLanguage;if(i&&this.supportedLanguages[i])a=i;else if(this.useBrowserLanguage){let n=navigator.language.split("-")[0];this.supportedLanguages[n]&&(a=n)}this.languageId=a,localStorage.setItem("userLanguage",this.languageId),localStorage.setItem("languageId",this.languageId),document.documentElement.lang=this.languageId,this.populateLangMenu()}catch(s){console.error("Failed to initialize language configuration, falling back to default:",s),this.supportedLanguages={en:"English"},this.defaultLanguage="en",this.languageId=this.defaultLanguage,localStorage.setItem("userLanguage",this.languageId),localStorage.setItem("languageId",this.languageId),document.documentElement.lang=this.languageId,this.populateLangMenu()}}populateLangMenu(){for(let[t,e]of(this.dom.langMenu.innerHTML="",Object.entries(this.supportedLanguages))){let i=document.createElement("li"),a=document.createElement("a");a.href="#",a.dataset.lang=t,t===this.languageId&&a.classList.add("active"),a.textContent=e,i.appendChild(a),this.dom.langMenu.appendChild(i)}}async initializeTheme(){try{let t=await fetch(this.themeConfigUrl,{headers:{"X-Requested-With":"xmlhttprequest","X-Language-Id":this.languageId,"Accept-Language":this.languageId}});if(!t.ok)throw Error(`Could not fetch ${this.themeConfigUrl}`);this.availableThemes=await t.json(),this.populateThemeMenu()}catch(e){console.error("Failed to initialize theme configuration:",e),this.populateThemeMenu()}finally{let i=localStorage.getItem("colorMode")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");this.applyThemeMode(i)}}async loadConfig(){let t=await fetch(this.configUrl,{headers:{"X-Requested-With":"xmlhttprequest","X-Language-Id":this.languageId,"Accept-Language":this.languageId}});if(401===t.status)throw this.handleUnauthorized(),Error("Authentication required.");if(!t.ok)throw Error(`Failed to load config from ${this.configUrl}`);this.config=await t.json(),this.config.pagination&&this.config.pagination.pageSize&&(this.state.limit=this.config.pagination.pageSize)}async loadLanguage(){try{if(this.entityLanguageUrl){let t=this.entityLanguageUrl.replace("{lang}",this.languageId),e=await fetch(t,{headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":this.languageId,"Accept-Language":this.languageId}});if(401===e.status)throw this.handleUnauthorized(),Error("Authentication required.");if(!e.ok)throw Error(`Failed to load language from ${t}`);let i=await e.json();for(let a in this.entityLanguagePack[this.languageId]={},i.entities)void 0===this.entityLanguagePack[this.languageId][a]&&(this.entityLanguagePack[this.languageId][a]={}),this.entityLanguagePack[this.languageId][a].displayName=i.entities[a].displayName,this.entityLanguagePack[this.languageId][a].columns=i.entities[a].columns}}catch(n){console.warn(`Could not load entity language file for '${this.languageId}'. Falling back to generated labels.`,n)}}async loadI18n(){try{if(this.i18nUrl){let t=this.i18nUrl.replace("{lang}",this.languageId),e=await fetch(t,{headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":this.languageId,"Accept-Language":this.languageId}});if(!e.ok)throw Error(`Failed to load i18n from ${t}`);this.i18n=await e.json()}}catch(i){console.warn("Could not load language file. Falling back to key-based labels.",i),this.i18n={}}}applyI18n(){document.querySelectorAll("[data-i18n]").forEach(t=>{if("entity-menu-filter"===t.id&&t.hasAttribute("placeholder")){t.placeholder=this.t("menu_filter");return}let e=t.getAttribute("data-i18n");"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.placeholder=this.t(e):t.textContent=this.t(e)}),document.querySelectorAll("[data-i18n-title]").forEach(t=>{let e=t.getAttribute("data-i18n-title");t.title=this.t(e)})}t(t,...e){let i=this.i18n[t];if(i)return e.forEach((t,e)=>{let a=RegExp(`\\{${e}\\}`,"g");i=i.replace(a,t)}),i;let a=this._generateLabelFromKey(t);return[a,...e].join(" ")}changeLanguage(t){localStorage.setItem("userLanguage",t),localStorage.setItem("languageId",t),window.location.reload()}toggleTheme(){let t=document.documentElement.getAttribute("data-theme")||"light",e="dark"===t?"light":"dark";this.applyThemeMode(e),localStorage.setItem("colorMode",e)}populateThemeMenu(){this.dom.themeMenu.innerHTML="";let t=localStorage.getItem("themeName");this.availableThemes.forEach(e=>{let i=document.createElement("li"),a=document.createElement("a");a.href="#",a.dataset.themeName=e.name,e.name===t&&a.classList.add("active"),a.textContent=e.title,i.appendChild(a),this.dom.themeMenu.appendChild(i)})}changeTheme(t){localStorage.getItem("themeName")!==t&&(localStorage.setItem("themeName",t),this.applyTheme(t),this.dom.themeMenu.querySelectorAll("a").forEach(e=>{e.classList.toggle("active",e.dataset.themeName===t)}))}async applyTheme(t){let e=t?`assets/themes/${t}/style.min.css`:this.defaultThemeUrl;if(this.dom.themeStylesheet&&this.dom.themeStylesheet.href.endsWith(e))return;let i=document.createElement("link");i.rel="stylesheet",i.href=e,document.head.appendChild(i),i.onload=()=>{let t=this.dom.themeStylesheet;t&&t.parentNode&&t.parentNode.removeChild(t),this.dom.themeStylesheet=i,i.id="theme-stylesheet"},i.onerror=()=>{console.error(`Failed to load theme: ${e}. Keeping the current theme.`),i.parentNode&&i.parentNode.removeChild(i)}}applyThemeMode(t){document.documentElement.setAttribute("data-theme",t)}getEntityLabel(t,e){let i=this.snakeCase(t.name);if(!this.entityLanguagePack||!this.entityLanguagePack[this.languageId])return this.snakeCaseToTitleCase(e);{let a=this.entityLanguagePack[this.languageId][t.name];return(a||(a=this.entityLanguagePack[this.languageId][i]),a&&a.columns&&a.columns[e])?a.columns[e]:this.snakeCaseToTitleCase(e)}}getTranslatedEntityName(t){if(!this.entityLanguagePack||!this.entityLanguagePack[this.languageId])return this.camelCaseToTitleCase(t.displayName);{let e=this.entityLanguagePack[this.languageId][t.originalName];return e&&e.displayName?e.displayName:this.camelCaseToTitleCase(t.displayName)}}getPreferredLanguages(){return navigator.languages&&navigator.languages.length?navigator.languages:navigator.language?[navigator.language]:["en"]}buildMenu(){let t=this;if(!this.config||!this.config.entities)return;this.dom.menu.innerHTML="";let e=Object.values(this.config.entities).sort((t,e)=>{let i=void 0!==t.sortOrder?t.sortOrder:1/0,a=void 0!==e.sortOrder?e.sortOrder:1/0;return i-a});e.forEach(e=>{if(e.menu){let i=document.createElement("li"),a=document.createElement("a");a.href=`#${e.name}`,a.textContent=t.getTranslatedEntityName(e),a.onclick=t=>{t.preventDefault(),this.navigateTo(e.name,{limit:this.state.limit})},i.appendChild(a),this.dom.menu.appendChild(i)}})}filterMenu(t){let e=t.toLowerCase().trim(),i=this.dom.menu.querySelectorAll("li");i.forEach(t=>{let i=t.textContent.toLowerCase();i.includes(e)?t.style.display="":t.style.display="none"})}async gqlQuery(t,e={}){this.dom.loadingBar.style.display="block";try{let i=await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"xmlhttprequest","X-Language-Id":this.languageId,"Accept-Language":this.languageId,Accept:"application/json"},body:JSON.stringify({query:t,variables:e})});if(401===i.status)throw this.handleUnauthorized(),Error("Authentication required.");let a=await i.json();return a}catch(n){throw n}finally{this.dom.loadingBar.style.display="none"}}navigateTo(t,e={}){let i=e.filters||{},a=e.orderBy||{},n=new URLSearchParams;n.set("page",e.page||1),n.set("limit",e.limit||10),Object.entries(i).forEach(([t,e])=>{e&&n.set(t,e)}),a.field&&(n.set("orderBy",a.field),n.set("orderDir",a.direction));let s=`${window.location.pathname}#${t}?${n.toString()}`;history.pushState({entityName:t,params:e},"",s),this.handleRouteChange()}navigateToDetail(t,e,i=null){let a="";i&&(a=`?from=${encodeURIComponent(i)}`);let n=`${window.location.pathname}#${t}/detail/${e}${a}`;history.pushState({entityName:t,id:e},"",n),this.handleRouteChange()}async handlePage(t){let e=this.pages[t];if(e)try{let i=this.t(e.title);if(this.dom.title.textContent=i,document.title=`${i} - ${this.applicationTitle}`,document.querySelectorAll("#entity-menu a").forEach(t=>t.classList.remove("active")),e.url){let[a,n]=e.url.split("?"),[s,l]=window.location.hash.split("?"),r=new URLSearchParams;new URLSearchParams(l).forEach((t,e)=>{r.set(e,t)});let o=`${a}?${r.toString()}`;this.dom.loadingBar.style.display="block";let d={method:e.method,headers:{"X-Requested-With":"xmlhttprequest","X-Language-Id":this.languageId,"Accept-Language":this.languageId,Accept:e.accept||"*"}};e.body&&(d.body=e.body);let h=await fetch(o,d);if(200!=h.status){"function"==typeof e.error&&e.error(h.status,h.statusText,this.dom.tableDataContainer,this.dom);return}let c;c=e?.accept&&-1!=e.accept?.indexOf("json")?await h.json():await h.text(),"function"==typeof e.success&&e.success(c,this.dom.tableDataContainer,this.dom)}else e.content&&"function"==typeof e.render&&e.render(e.content,this.dom.tableDataContainer,this.dom)}catch(u){throw u}finally{this.dom.loadingBar.style.display="none"}}async handleRouteChange(){let t=window.location.hash.substring(1);if(!t||"#"===t){this.renderDashboardView();return}let[e,i]=t.split("?"),a=e.split("/");if(this.pages[a[0]]){this.handlePage(a[0]);return}let n=a[0],s=a.length>1?a[1]:"list",l=a.length>2?a[2]:null,r=new URLSearchParams(i),o=this.config.entities[n];if(!o){this.dom.body.innerHTML=`<p>Page "${n}" not found.</p>`;return}this.currentEntity=o;let d=this.applicationTitle;this.currentEntityDisplayName=this.getTranslatedEntityName(o),document.title=`${this.currentEntityDisplayName} - ${d}`;let h={};for(let[c,u]of r.entries())"page"!==c&&"limit"!==c&&(h[c]=u);let m={};r.has("orderBy")&&(m.field=r.get("orderBy"),m.direction=r.get("orderDir")||"ASC");let g=r.get("limit"),y=null!==g?parseInt(g,10):this.state.limit||10;if(this.state={page:parseInt(r.get("page"))||1,limit:y,filters:h,orderBy:m},this.config&&this.config.pagination){let{minPageSize:p,maxPageSize:f}=this.config.pagination;p&&this.state.limit<p&&(this.state.limit=p),f&&this.state.limit>f&&(this.state.limit=f)}document.querySelectorAll("#entity-menu a").forEach(t=>t.classList.toggle("active",t.getAttribute("href")===`#${n}`)),"detail"===s&&l?(this.dom.filterContainer.style.display="none",this.clearListView(),await this.renderDetailView(l)):(this.dom.filterContainer.style.display="block",await this.renderListView(),await this.updateTableView())}renderDashboardView(){let t=this.t("dashboard");document.title=`${this.applicationTitle}`,this.dom.title.textContent=t,document.querySelectorAll("#entity-menu a").forEach(t=>t.classList.remove("active")),this.dom.filterContainer.style.display="none",this.clearListView(),this.dom.tableDataContainer.innerHTML=`<p>${this.t("welcome_dashboard")}</p>`}async renderListView(){this.clearListView(),this.dom.title.textContent=this.t("list_of",this.currentEntityDisplayName),this.showPageWrapper(),await this.renderFilters()}async updateTableView(){let t=this.getFieldsForQuery(this.currentEntity,1,1),e=(this.state.page-1)*this.state.limit,i=[];this.currentEntity.filters&&Object.entries(this.state.filters).forEach(([t,e])=>{let a=this.currentEntity.filters.find(e=>e.name===t);e&&a&&i.push({field:t,value:e,operator:a.operator||"EQUALS"})});let a=[];this.state.orderBy&&this.state.orderBy.field&&a.push(this.state.orderBy);let n=`
    query Get${this.ucFirst(this.currentEntity.pluralName)}($limit: Int, $offset: Int, $orderBy: [SortInput], $filter: [FilterInput]) {
    ${this.currentEntity.pluralName}(limit: $limit, offset: $offset, orderBy: $orderBy, filter: $filter) {
    items { ${t} }
    total
    limit
    page
    totalPages
    hasNext
    hasPrevious
    }
    }
    `;try{this.dom.tableDataContainer.innerHTML=this.t("loading"),this.dom.paginationContainer.innerHTML="";let s=await this.gqlQuery(n,{limit:this.state.limit,offset:e,orderBy:a,filter:i}),l={};if(s&&s.data){let r=s&&s.data?s.data:{};l=r&&r[this.currentEntity.pluralName]?r[this.currentEntity.pluralName]:{}}l&&l.items&&l.items.length>0?this.renderTable(l.items):this.dom.tableDataContainer.innerHTML='<p style="color: red;">Data not found</p>',this.renderPagination(l),l.errors&&l.errors.length>0&&console.error(l.errors)}catch(o){this.dom.tableDataContainer.innerHTML=`<p style="color: red;">${o.message}</p>`}}renderTable(t){let e=this.currentEntity.listColumns||[],i=Object.keys(this.currentEntity.columns).filter(t=>0===e.length||e.includes(t)),a=`
    <div class="table-container">

    <table class="table table-data-list table-striped">
    <thead>
    <tr>
    ${i.map(t=>{let e=this.state.orderBy.field===t;return`<th class="sortable" data-sort-key="${t}" data-sort-direction="${e?"ASC"===this.state.orderBy.direction?"asc":"desc":""}">
    ${this.getEntityLabel(this.currentEntity,t)}
    </th>`}).join("")} 
    <th>${this.t("actions")}</th>
    </tr>
    </thead>
    <tbody>
    `;0===t.length?a+=`<tr><td colspan="${i.length+1}">${this.t("no_items_found")}</td></tr>`:t.forEach(t=>{let e=this.currentEntity.activeField||this.defaultActiveField,n=!0;this.currentEntity.hasActiveColumn&&(n=1===t[e]||"1"===t[e]||!0===t[e]),a+=`<tr${n?"":' class="inactive"'}>`,i.forEach(e=>{let i=this.currentEntity.columns[e],n=t[e],s=i.references;if(i.isForeignKey&&t[s]){let l=this.config.entities[this.camelCase(s)],r=l&&l.displayField?l.displayField:l.primaryKey;t[s]&&void 0!==t[s][r]?n=t[s][r]||"N/A":t[s]&&void 0!==t[s][l.primaryKey]&&(n=t[s][l.primaryKey])}else if((i.type.includes("boolean")||e===this.currentEntity.activeField)&&this.config.booleanDisplay){let o=1===n||"1"===n||!0===n;n=o?this.t(this.config.booleanDisplay.trueLabelKey):this.t(this.config.booleanDisplay.falseLabelKey)}a+=`<td>${null!==n?n:"N/A"}</td>`}),a+=this.renderActionButtons(t),a+="</tr>"}),a+="</tbody></table></div>",this.dom.tableDataContainer.innerHTML=a,document.querySelectorAll(".btn-detail").forEach(t=>t.onclick=t=>{!t.ctrlKey&&!t.metaKey&&(t.preventDefault(),this.navigateToDetail(this.currentEntity.name,t.currentTarget.dataset.id,window.location.hash))}),document.querySelectorAll(".btn-edit").forEach(t=>t.onclick=t=>this.renderForm(t.currentTarget.dataset.id)),document.querySelectorAll(".btn-delete").forEach(t=>t.onclick=t=>this.handleDelete(t.currentTarget.dataset.id)),document.querySelectorAll(".btn-toggle-active").forEach(t=>t.onclick=t=>this.handleToggleActive(t.currentTarget.dataset.id,"true"===t.currentTarget.dataset.active)),document.querySelectorAll("th.sortable").forEach(t=>{t.style.cursor="pointer",t.onclick=()=>this.handleSort(t.dataset.sortKey)})}getPrefetchedDataForEntity(t,e){return e&&e[t.pluralName]&&e[t.pluralName].items?e[t.pluralName].items:[]}async renderFilters(){return this.currentEntity.filterEntities&&this.currentEntity.filterEntities>this.maxMergedFilters?await this.renderFiltersSeparated():await this.renderFiltersMerged()}async renderFiltersMerged(){let t=this.currentEntity.filters&&this.currentEntity.filters.length>0,e="",i={};if(t){let a=[],n=this.currentEntity.filters.filter(t=>"select"===t.element);for(let s of n){let l=this.currentEntity.columns[s.name];if(l&&l.isForeignKey){let r=this.config.entities[this.camelCase(l.references)];if(r){let o=this.getFieldsForQuery(r,0,1);a.push(`${r.pluralName}(limit: 1000) { items { ${o} } }`)}}}if(a.length>0){let d=`query FetchAllFilterData { ${a.join("\n")} }`;try{let h=await this.gqlQuery(d);i=h.data}catch(c){console.error("Failed to pre-fetch filter data:",c)}}for(let u of(e+='<div class="filter-controls">',this.currentEntity.filters)){let m=this.state.filters[u.name]||"";if(e+='<div class="form-group">',e+=`<label for="filter-${u.name}">${this.getEntityLabel(this.currentEntity,u.name)}</label>`,"select"===u.element){let g=this.currentEntity.columns[u.name],y=this.config.entities[this.camelCase(g.references)],p=this.getPrefetchedDataForEntity(y,i),f=y.displayField||y.primaryKey;e+=`<select id="filter-${u.name}" name="${u.name}">`,e+=`<option value="">${this.t("select_option")}</option>`,p.forEach(t=>{let i=t[y.primaryKey],a=t[f]||i;e+=`<option value="${i}" ${String(i)===String(m)?"selected":""}>${a}</option>`}),e+="</select>"}else e+=`<input type="text" id="filter-${u.name}" name="${u.name}" value="${m}" placeholder="${this.getEntityLabel(this.currentEntity,u.name)}">`;e+="</div>"}e+=`<button id="search-btn" class="btn btn-primary">${this.t("search")}</button>`,e+=`<button id="reset-filter-btn" class="btn btn-secondary">${this.t("reset_filter")}</button>`}e+=`<button id="add-new-btn" class="btn btn-primary">${this.t("add_new",this.currentEntityDisplayName)}</button>`,t&&(e+="</div>"),this.dom.filterContainer.innerHTML=e,t&&(document.getElementById("search-btn").onclick=()=>this.handleSearch(),document.getElementById("reset-filter-btn").onclick=()=>this.handleResetFilters(),this.dom.filterContainer.querySelectorAll(".filter-controls input, .filter-controls select").forEach(t=>{t.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),this.handleSearch())})})),document.getElementById("add-new-btn").onclick=()=>this.renderForm()}async renderFiltersSeparated(){let t=this.currentEntity.filters&&this.currentEntity.filters.length>0,e="";if(t){for(let i of(e+='<div class="filter-controls">',this.currentEntity.filters)){let a=this.state.filters[i.name]||"";if(e+='<div class="form-group">',e+=`<label for="filter-${i.name}">${this.getEntityLabel(this.currentEntity,i.name)}</label>`,"select"===i.element){let n=this.currentEntity.columns[i.name];if(!n||!n.isForeignKey){console.error(`Filter "${i.name}" is of type 'select' but no corresponding foreign key column was found in the entity configuration.`);continue}let s=this.config.entities[this.camelCase(n.references)],l=s?await this.fetchAll(s):[],r=s.displayField||s.primaryKey;e+=`<select id="filter-${i.name}" name="${i.name}">`,e+=`<option value="">${this.t("select_option")}</option>`,l.forEach(t=>{let i=t[s.primaryKey],n=t[r]||i;e+=`<option value="${i}" ${String(i)===String(a)?"selected":""}>${n}</option>`}),e+="</select>"}else e+=`<input type="text" id="filter-${i.name}" name="${i.name}" value="${a}" placeholder="${this.getEntityLabel(this.currentEntity,i.name)}">`;e+="</div>"}e+=`<button id="search-btn" class="btn btn-primary">${this.t("search")}</button>`,e+=`<button id="reset-filter-btn" class="btn btn-secondary">${this.t("reset_filter")}</button>`}e+=`<button id="add-new-btn" class="btn btn-primary">${this.t("add_new",this.currentEntityDisplayName)}</button>`,t&&(e+="</div>"),this.dom.filterContainer.innerHTML=e,t&&(document.getElementById("search-btn").onclick=()=>this.handleSearch(),document.getElementById("reset-filter-btn").onclick=()=>this.handleResetFilters(),this.dom.filterContainer.querySelectorAll(".filter-controls input, .filter-controls select").forEach(t=>{t.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),this.handleSearch())})})),document.getElementById("add-new-btn").onclick=()=>this.renderForm()}clearListView(){this.dom.filterContainer.innerHTML="",this.dom.tableDataContainer.innerHTML="",this.dom.paginationContainer.innerHTML="",this.dom.paginationContainer.style.display="none"}handleSearch(){let t={};this.dom.filterContainer.querySelectorAll("input, select").forEach(e=>{t[e.name]=e.value}),this.state.page=1,this.state.filters=t,this.updateUrlForState(),this.updateTableView()}handleResetFilters(){this.dom.filterContainer.querySelectorAll("input, select").forEach(t=>{t.value=""}),this.state.filters={},this.state.orderBy={},this.state.page=1,this.updateUrlForState(),this.updateTableView()}handleSort(t){let e="ASC";this.state.orderBy.field===t&&"ASC"===this.state.orderBy.direction&&(e="DESC"),this.state.orderBy={field:t,direction:e},this.state.page=1,this.updateUrlForState(),this.updateTableView()}renderActionButtons(t){let e=this.currentEntity.name,i=t[this.currentEntity.primaryKey],a=encodeURIComponent(window.location.hash),n=`${window.location.pathname}#${e}/detail/${i}?from=${a}`,s='<td class="actions">';if(s+=`<a class="btn btn-sm btn-info btn-detail" data-id="${i}" href="${n}" data-from-url="${window.location.hash}">${this.t("view")}</a> `,s+=`<button class="btn btn-sm btn-primary btn-edit" data-id="${i}">${this.t("edit")}</button> `,this.currentEntity.hasActiveColumn){let l=this.currentEntity.activeField||this.defaultActiveField,r=1===t[l]||"1"===t[l]||!0===t[l];s+=`<button class="btn btn-sm ${r?"btn-warning":"btn-success"} btn-toggle-active" data-id="${i}" data-active="${r}">${r?this.t("deactivate"):this.t("activate")}</button> `}return s+`<button class="btn btn-sm btn-danger btn-delete" data-id="${i}">${this.t("delete")}</button></td>`}renderPagination(t){if(!t||0===t.total){this.dom.paginationContainer.innerHTML="";return}let e=this.state.page-1,i=this.state.page+1,a=t=>{let e=window.location.hash,[i,a]=e.split("?"),n=new URLSearchParams(a||"");n.set("page",t),n.set("limit",this.state.limit),Object.entries(this.state.filters).forEach(([t,e])=>{e?n.set(t,e):n.delete(t)}),this.state.orderBy.field?(n.set("orderBy",this.state.orderBy.field),n.set("orderDir",this.state.orderBy.direction)):(n.delete("orderBy"),n.delete("orderDir"));let s=this.currentEntity.name;return`${window.location.pathname}#${s}?${n.toString()}`},n=t.hasPrevious?a(e):"#",s=t.hasNext?a(i):"#";this.dom.paginationContainer.innerHTML=`
    <span>${this.t("page_of",t.page,t.totalPages,t.total)}</span>
    <a id="prev-page" href="${n}" class="btn btn-secondary ${t.hasPrevious?"":"disabled"}">${this.t("previous")}</a>
    <a id="next-page" href="${s}" class="btn btn-secondary ${t.hasNext?"":"disabled"}">${this.t("next")}</a>
    `,this.dom.paginationContainer.style.display="flex";let l=(t,e)=>{0===t.button&&!t.ctrlKey&&!t.metaKey&&(t.preventDefault(),t.currentTarget.classList.contains("disabled")||(this.state.page=e,this.updateUrlForState(),this.updateTableView()))};document.getElementById("prev-page").addEventListener("click",t=>l(t,e)),document.getElementById("next-page").addEventListener("click",t=>l(t,i))}updateUrlForState(){let t=new URLSearchParams;t.set("page",this.state.page),t.set("limit",this.state.limit),Object.entries(this.state.filters).forEach(([e,i])=>{i&&t.set(e,i)}),this.state.orderBy.field&&(t.set("orderBy",this.state.orderBy.field),t.set("orderDir",this.state.orderBy.direction));let e=`${window.location.pathname}#${this.currentEntity.name}?${t.toString()}`;history.pushState({entityName:this.currentEntity.name,params:this.state},"",e)}showPageWrapper(){this.dom.pageWrapper.style.display="block"}hidePageWrapper(){this.dom.pageWrapper.style.display="none"}async renderDetailView(t){this.dom.title.textContent=this.t("detail_of",this.currentEntityDisplayName);let e=this._invokeRenderHook("detail",{entity:this.currentEntity,container:this.dom.body,id:t});if(e)return;let i=this.getFieldsForQuery(this.currentEntity,2,2),a=`
    query Get${this.ucFirst(this.currentEntity.name)}($id: String!) {
    ${this.currentEntity.name}(id: $id) {
    ${i}
    }
    }
    `;try{let n=await this.gqlQuery(a,{id:t}),s=n.data;this.showPageWrapper();let l=this.currentEntity.detailColumns||[],r=s[this.currentEntity.name],o=`<div class="back-controls">
    <button id="back-to-list" class="btn btn-secondary">${this.t("back_to_list")}</button>
    </div>
    <div class="table-container detail-view">
    <table class="table">
    <tbody>`;for(let d in this.currentEntity.columns){if(!l.includes(d))continue;let h=this.currentEntity.columns[d],c=h.references;if(o+=`<tr>
    <td>${this.getEntityLabel(this.currentEntity,d)}</td>
    <td>`,h.isForeignKey&&r[c]){let u=r[c][this.currentEntity.displayField];null===u&&(u="N/A"),o+=`<span>${u}</span>`}else if((h.type.includes("boolean")||d===this.currentEntity.activeField)&&this.config.booleanDisplay){let m=1===r[d]||"1"===r[d]||!0===r[d];o+=`<span>${m?this.t(this.config.booleanDisplay.trueLabelKey):this.t(this.config.booleanDisplay.falseLabelKey)}</span>`}else o+=`<span>${null!==r[d]?r[d]:"N/A"}</span>`;o+="</td></tr>"}o+="</tbody></table></div>",this.dom.tableDataContainer.innerHTML=o,document.getElementById("back-to-list").onclick=()=>{if(history.length>1&&document.referrer&&new URL(document.referrer).origin===window.location.origin){history.back();return}let t=new URLSearchParams(window.location.hash.split("?")[1]),e=t.get("from");e?window.location.hash=decodeURIComponent(e):this.navigateTo(this.currentEntity.name)}}catch(g){this.dom.tableDataContainer.innerHTML=`<p style="color: red;">${this.t("failed_to_fetch_details")}</p>`}}async renderForm(t=null){this.dom.modalTitle.textContent=t?this.t("edit_entity",this.currentEntityDisplayName):this.t("add_new_entity",this.currentEntityDisplayName),this.dom.form.innerHTML=this.t("loading"),this.openModal();let e=t?"update":"insert",i=this._invokeRenderHook(e,{entity:this.currentEntity,container:this.dom.form,id:t});if(i)return;let a={};if(t){let n=this.getFieldsForQuery(this.currentEntity,2,2),s=`query GetForEdit($id: String!) { ${this.currentEntity.name}(id: $id) { ${n} } }`,l=await this.gqlQuery(s,{id:t}),r=l.data;a=r[this.currentEntity.name]}let o="";for(let d in this.currentEntity.columns){if(d===this.currentEntity.primaryKey&&("insert"===e&&"autogenerated"===this.currentEntity.columns[d].primaryKeyValue||"update"===e&&"manual-all"!=this.currentEntity.columns[d].primaryKeyValue)||this.currentEntity.backendHandledColumns&&this.currentEntity.backendHandledColumns.includes(d))continue;let h="insert"===e?this.currentEntity.insertColumns:this.currentEntity.updateColumns;if(h||(h=[]),h.length>0&&!h.includes(d))continue;let c=this.currentEntity.columns[d],u="";c.isForeignKey&&a[c.references]?u=a[c.references][this.config.entities[this.camelCase(c.references)].primaryKey]:void 0!==a[d]&&(u=a[d]);let m="",g="text";if(m+=`<label for="${d}">${this.getEntityLabel(this.currentEntity,d)}</label>`,c.isForeignKey){let y=c.references,p=this.config.entities[this.camelCase(y)],f=p?await this.fetchAll(p,{activeOnly:!t}):[],b=p.displayField||p.primaryKey;m+=`<select id="${d}" name="${d}">`,m+=`<option value="">${this.t("select_option")}</option>`,f.forEach(t=>{let e=t[p.primaryKey],i=t[b]||e;m+=`<option value="${e}" ${e==u?"selected":""}>${i}</option>`}),m+="</select>",g="select"}else if("textarea"===c.element)m+=`<textarea id="${d}" name="${d}" spellcheck="false" autocomplete="off">${u}</textarea>`,g="textarea";else{let E=this.currentEntity.activeField||this.defaultActiveField,L="text";c.type.includes("int")&&(L="number"),(c.type.includes("boolean")||d===E)&&(L="checkbox"),c.dataType.includes("datetime")||c.dataType.includes("timestamp")?(L="datetime-local",g="text"):c.dataType.includes("date")?(L="date",g="text"):c.dataType.includes("time")?(L="time",g="text"):c.dataType.includes("float")&&(L='number" step="any',g="text"),"checkbox"===L?(m+=`<input type="checkbox" id="${d}" name="${d}" ${u?"checked":""}>`,g="checkbox"):(m+=`<input type="${L}" id="${d}" name="${d}" value="${u}" autocomplete="off">`,g="text")}o+=`<div class="form-group form-element-${g}">${m}</div>`}o+='<div id="form-error"></div>',this.dom.form.innerHTML=o,this.dom.form.closest(".modal").querySelector(".modal-footer").innerHTML=`
    <button type="submit" class="btn btn-primary">${this.t("save")}</button> 
    <button type="button" class="btn btn-secondary" data-dismiss="modal">${this.t("close")}</button> `,this.dom.form.closest(".modal").querySelector(".modal-footer").querySelector('[type="submit"]').addEventListener("click",()=>this.handleSave(t)),this.dom.form.onsubmit=e=>{e.preventDefault(),this.handleSave(t)}}async handleSave(t){let e=t?"update":"insert",i=this._invokeRenderHook(`save_${e}`,{entity:this.currentEntity,form:this.dom.form,id:t,app:this});if(i)return;let a=this.dom.form.querySelector("#form-error");a&&(a.textContent="",a.classList.remove("show")),this.currentEntity.activeField||this.defaultActiveField;let n=new FormData(this.dom.form),s={};for(let l in this.currentEntity.columns){if(l===this.currentEntity.primaryKey&&"autogenerated"===this.currentEntity.columns[l].primaryKeyValue)continue;if("update"==e&&l===this.currentEntity.primaryKey&&"manual-insert"===this.currentEntity.columns[l].primaryKeyValue){s[l]=t;continue}let r=this.currentEntity.columns[l];if(n.has(l)){let o=n.get(l);"checkbox"===this.dom.form.querySelector(`[name="${l}"]`).type&&(o=this.dom.form.querySelector(`[name="${l}"]`).checked),r.type.includes("boolean")?o="true"===o||"1"===o||1===o||!0===o:r.type.includes("int")?""===(o=!0===o?1:!1===o?0:o)||isNaN(o)||(o=Number(o)):r.type.includes("float")&&(o=o?Number(o):null),s[l]=o}}for(let d in this.currentEntity.columns){if(d===this.currentEntity.primaryKey)continue;let h=this.currentEntity.columns[d];this.dom.form.querySelector(`[name="${d}"]`)&&"checkbox"===this.dom.form.querySelector(`[name="${d}"]`).type&&(this.dom.form.querySelector(`[name="${d}"]`).checked||(h.type.includes("boolean")?s[d]=!1:s[d]=0))}let c=this.ucFirst(this.currentEntity.name),u=t?`update${c}`:`create${c}`,m=this.getFieldsForQuery(this.currentEntity,1,1,!0),g=t=>{if("string"==typeof t){let e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return`"${e}"`}return null==t?"null":t},y=Object.entries(s).map(([t,e])=>`${t}: ${g(e)}`).join(", "),p=`input: {${y}}`;t&&(p=`id: "${t}", ${p}`);let f=`
    mutation {
    ${u}(${p}) {
    ${m}
    }
    }
    `;try{let b=await this.gqlQuery(f);if(b.errors)throw Error(b.errors[0].message);this.closeModal(),this.updateTableView()}catch(E){console.error(`Failed to save: ${E.message}`),this.dom.form.querySelector("#form-error").textContent=E.message,this.dom.form.querySelector("#form-error").style.display="block"}}async handleDelete(t){let e=await this.customConfirm({title:this.t("confirmation_title"),message:this.t("confirm_delete"),okText:this.t("delete"),cancelText:this.t("cancel")});if(!e)return;let i=this.ucFirst(this.currentEntity.name),a=`
    mutation {
    delete${i}(id: "${t}")
    }
    `;try{await this.gqlQuery(a),this.updateTableView(),this.closeConfirmModal()}catch(n){console.error(`Failed to delete: ${n.message}`)}}async handleToggleActive(t,e){let i=!e,a=i?"activate":"deactivate",n=await this.customConfirm({title:this.t("confirmation_title",""),message:this.t("confirm_toggle_active",this.t(a)),okText:this.t("yes"),cancelText:this.t("no")});if(!n)return;let s=this.ucFirst(this.currentEntity.name),l=this.currentEntity.activeField||this.defaultActiveField,r=`
    mutation Toggle${s}Active {
    toggle${s}Active(id: "${t}", ${l}: ${i}) {${l}}
    }
    `;try{await this.gqlQuery(r),this.updateTableView(),this.closeConfirmModal()}catch(o){console.error(`Failed to ${a}: ${o.message}`)}}customConfirm({title:t="Confirmation",message:e="Are you sure?",okText:i="OK",cancelText:a="Cancel"}){return new Promise(n=>{let s=document.getElementById("customConfirmModal"),l=s.querySelector(".modal-header .close-button"),r=s.querySelectorAll('[data-dismiss="modal"]');document.getElementById("customConfirmTitle").innerText=this.t(t),document.getElementById("customConfirmMessage").innerText=e;let o=document.getElementById("customConfirmOk"),d=document.getElementById("customConfirmCancel");o.innerText=this.t(i),d.innerText=this.t(a);let h=()=>{u(),n(!0)},c=()=>{u(),n(!1)},u=()=>{o.removeEventListener("click",h),d.removeEventListener("click",c),l.removeEventListener("click",c),r.forEach(t=>t.removeEventListener("click",c))};o.addEventListener("click",h,{once:!0}),d.addEventListener("click",c,{once:!0}),l.addEventListener("click",c,{once:!0}),r.forEach(t=>t.addEventListener("click",c)),this.openConfirmModal()})}openConfirmModal(){let t=document.getElementById("customConfirmModal");t.classList.add("show")}closeConfirmModal(){let t=document.getElementById("customConfirmModal");t.classList.remove("show")}customAlert({title:t="Info",message:e="",timeout:i=null}){return new Promise(a=>{this.dom.infoModalTitle.innerText=this.t(t),this.dom.infoModalMessage.innerText=e,this.dom.infoModalOk.innerText=this.t("ok");let n=this.dom.infoModal.querySelector(".close-button"),s=null,l=()=>{s&&clearTimeout(s),this.dom.infoModal.classList.remove("show"),this.dom.infoModalOk.removeEventListener("click",l),n.removeEventListener("click",l),a()};this.dom.infoModalOk.addEventListener("click",l,{once:!0}),n.addEventListener("click",l,{once:!0}),"number"==typeof i&&i>0&&(s=setTimeout(l,i)),this.openInfoModal()})}openInfoModal(){this.dom.infoModal.classList.add("show")}async handleLogin(t){t.preventDefault();let e=new FormData(this.dom.loginForm),i=document.getElementById("login-error");i.textContent="";let a=await fetch(this.loginUrl,{method:"POST",body:e,headers:{"X-Requested-With":"xmlhttprequest","X-Language-Id":this.languageId,"Accept-Language":this.languageId,Accept:"application/json"}});if(a.ok){let n=await a.json();n.success?(this.closeLoginModal(),window.location.reload()):i.textContent=this.t("login_error")}else 401===a.status?i.textContent=this.t("invalid_credentials"):(i.textContent=this.t("login_error"),console.error("Login failed:",error),console.error("Login failed with status:",a.status))}async handleLogout(t){t.preventDefault();try{let e=await fetch(this.logoutUrl,{headers:{"X-Requested-With":"xmlhttprequest"}});e.ok?(this.hidePageWrapper(),this.openLoginModal()):await this.customAlert({title:"logout_failed_title",message:this.t("logout_failed")})}catch(i){console.error("Logout failed:",i),await this.customAlert({title:"logout_failed_title",message:this.t("logout_failed")})}}async reloadConfiguration(t){t&&t.preventDefault(),this.dom.loadingBar.style.display="block";try{await this.loadConfig(),await this.loadI18n(),await this.loadLanguage(),this.buildMenu(),this.applyI18n(),await this.handleRouteChange(),await this.customAlert({title:"success",message:this.t("app_refreshed_successfully"),timeout:2e3})}catch(e){console.error("Failed to reload configuration:",e),await this.customAlert({title:"error",message:this.t("app_refresh_failed")})}finally{this.dom.loadingBar.style.display="none"}}camelCase(t){return t?t.replace(/_([a-z])/g,t=>t[1].toUpperCase()):""}upperCamelCase(t){let e=this.camelCase(t);return e.charAt(0).toUpperCase()+e.slice(1)}snakeCase(t){return t.replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase()}titleCase(t){return t.replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase())}snakeCaseToTitleCase(t){return this.titleCase(t.replace(/_/g," "))}camelCaseToTitleCase(t){return this.titleCase(this.snakeCase(t).replace(/_/g," "))}ucFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}getFieldsForQuery(t,e=1,i=1,a=!1){if(e<0)return t.primaryKey;let n=[];for(let s in t.columns){let l=t.columns[s];if(1==i&&e<1)(l.isPrimaryKey||s==t.displayField)&&n.push(s);else if(l.isForeignKey&&!a){n.push(s);let r=l.references,o=this.config.entities[this.camelCase(r)];if(o){let d=r,h=`${d} { ${this.getFieldsForQuery(o,e-1,i)} }`;n.push(h)}}else l.isForeignKey||n.push(s)}return n.join(" ")}async fetchAll(t,e={}){let{activeOnly:i=!0}=e,a=this.getFieldsForQuery(t,0,0),n=[];i&&t.hasActiveColumn&&t.activeField&&(t.columns[t.activeField],n.push({field:t.activeField,value:!0,operator:"EQUALS"}));let s=`query FetchAll($limit: Int, $filter: [FilterInput]) { ${t.pluralName}(limit: $limit, filter: $filter) { items { ${a} } } }`;try{let l=await this.gqlQuery(s,{limit:1e3,filter:n}),r=l.data;if(void 0!==r&&r[t.pluralName]&&r[t.pluralName].items)return r[t.pluralName].items;return[]}catch(o){return console.error(`Failed to pre-fetch ${t.pluralName}:`,o),[]}}openModal(){this.dom.modal.style.display="block"}closeModal(){this.dom.modal.style.display="none",this.dom.form.innerHTML=""}openLoginModal(){this.dom.loginModal.style.display="block"}closeLoginModal(){this.dom.loginModal.style.display="none",this.dom.loginForm.reset(),document.getElementById("login-error").textContent=""}}GraphQLClientApp.prototype._generateLabelFromKey=function(t){return t.replace(/_/g," ").replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substring(1).toLowerCase())};