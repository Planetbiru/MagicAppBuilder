let graphqlApp=null;function backToList(e){let a=sessionStorage.getItem("notification"===e?"lastNotificationListUrl":"lastMessageListUrl");a&&a!==location.href?location.href=a:(history.pushState(null,"",`#${e}`),graphqlApp.handleRouteChange())}async function handleProfileUpdate(e){let a=document.getElementById("profile-update-form"),t=new FormData(a);try{let r=await fetch("user-profile.php",{method:"POST",headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),p=await r.json();p.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message}),window.location.hash="#user-profile"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:p.message})}catch(n){console.error("Error updating profile:",n),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handlePasswordUpdate(e){let a=document.getElementById("password-update-form"),t=new FormData(a);try{let r=await fetch("update-password.php",{method:"POST",headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),p=await r.json();p.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message}),window.location.hash="#user-profile"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:p.message})}catch(n){console.error("Error updating password:",n),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handleSettingsUpdate(e){let a=document.getElementById("settings-update-form"),t=new FormData(a),r=parseInt(a.querySelector('[name="pageSize"]').value);try{let p=await fetch("settings.php",{method:"POST",headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await p.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),isNaN(r)||(graphqlApp.state.limit=r),window.location.hash="#settings"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(l){console.error("Error updating settings:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handleAdminSave(e,a=null){e.preventDefault();let t=document.getElementById("admin-form"),r=new FormData(t);r.append("action",a?"update":"create"),a&&r.append("adminId",a);try{let p=await fetch("admin.php",{method:"POST",body:r,headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId}}),n=await p.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),window.location.hash="#admin"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(l){console.error("Error saving admin:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}async function handleAdminChangePassword(e,a){e.preventDefault();let t=document.getElementById("change-password-form"),r=new FormData(t);r.append("action","change_password"),r.append("adminId",a);try{let p=await fetch("admin.php",{method:"POST",body:r,headers:{"X-Requested-With":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId}}),n=await p.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),window.location.hash=`#admin/detail/${a}`):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(l){console.error("Error changing password:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}async function handleAdminToggleActive(e,a){let t=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_toggle_active",graphqlApp.t(a?"deactivate":"activate")),okText:graphqlApp.t("yes"),cancelText:graphqlApp.t("no")});if(!t)return;graphqlApp.closeConfirmModal();let r=new FormData;r.append("action","toggle_active"),r.append("adminId",e);try{let p=await fetch("admin.php",{method:"POST",body:r,headers:{"X-Requested-With":"xmlhttprequest"}}),n=await p.json();n.success?graphqlApp.handleRouteChange():await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(l){console.error("Error toggling admin status:",l)}}async function handleAdminDelete(e){let a=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_delete")});if(!a)return;graphqlApp.closeConfirmModal();let t=new FormData;t.append("action","delete"),t.append("adminId",e);try{await fetch("admin.php",{method:"POST",body:t,headers:{"X-Requested-With":"xmlhttprequest"}}),graphqlApp.handleRouteChange()}catch(r){console.error("Error deleting admin:",r)}}function handleAdminSearch(e){e.preventDefault();let a=document.getElementById("admin-search-form"),t=a.querySelector('input[name="search"]'),r=t.value.trim(),p=r?`#admin?search=${encodeURIComponent(r)}`:"#admin";window.location.hash=p}async function handleMessageDelete(e){let a=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_delete")});if(!a)return;graphqlApp.closeConfirmModal();let t=new FormData;t.append("action","delete"),t.append("messageId",e);try{let r=await fetch("message.php",{method:"POST",body:t,headers:{"X-Requested-With":"xmlhttprequest"}}),p=await r.json();if(p.success){await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message});let n=window.location.hash;n.includes("messageId=")?backToList("message"):graphqlApp.handleRouteChange()}else await graphqlApp.customAlert({title:graphqlApp.t("error"),message:p.message})}catch(l){console.error("Error deleting message:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}function handleMessageSearch(e){e.preventDefault();let a=document.getElementById("message-search-form"),t=a.querySelector('input[name="search"]'),r=t.value.trim(),p=r?`#message?search=${encodeURIComponent(r)}`:"#message";window.location.hash=p}async function handleNotificationDelete(e){let a=await graphqlApp.customConfirm({title:graphqlApp.t("confirmation_title"),message:graphqlApp.t("confirm_delete")});if(!a)return;graphqlApp.closeConfirmModal();let t=new FormData;t.append("action","delete"),t.append("notificationId",e);try{let r=await fetch("notification.php",{method:"POST",body:t,headers:{"X-Requested-With":"xmlhttprequest"}}),p=await r.json();if(p.success){let n=window.location.hash;n.includes("notificationId=")?backToList("notification"):graphqlApp.handleRouteChange()}}catch(l){console.error("Error deleting notification:",l),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:graphqlApp.t("unexpected_error_occurred")})}}function handleNotificationSearch(e){e.preventDefault();let a=document.getElementById("notification-search-form"),t=a.querySelector('input[name="search"]'),r=t.value.trim(),p=r?`#notification?search=${encodeURIComponent(r)}`:"#notification";window.location.hash=p}async function markMessageAsUnread(e,a="list"){let t=new FormData;t.append("action","mark_as_unread"),t.append("messageId",e);try{let r=await fetch("message.php",{method:"POST",headers:{"X-Requested-with":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),p=await r.json();await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message}),r.ok&&("detail"===a?backToList("message"):graphqlApp.handleRouteChange())}catch(n){console.error("Error marking message as unread:",n)}}async function markNotificationAsUnread(e,a="list"){let t=new FormData;t.append("action","mark_as_unread"),t.append("notificationId",e);try{let r=await fetch("notification.php",{method:"POST",headers:{"X-Requested-with":"xmlhttprequest",Accept:"application/json","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),p=await r.json();await graphqlApp.customAlert({title:graphqlApp.t("success"),message:p.message}),r.ok&&("detail"===a?backToList("notification"):graphqlApp.handleRouteChange())}catch(n){console.error("Error marking notification as unread:",n)}}document.addEventListener("DOMContentLoaded",()=>{(graphqlApp=new GraphQLClientApp({configUrl:"frontend-config.php",apiUrl:"graphql.php",loginUrl:"login.php",logoutUrl:"logout.php",entityLanguageUrl:"entity-language.php",i18nUrl:"language.php",themeConfigUrl:"available-theme.php",languageConfigUrl:"available-language.php",defaultActiveField:"active",defaultDisplayField:"name",languageId:null,defaultLanguage:"en",customRenderers:{}})).pages.dashboard={url:"dashboard.php",title:"dashboard",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["user-profile"]={url:"user-profile.php",title:"profile",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["user-profile-update"]={url:"user-profile-update.php",title:"profile",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.settings={url:"settings.php",title:"settings",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["settings-update"]={url:"settings-update.php",title:"settings",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.message={url:"message.php",title:"message",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.notification={url:"notification.php",title:"notification",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.admin={url:"admin.php",title:"admin",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["update-password"]={url:"update-password.php",title:"update_password",method:"GET",headers:{"X-Requested-with":"xmlhttprequest","X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(e,a)},render(e,a,t){}}}),window.addEventListener("hashchange",()=>{let e=location.hash;e.startsWith("#message")&&!e.includes("messageId=")&&sessionStorage.setItem("lastMessageListUrl",location.href),e.startsWith("#notification")&&!e.includes("notificationId=")&&sessionStorage.setItem("lastNotificationListUrl",location.href)});