let graphqlApp=null;function backToList(e){let a=sessionStorage.getItem("notification"===e?"lastNotificationListUrl":"lastMessageListUrl");a&&a!==location.href?location.href=a:(history.pushState(null,"",`#${e}`),graphqlApp.handleRouteChange())}async function handleProfileUpdate(e){let a=document.getElementById("profile-update-form"),t=new FormData(a);try{let r=await fetch("user-profile.php",{method:"POST",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),window.location.hash="#user-profile"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(p){console.error("Error updating profile:",p),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handlePasswordUpdate(e){let a=document.getElementById("password-update-form"),t=new FormData(a);try{let r=await fetch("update-password.php",{method:"POST",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),window.location.hash="#user-profile"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(p){console.error("Error updating password:",p),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function handleSettingsUpdate(e){let a=document.getElementById("settings-update-form"),t=new FormData(a);try{let r=await fetch("settings.php",{method:"POST",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();n.success?(await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),window.location.hash="#settings"):await graphqlApp.customAlert({title:graphqlApp.t("error"),message:n.message})}catch(p){console.error("Error updating settings:",p),await graphqlApp.customAlert({title:graphqlApp.t("error"),message:"An unexpected error occurred."})}}async function markMessageAsUnread(e,a="list"){let t=new FormData;t.append("action","mark_as_unread"),t.append("messageId",e);try{let r=await fetch("message.php",{method:"POST",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),r.ok&&("detail"===a?backToList("message"):graphqlApp.handleRouteChange())}catch(p){console.error("Error marking message as unread:",p)}}async function markNotificationAsUnread(e,a="list"){let t=new FormData;t.append("action","mark_as_unread"),t.append("notificationId",e);try{let r=await fetch("notification.php",{method:"POST",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},body:t}),n=await r.json();await graphqlApp.customAlert({title:graphqlApp.t("success"),message:n.message}),r.ok&&("detail"===a?backToList("notification"):graphqlApp.handleRouteChange())}catch(p){console.error("Error marking notification as unread:",p)}}document.addEventListener("DOMContentLoaded",()=>{(graphqlApp=new GraphQLClientApp({configUrl:"frontend-config.php",apiUrl:"graphql.php",loginUrl:"login.php",logoutUrl:"logout.php",entityLanguageUrl:"entity-language.php",i18nUrl:"language.php",themeConfigUrl:"available-theme.php",languageConfigUrl:"available-language.php",defaultActiveField:"active",defaultDisplayField:"name",languageId:null,defaultLanguage:"en",customRenderers:{}})).pages["user-profile"]={url:"user-profile.php",title:"profile",method:"GET",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["user-profile-update"]={url:"user-profile-update.php",title:"profile",method:"GET",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.settings={url:"settings.php",title:"settings",method:"GET",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["settings-update"]={url:"settings-update.php",title:"settings",method:"GET",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.message={url:"message.php",title:"message",method:"GET",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages.notification={url:"notification.php",title:"notification",method:"GET",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(error)},render(e,a,t){}},graphqlApp.pages["update-password"]={url:"update-password.php",title:"update_password",method:"GET",headers:{"X-Language-Id":graphqlApp.languageId,"Accept-Language":graphqlApp.languageId},accept:"text/html",success(e,a,t){t.filterContainer.style.display="none",t.paginationContainer.style.display="none",t.filterContainer.innerHTML="",t.tableDataContainer.innerHTML="",a.innerHTML=e},error(e,a,t,r){console.error(e,a)},render(e,a,t){}}}),window.addEventListener("hashchange",()=>{let e=location.hash;e.startsWith("#message")&&!e.includes("messageId=")&&sessionStorage.setItem("lastMessageListUrl",location.href),e.startsWith("#notification")&&!e.includes("notificationId=")&&sessionStorage.setItem("lastNotificationListUrl",location.href)});