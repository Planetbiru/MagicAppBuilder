<div id="filter-container" class="filter-container" style="display: block;">
    <form id="message-search-form" class="search-form" onsubmit="handleMessageSearch(event)">
        <div class="filter-controls">
            <div class="form-group">
                <label for="search_message">{{T "search"}}</label>
                <input type="text" name="search" id="search_message" placeholder="{{T "search"}}" value="{{.SearchQuery}}">
            </div>
            <button type="submit" class="btn btn-primary">{{T "search"}}</button>
        </div>
    </form>
</div>

<div class="message-list-container">
    {{if not .Messages}}
        <p>{{T "no_messages_found"}}</p>
    {{end}}

    {{range .Messages}}
    <div class="message-item {{if .IsRead.Bool}}read{{else}}unread{{end}}">
        <span class="message-status-indicator"></span>
        <div class="message-header">
            <div class="message-link-wrapper">
                <a href="#message?messageId={{.MessageID}}" class="message-link">
                    <span class="message-sender">{{if .SenderName.Valid}}{{.SenderName.String}}{{else}}{{T "system"}}{{end}}</span>
                    <span class="message-subject">{{.Subject.String}}</span>
                </a>
                <span class="message-time">{{.TimeCreate.String}}</span>
                {{if and (eq .ReceiverID.String $.AdminID) .IsRead.Bool}}
                    <button class="btn btn-sm btn-secondary" onclick="markMessageAsUnread('{{.MessageID}}', 'list')">{{T "mark_as_unread"}}</button>
                    <button class="btn btn-sm btn-danger" onclick="handleMessageDelete('{{.MessageID}}')">{{T "delete"}}</button>
                {{end}}
            </div>
        </div>
        <div class="message-content">
            {{truncate .Content.String 150}}
        </div>
    </div>
    {{end}}
</div>

<div class="pagination-container">
    {{if gt .TotalPages 1}}
        <span>{{T "page_of" .CurrentPage .TotalPages .TotalRecords}}</span>
        
        {{if gt .CurrentPage 1}}
            <a href="#message?page={{sub .CurrentPage 1}}{{if .SearchQuery}}&search={{.SearchQuery}}{{end}}" class="btn btn-secondary">{{T "previous"}}</a>
        {{end}}

        {{ $currentPage := .CurrentPage }}
        {{ $totalPages := .TotalPages }}
        {{ $searchQuery := .SearchQuery }}
        {{ range $i := seq 1 .TotalPages }}
            {{ if or (eq $i $currentPage) (and (gt $i (sub $currentPage 2)) (lt $i (add $currentPage 2))) }}
                <a href="#message?page={{$i}}{{if $searchQuery}}&search={{$searchQuery}}{{end}}" class="btn {{if eq $i $currentPage}}btn-primary{{else}}btn-secondary{{end}}">{{$i}}</a>
            {{ else if or (eq $i 1) (eq $i $totalPages) (eq $i (add $currentPage 2)) (eq $i (sub $currentPage 2)) }}
                <span class="pagination-ellipsis">...</span>
            {{ end }}
        {{ end }}

        {{if lt .CurrentPage .TotalPages}}
            <a href="#message?page={{add .CurrentPage 1}}{{if .SearchQuery}}&search={{.SearchQuery}}{{end}}" class="btn btn-secondary">{{T "next"}}</a>
        {{end}}
    {{end}}
</div>