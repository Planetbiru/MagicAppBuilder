const data={applicationId:"",databaseType:"mysql",databaseName:"sipro",databaseSchema:"public",entities:[{name:"song",columns:[{name:"song_id",type:"VARCHAR",length:"40",nullable:!1,default:null,primaryKey:!0,autoIncrement:!0,values:"null"},{name:"name",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"null"},{name:"title",type:"VARCHAR",length:"250",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"null"},{name:"producer_id",type:"VARCHAR",length:"40",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"null"},{name:"artist_id",type:"VARCHAR",length:"20",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"null"},{name:"active",type:"TINYINT",length:"1",nullable:!1,default:"1",primaryKey:!1,autoIncrement:!1,values:"null"},{name:"enumval",type:"ENUM",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"A, B"},{name:"song_col8",type:"NUMERIC",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"9, 2"},{name:"song_col9",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col10",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col11",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col12",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col13",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col14",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col15",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col16",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"song_col17",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null}]},{name:"producer",columns:[{name:"producer_id",type:"VARCHAR",length:"40",nullable:!1,default:null,primaryKey:!0,autoIncrement:!1,values:null},{name:"name",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"active",type:"TINYINT",length:"1",nullable:!1,default:"1",primaryKey:!1,autoIncrement:!1,values:null}]},{name:"artist",columns:[{name:"artist_id",type:"VARCHAR",length:"40",nullable:!1,default:null,primaryKey:!0,autoIncrement:!1,values:"null"},{name:"name",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"null"},{name:"agency_id",type:"VARCHAR",length:"40",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"active",type:"TINYINT",length:"1",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:"null"}]},{name:"agency",columns:[{name:"agency_id",type:"VARCHAR",length:"40",nullable:!1,default:null,primaryKey:!0,autoIncrement:!1,values:null},{name:"name",type:"VARCHAR",length:"50",nullable:!1,default:null,primaryKey:!1,autoIncrement:!1,values:null},{name:"active",type:"TINYINT",length:"1",nullable:!1,default:"1",primaryKey:!1,autoIncrement:!1,values:null}]}]};class ERDRenderer{constructor(t){this.svg=t,this.tables={},this.spacing=260,this.tableWidth=240,this.maxTop=0,this.maxCol=0,this.lastMaxCol=0,this.mod=0,this.withLengthTypes=["VARCHAR","CHAR","VARBINARY","BINARY","TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","BIT"],this.withValueTypes=["ENUM","SET"],this.withRangeTypes=["NUMERIC","DECIMAL","DOUBLE","FLOAT"]}createERD(t,e){this.svg.innerHTML="",this.data=t,this.svg.setAttribute("width",e);let l=0,n=0;this.data.entities.forEach((t,e)=>{let a=this.createTable(t,e,l,n);this.tables[t.name]={table:a,xPos:l,yPos:n},this.maxCol<t.columns.length&&(this.maxCol=t.columns.length),this.lastMaxCol=this.maxCol,l+=this.spacing,this.mod++,l>this.svg.clientWidth-this.spacing&&(l=0,n+=20*this.maxCol+60,this.maxCol=0,this.mod=0),this.maxTop=n});let a=n-20;this.mod>0&&(a+=20*this.maxCol+60),this.svg.setAttribute("height",a),this.createRelationships()}createRelationships(){this.data.entities.forEach(t=>{t.columns.forEach((e,l)=>{if(e.name.endsWith("_id")&&!e.primaryKey){let n=e.name.replace("_id","");this.tables[n]&&this.createRelationship(t,e,l)}})})}createTable(t,e,l,n){let a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("transform",`translate(${l}, ${n})`);let i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width",this.tableWidth),i.setAttribute("height",20*t.columns.length+32),i.setAttribute("fill","transparent"),i.setAttribute("stroke","#8496B1"),i.setAttribute("stroke-width","0.5"),a.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x",1),s.setAttribute("y",1),s.setAttribute("width",this.tableWidth-2),s.setAttribute("height",24),s.setAttribute("fill","#E0EDFF"),a.appendChild(s);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",10),r.setAttribute("y",17),r.setAttribute("font-size","12"),r.setAttribute("text-anchor","left"),r.setAttribute("stroke-width","0.5"),r.setAttribute("fill","#1d3c86"),r.textContent=t.name,a.appendChild(r);let u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",this.tableWidth-42),u.setAttribute("y",17),u.setAttribute("font-size","11"),u.setAttribute("fill","#ffffff"),u.textContent="✏️",a.appendChild(u);let o=document.createElementNS("http://www.w3.org/2000/svg","text");return o.setAttribute("x",this.tableWidth-22),o.setAttribute("y",17),o.setAttribute("font-size","11"),o.setAttribute("fill","#ffffff"),o.textContent="❌",a.appendChild(o),u.style.cursor="pointer",o.style.cursor="pointer",u.addEventListener("click",()=>{this.editEntity(e)}),o.addEventListener("click",()=>{this.deleteEntity(e)}),t.columns.forEach((t,e)=>{let l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",10),l.setAttribute("y",40+20*e),l.setAttribute("font-size","12"),l.setAttribute("fill","#3a4255"),l.textContent=t.name,a.appendChild(l);let n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",this.tableWidth-10),n.setAttribute("y",40+20*e),n.setAttribute("font-size","10"),n.setAttribute("fill","#3a4255");let i;i=this.withLengthTypes.includes(t.type)&&t.length>0?`${t.type}(${t.length})`:this.withRangeTypes.includes(t.type)&&null!=t.values?`${t.type}(${t.values})`:`${t.type}`,n.textContent=i,n.setAttribute("text-anchor","end"),a.appendChild(n);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",0),s.setAttribute("y1",26+20*e),s.setAttribute("x2",this.tableWidth),s.setAttribute("y2",26+20*e),s.setAttribute("stroke","#8496B1"),s.setAttribute("stroke-width","0.3"),a.appendChild(s)}),this.svg.appendChild(a),a}createRelationship(t,e,l){let n=e.name.replace("_id",""),a=this.getEntityByName(n),i=this.getColumnIndex(a,e.name),s=this.tables[t.name].table,r=this.tables[n].table,u=20*l+this.tables[t.name].yPos+44,o=20*i+this.tables[n].yPos+44,h=parseInt(s.getAttribute("transform").split(",")[0].replace("translate(","")),m=parseInt(r.getAttribute("transform").split(",")[0].replace("translate(","")),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",h+this.tableWidth),d.setAttribute("y1",u),d.setAttribute("x2",m),d.setAttribute("y2",o),d.setAttribute("stroke","#2E4C95"),d.setAttribute("stroke-width","0.7"),this.svg.appendChild(d)}getEntityByName(t){return this.data.entities.find(e=>e.name===t)}getColumnIndex(t,e){return t.columns.findIndex(t=>t.name===e)}exportToSVG(t,e="exported-image.svg"){let l=new XMLSerializer().serializeToString(t),n=`
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${width}" height="${height}">
            <defs>
                <style type="text/css">
                    <![CDATA[
                        text {
                            font-family: 'Arial', sans-serif;
                        }
                    ]]>
                </style>
            </defs>
            ${l}
        </svg>`,a=new Blob([n],{type:"image/svg+xml"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i)}exportToPNG(t,e="exported-image.png"){let l=t.clientWidth,n=t.clientHeight,a=document.createElement("canvas");a.width=l,a.height=n;let i=a.getContext("2d"),s=new XMLSerializer().serializeToString(t),r=`
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${l}" height="${n}">
            <defs>
                <style type="text/css">
                    <![CDATA[
                        text {
                            font-family: 'Arial', sans-serif;
                        }
                    ]]>
                </style>
            </defs>
            ${s}
        </svg>`,u="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(r),o=new Image;o.onload=function(){i.drawImage(o,0,0);let t=a.toDataURL("image/png"),l=document.createElement("a");l.href=t,l.download=e,l.click()},o.onerror=function(t){console.error("Error loading the SVG image:",t)},o.src=u}editEntity(t){console.log("Editing entity:",t)}deleteEntity(t){console.log("Deleting entity:",t)}}let erdGenerator=new ERDRenderer(document.getElementById("erd-svg"));erdGenerator.createERD(data,800),window.addEventListener("resize",function(){let t=document.getElementById("erd-svg").parentNode.offsetWidth;erdGenerator.createERD(data,t)});