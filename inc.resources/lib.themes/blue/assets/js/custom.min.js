function initDateTimePicker(){$('input[type="date"], input[type="time"], input[type="datetime"], input[type="datetime-local"]').each(function(t,e){let a=$(this),i,r={date:"date",time:"time",datetime:"date-time","datetime-local":"date-time"}[a.attr("type")];if(void 0===a.attr("data-multiple-input")){a.attr("type","text"),a.addClass(`${r}-picker`);let l=`<div class="input-datetime-wrapper ${r}">
        ${a[0].outerHTML}
        </div>`;a.replaceWith(l)}}),$(".date-picker").length&&$(".date-picker").each(function(){let t=$(this).data("mindate")||!1,e=$(this).data("maxdate")||!1;$(this).datetimepicker({minDate:t,maxDate:e,format:"YYYY-MM-DD",debug:!1}).on("dp.change",function(t){$(this).datetimepicker("hide")})}),$(".time-picker").length&&$(".time-picker").datetimepicker({format:"HH:mm:ss",debug:!1}).on("dp.change",function(t){$(this).datetimepicker("hide")}),$(".date-time-picker").length&&$(".date-time-picker").each(function(){let t=$(this).data("mindate")||!1,e=$(this).data("maxdate")||!1;$(this).datetimepicker({minDate:t,maxDate:e,format:"YYYY-MM-DD HH:mm:ss",useCurrent:"day",debug:!1}).on("dp.change",function(t){$(this).datetimepicker("hide")})})}function initSortTable(){let t=document.querySelectorAll("table.table-sort-by-column");t.forEach(function(t){let e=document.location.toString(),a=(e=e.split("#")[0]).split("?");e=a[0];let i=(a[1]||"").split("&"),r={};i.forEach(function(t){let e=t.split("=");""!==e[0]&&(r[e[0]]=e[1])});let l=r.ordertype||"",n=r.orderby||"",d=t.querySelectorAll("td.order-controll");d.forEach(function(t){let a=t.getAttribute("data-col-name");n===a?"asc"===l?(r.ordertype="desc",t.setAttribute("data-order-method","asc")):(r.ordertype="asc",t.setAttribute("data-order-method","desc")):r.ordertype="asc",r.orderby=a;let i=[];for(let d in r)r.hasOwnProperty(d)&&i.push(d+"="+r[d]);let o=e+"?"+i.join("&"),s=t.querySelector("a");s&&s.setAttribute("href",o)})})}function initSortData(){document.querySelectorAll("tbody.data-table-manual-sort").forEach(function(t){Sortable.create(t,{animation:150,scroll:!0,handle:".data-sort-handler",onEnd:function(){updateNumber($(t))}})})}function initCheckAll(){let t=document.querySelectorAll(".check-master");t.forEach(function(t){t&&t.addEventListener("change",function(){let e=t.checked,a=t.dataset.selector;document.querySelectorAll(".check-slave"+a).forEach(function(t){t.checked=e})})})}function initMultipleInput(){$("input[data-multi-input]").each(function(t,e){let a=$(this).is('input[type="date"], input[type="time"], input[type="datetime"], input[type="datetime-local"]'),i={maxHeight:120,trimInput:a,clearOnHide:!0,debug:!1};a&&(i.minWidth=260),new PicoTagEditor(e,i,function(t,e,i){if(!a)return;let r=$(t),l={date:"date",time:"time",datetime:"date-time","datetime-local":"date-time"}[r.attr("type")]||"";r.attr("type","text").addClass(`${l}-picker-multiple pico-tag-edit`),r.wrap(`<div class="input-datetime-wrapper ${l}"></div>`),r=$(e).find(".pico-tag-edit"),i.inputElement=r[0];let n=getDatePickerOptions(r,!1);n&&r.datetimepicker(n).on("dp.change",()=>r.datetimepicker("hide")).on("dp.enter",()=>{let t=r.val();""===t.trim()||(i.addTag(t),r.val(""),i.settings.debug||i.waitingForHide(1500))})})})}function getDatePickerOptions(t,e){let a={};return t.hasClass("date-picker-multiple")?a={minDate:t.data("mindate")||!1,maxDate:t.data("maxdate")||!1,format:"YYYY-MM-DD",debug:e}:t.hasClass("time-picker-multiple")?a={format:"HH:mm:ss",debug:e}:t.hasClass("date-time-picker-multiple")&&(a={minDate:t.data("mindate")||!1,maxDate:t.data("maxdate")||!1,format:"YYYY-MM-DD HH:mm:ss",useCurrent:"day",debug:e}),Object.keys(a).length?a:null}function initAjaxSupport(){0===document.querySelectorAll('[data-ajax-support="true"]').length&&document.addEventListener("click",function(t){let e=t.target;if(e&&"submit"===e.type&&"user_action"===e.name&&"delete"===e.value){let a=e.getAttribute("data-onclik-message");confirm(a)||(t.preventDefault(),t.stopPropagation())}})}function initMultipleSelect(){document.querySelectorAll("select[multiple]").forEach(t=>new MultiSelect(t))}function initOrderUrl(t){let e=new URLSearchParams(t),a=e.get("orderby"),i=e.get("ordertype");if(void 0!==a){let r=$("<input />");r.attr("type","hidden"),r.attr("name","orderby"),r.attr("value",a),$('form.filter-form [name="orderby"]').length&&$('form.filter-form [name="orderby"]').remove(),$("form.filter-form").append(r)}if(void 0!==i){let l=$("<input />");l.attr("type","hidden"),l.attr("name","ordertype"),l.attr("value",i),$('form.filter-form [name="ordertype"]').length&&$('form.filter-form [name="ordertype"]').remove(),$("form.filter-form").append(l)}}function updateNumber(t){let e=t.closest("form");e.find("span.new-sort-order").length&&e.find("span.new-sort-order").remove();let a=$("<span />");a.addClass("new-sort-order"),e.append(a);let i=parseInt(t.attr("data-offset")),r=0;t.find("tr").each(function(t){let e=$(this),l=i+ ++r;e.find(".data-number").text(l);let n=e.attr("data-primary-key"),d=$("<input />");d.attr({type:"hidden",name:"new_order[]",value:JSON.stringify({primary_key:n,sort_order:l})}),a.append(d)}),t.closest("form").find('button[name="user_action"][value="sort_order"]').removeAttr("disabled")}function saveOrder(){}function splitWithTail(t,e,a){let i=t.split(e),r=i.slice(a).join(e),l=i.slice(0,a);return l.push(r),l}function initNotifications(t,e,a,i){let r=document.querySelector(t);if(void 0!==e.data){e.data.forEach(t=>{let e=document.createElement("a");e.className="dropdown-item",e.href=t.link,e.innerHTML=`${t.title} <br><small class="text-muted">${t.time}</small>`,e.dataset.id=t.id,r.appendChild(e)});let l="";if(e.totalData>99?l="99+":e.totalData>0&&e.totalData<=99&&(l=e.totalData),r.closest("li.nav-item").setAttribute("data-badge",l),e.data.length>0){let n=document.createElement("div");n.classList.add("menu-separator"),r.appendChild(n)}}else r.closest("li.nav-item").setAttribute("data-badge","");let d=document.createElement("a");d.className="dropdown-item",d.href=a,d.innerHTML=i,r.appendChild(d)}function initMessages(t,e,a,i){let r=document.querySelector(t);if(void 0!==e.data){e.data.forEach(t=>{let e=document.createElement("a");e.className="dropdown-item",e.href=t.link,e.innerHTML=`${t.title} <br><small class="text-muted">${t.time}</small>`,e.dataset.id=t.id,r.appendChild(e)});let l="";if(e.totalData>99?l="99+":e.totalData>0&&e.totalData<=99&&(l=e.totalData),r.closest("li.nav-item").setAttribute("data-badge",l),e.data.length>0){let n=document.createElement("div");n.classList.add("menu-separator"),r.appendChild(n)}}else r.closest("li.nav-item").setAttribute("data-badge","");let d=document.createElement("a");d.className="dropdown-item",d.href=a,d.innerHTML=i,r.appendChild(d)}function initPage(){document.querySelectorAll(".toggle-sidebar").forEach(t=>{t.addEventListener("click",()=>{document.body.clientWidth>=992?document.body.classList.toggle("sidebar-hidden"):document.body.classList.toggle("sidebar-show");let t=document.body.classList.contains("sidebar-hidden");window.localStorage.setItem("MagicAppBuilder.sidebarHidden",t?"true":"false")})}),document.querySelector(".toggle-mode").addEventListener("click",()=>{document.body.classList.toggle("dark-mode"),document.body.classList.toggle("light-mode");let t="";document.body.classList.contains("dark-mode")?(t="dark-mode",document.querySelector('meta[name="theme-color"]').setAttribute("content",themeDark)):(t="light-mode",document.querySelector('meta[name="theme-color"]').setAttribute("content",themeLight)),window.localStorage.setItem("MagicAppBuilder.colorMode",t)})}function restoreFormData(t,e,a){let i=document.querySelector(a);if(!i){console.warn("Form not found:",a);return}for(let[r,l]of Object.entries(t)){let n=i.querySelectorAll(`[name="${r}"]`);n.forEach(t=>{let a=t.type;"checkbox"===a?t.checked=Array.isArray(l)?l.includes(t.value):Boolean(l):"radio"===a?t.checked=t.value===l:"SELECT"===t.tagName?Array.from(t.options).forEach(t=>{t.selected=Array.isArray(l)?l.includes(t.value):t.value===l}):t.value=l,r===e?(t.classList.add("is-invalid"),t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus()):t.classList.remove("is-invalid")})}}document.addEventListener("DOMContentLoaded",()=>{initPage(),initCheckAll(),initAjaxSupport(),initMultipleInput(),initDateTimePicker(),initMultipleSelect(),initSortTable(),initSortData(),initOrderUrl(window.location.search)});