function initDateTimePicker(){$('input[type="date"], input[type="time"], input[type="datetime"], input[type="datetime-local"]').each(function(e,t){let a=$(this),i,r={date:"date",time:"time",datetime:"date-time","datetime-local":"date-time"}[a.attr("type")];if(void 0===a.attr("data-multiple-input")){a.attr("type","text"),a.addClass(`${r}-picker`);let n=`<div class="input-datetime-wrapper ${r}">
        ${a[0].outerHTML}
        </div>`;a.replaceWith(n)}}),$(".date-picker").length&&$(".date-picker").each(function(){let e=$(this).data("mindate")||!1,t=$(this).data("maxdate")||!1;$(this).datetimepicker({minDate:e,maxDate:t,format:"YYYY-MM-DD",debug:!1}).on("dp.change",function(e){$(this).datetimepicker("hide")})}),$(".time-picker").length&&$(".time-picker").datetimepicker({format:"HH:mm:ss",debug:!1}).on("dp.change",function(e){$(this).datetimepicker("hide")}),$(".date-time-picker").length&&$(".date-time-picker").each(function(){let e=$(this).data("mindate")||!1,t=$(this).data("maxdate")||!1;$(this).datetimepicker({minDate:e,maxDate:t,format:"YYYY-MM-DD HH:mm:ss",useCurrent:"day",debug:!1}).on("dp.change",function(e){$(this).datetimepicker("hide")})})}function initSortTable(){let e=document.querySelectorAll("table.table-sort-by-column");e.forEach(function(e){let t=document.location.toString(),a=(t=t.split("#")[0]).split("?");t=a[0];let i=(a[1]||"").split("&"),r={};i.forEach(function(e){let t=e.split("=");""!==t[0]&&(r[t[0]]=t[1])});let n=r.ordertype||"",l=r.orderby||"",o=e.querySelectorAll("td.order-controll");o.forEach(function(e){let a=e.getAttribute("data-col-name");l===a?"asc"===n?(r.ordertype="desc",e.setAttribute("data-order-method","asc")):(r.ordertype="asc",e.setAttribute("data-order-method","desc")):r.ordertype="asc",r.orderby=a;let i=[];for(let o in r)r.hasOwnProperty(o)&&i.push(o+"="+r[o]);let d=t+"?"+i.join("&"),c=e.querySelector("a");c&&c.setAttribute("href",d)})})}function initSortData(){document.querySelectorAll("tbody.data-table-manual-sort").forEach(function(e){Sortable.create(e,{animation:150,scroll:!0,handle:".data-sort-handler",onEnd:function(){updateNumber($(e))}})})}function initCheckAll(){let e=document.querySelectorAll(".check-master");e.forEach(function(e){e&&e.addEventListener("change",function(){let t=e.checked,a=e.dataset.selector;document.querySelectorAll(".check-slave"+a).forEach(function(e){e.checked=t})})})}function initMultipleInput(){$("input[data-multi-input]").each(function(e,t){let a=$(this).is('input[type="date"], input[type="time"], input[type="datetime"], input[type="datetime-local"]'),i={maxHeight:120,trimInput:a,clearOnHide:!0,debug:!1};a&&(i.minWidth=260),new PicoTagEditor(t,i,function(e,t,i){if(!a)return;let r=$(e),n={date:"date",time:"time",datetime:"date-time","datetime-local":"date-time"}[r.attr("type")]||"";r.attr("type","text").addClass(`${n}-picker-multiple pico-tag-edit`),r.wrap(`<div class="input-datetime-wrapper ${n}"></div>`),r=$(t).find(".pico-tag-edit"),i.inputElement=r[0];let l=getDatePickerOptions(r,!1);l&&r.datetimepicker(l).on("dp.change",()=>r.datetimepicker("hide")).on("dp.enter",()=>{let e=r.val();""===e.trim()||(i.addTag(e),r.val(""),i.settings.debug||i.waitingForHide(1500))})})})}function getDatePickerOptions(e,t){let a={};return e.hasClass("date-picker-multiple")?a={minDate:e.data("mindate")||!1,maxDate:e.data("maxdate")||!1,format:"YYYY-MM-DD",debug:t}:e.hasClass("time-picker-multiple")?a={format:"HH:mm:ss",debug:t}:e.hasClass("date-time-picker-multiple")&&(a={minDate:e.data("mindate")||!1,maxDate:e.data("maxdate")||!1,format:"YYYY-MM-DD HH:mm:ss",useCurrent:"day",debug:t}),Object.keys(a).length?a:null}function initAjaxSupport(){0===document.querySelectorAll('[data-ajax-support="true"]').length&&document.addEventListener("click",function(e){let t=e.target;if(t&&"submit"===t.type&&"user_action"===t.name&&"delete"===t.value){let a=t.getAttribute("data-onclik-message");confirm(a)||(e.preventDefault(),e.stopPropagation())}})}function initMultipleSelect(){document.querySelectorAll("select[multiple]").forEach(e=>new MultiSelect(e))}function initOrderUrl(e){let t=new URLSearchParams(e),a=t.get("orderby"),i=t.get("ordertype");if(void 0!==a){let r=$("<input />");r.attr("type","hidden"),r.attr("name","orderby"),r.attr("value",a),$('form.filter-form [name="orderby"]').length&&$('form.filter-form [name="orderby"]').remove(),$("form.filter-form").append(r)}if(void 0!==i){let n=$("<input />");n.attr("type","hidden"),n.attr("name","ordertype"),n.attr("value",i),$('form.filter-form [name="ordertype"]').length&&$('form.filter-form [name="ordertype"]').remove(),$("form.filter-form").append(n)}}function updateNumber(e){let t=e.closest("form");t.find("span.new-sort-order").length&&t.find("span.new-sort-order").remove();let a=$("<span />");a.addClass("new-sort-order"),t.append(a);let i=parseInt(e.attr("data-offset")),r=0;e.find("tr").each(function(e){let t=$(this),n=i+ ++r;t.find(".data-number").text(n);let l=t.attr("data-primary-key"),o=$("<input />");o.attr({type:"hidden",name:"new_order[]",value:JSON.stringify({primary_key:l,sort_order:n})}),a.append(o)}),e.closest("form").find('button[name="user_action"][value="sort_order"]').removeAttr("disabled")}function saveOrder(){}function splitWithTail(e,t,a){let i=e.split(t),r=i.slice(a).join(t),n=i.slice(0,a);return n.push(r),n}function initNotifications(e,t,a,i){let r=document.querySelector(e);if(void 0!==t.data){t.data.forEach(e=>{let t=document.createElement("a");t.className="dropdown-item",t.href=e.link,t.innerHTML=`${e.title} <br><small class="text-muted">${e.time}</small>`,t.dataset.id=e.id,r.appendChild(t)});let n="";if(t.totalData>99?n="99+":t.totalData>0&&t.totalData<=99&&(n=t.totalData),r.closest("li.nav-item").setAttribute("data-badge",n),t.data.length>0){let l=document.createElement("div");l.classList.add("menu-separator"),r.appendChild(l)}}else r.closest("li.nav-item").setAttribute("data-badge","");let o=document.createElement("a");o.className="dropdown-item",o.href=a,o.innerHTML=i,r.appendChild(o)}function initMessages(e,t,a,i){let r=document.querySelector(e);if(void 0!==t.data){t.data.forEach(e=>{let t=document.createElement("a");t.className="dropdown-item",t.href=e.link,t.innerHTML=`${e.title} <br><small class="text-muted">${e.time}</small>`,t.dataset.id=e.id,r.appendChild(t)});let n="";if(t.totalData>99?n="99+":t.totalData>0&&t.totalData<=99&&(n=t.totalData),r.closest("li.nav-item").setAttribute("data-badge",n),t.data.length>0){let l=document.createElement("div");l.classList.add("menu-separator"),r.appendChild(l)}}else r.closest("li.nav-item").setAttribute("data-badge","");let o=document.createElement("a");o.className="dropdown-item",o.href=a,o.innerHTML=i,r.appendChild(o)}function initPage(){document.querySelectorAll(".toggle-sidebar").forEach(e=>{e.addEventListener("click",()=>{document.body.clientWidth>=992?document.body.classList.toggle("sidebar-hidden"):document.body.classList.toggle("sidebar-show");let e=document.body.classList.contains("sidebar-hidden");window.localStorage.setItem("MagicAppBuilder.sidebarHidden",e?"true":"false")})}),document.querySelector(".toggle-mode").addEventListener("click",()=>{document.body.classList.toggle("dark-mode"),document.body.classList.toggle("light-mode");let e="";document.body.classList.contains("dark-mode")?(e="dark-mode",document.querySelector('meta[name="theme-color"]').setAttribute("content",themeDark)):(e="light-mode",document.querySelector('meta[name="theme-color"]').setAttribute("content",themeLight)),window.localStorage.setItem("MagicAppBuilder.colorMode",e)})}function camelToSnake(e){return e.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1_$2").toLowerCase()}function restoreFormData(e,t,a){document.addEventListener("DOMContentLoaded",()=>{doRestoreFormData(e,t,a)})}function doRestoreFormData(e,t,a){let i=document.querySelector(a);if(!i){console.warn("Form not found:",a);return}for(let[r,n]of(t=camelToSnake(t),Object.entries(e))){let l=camelToSnake(r),o=i.querySelectorAll(`[name="${l}"]`);o.forEach(e=>{let a=e.type;"checkbox"===a?e.checked=Array.isArray(n)?n.includes(e.value):Boolean(n):"radio"===a?e.checked=e.value===n:"SELECT"===e.tagName?Array.from(e.options).forEach(e=>{e.selected=Array.isArray(n)?n.includes(e.value):e.value===n}):e.value=n,l===t?(e.classList.add("is-invalid"),e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus()):e.classList.remove("is-invalid")})}}document.addEventListener("DOMContentLoaded",()=>{initPage(),initCheckAll(),initAjaxSupport(),initMultipleInput(),initDateTimePicker(),initMultipleSelect(),initSortTable(),initSortData(),initOrderUrl(window.location.search)});