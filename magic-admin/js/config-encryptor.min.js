function generateRandomHex32(){let e="";for(let t=0;t<32;t++)e+=Math.floor(16*Math.random()).toString(16);return e}function encryptValue(e,t,r=!1){let l=e.toString();if(r)return l;let n=CryptoJS.lib.WordArray.random(16),o=CryptoJS.enc.Utf8.parse(t),a=CryptoJS.AES.encrypt(l,o,{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),p=a.ciphertext,i=p.clone().concat(n),c=CryptoJS.HmacSHA256(i,o),y=n.clone().concat(c).concat(p);return CryptoJS.enc.Base64.stringify(y)}function decryptValue(e,t){if(!e)return null;let r=CryptoJS.enc.Utf8.parse(t),l=CryptoJS.enc.Base64.parse(e);if(l.sigBytes<48)return null;let n=CryptoJS.lib.WordArray.create(l.words.slice(0,4),16),o=CryptoJS.lib.WordArray.create(l.words.slice(4,12),32),a=CryptoJS.lib.WordArray.create(l.words.slice(12),l.sigBytes-16-32),p=a.clone().concat(n),i=CryptoJS.HmacSHA256(p,r);if(CryptoJS.enc.Hex.stringify(i)!==CryptoJS.enc.Hex.stringify(o))return console.warn("HMAC mismatch"),null;let c=CryptoJS.AES.decrypt({ciphertext:a},r,{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return c.toString(CryptoJS.enc.Utf8)}function encryptObject(e,t){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return encryptValue(e,t);if(Array.isArray(e))return e.map(e=>encryptObject(e,t));if("object"==typeof e&&null!==e){let r={};for(let l in e)Object.prototype.hasOwnProperty.call(e,l)&&(r[l]=encryptObject(e[l],t));return r}return e}function encryptObjectEnv(e,t,r,l,n=!1){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e){let o=`${r.replace(/[^A-Za-z0-9_]/g,"_").toUpperCase()}`;return l[o]=encryptValue(e,t,n),`\${${o}}`}if(Array.isArray(e))return e.map((e,o)=>encryptObjectEnv(e,t,`${r}_${o}`,l,n));if("object"==typeof e&&null!==e){let a={};for(let p in e)Object.prototype.hasOwnProperty.call(e,p)&&(a[p]=encryptObjectEnv(e[p],t,`${r}_${p}`,l,n));return a}return e}function decryptObject(e,t){if("string"==typeof e){let r=decryptValue(e,t);return null!==r?r:e}if(Array.isArray(e))return e.map(e=>decryptObject(e,t));if("object"==typeof e&&null!==e){let l={};for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(l[n]=decryptObject(e[n],t));return l}return e}function getPropertiesToProcess(){return document.getElementById("propsInput").value.split("\n").map(e=>e.trim()).filter(e=>""!==e)}function encryptYaml(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=getPropertiesToProcess();try{let l=jsyaml.load(e);for(let n of r){let o=n.split("."),a=l;for(let p=0;p<o.length-1&&(a=a[o[p]]);p++);let i=o[o.length-1];a&&Object.prototype.hasOwnProperty.call(a,i)&&void 0!==a[i]&&(a[i]=encryptObject(a[i],t))}let c=jsyaml.dump(l,{lineWidth:160});document.getElementById("yamlOutput").value=c}catch(y){document.getElementById("yamlOutput").value="Error: "+y.message}}function generateEnvScript(e,t){return"windows"===t?Object.entries(e).map(([e,t])=>`setx ${e} "${t}"`).join("\n"):Object.entries(e).map(([e,t])=>`export ${e}="${t}"`).join("\n")}function decryptYaml(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=getPropertiesToProcess();try{let l=jsyaml.load(e);for(let n of r){let o=n.split("."),a=l;for(let p=0;p<o.length-1&&(a=a[o[p]]);p++);let i=o[o.length-1];a&&Object.prototype.hasOwnProperty.call(a,i)&&void 0!==a[i]&&(a[i]=decryptObject(a[i],t))}let c=jsyaml.dump(l,{lineWidth:160});document.getElementById("yamlOutput").value=c}catch(y){document.getElementById("yamlOutput").value="Error: "+y.message}}function placeholderAll(e,t,r){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e){let l=`${toEnvName(t)}`;return r[l]=e,`\${${l}}`}if(Array.isArray(e))return e.map((e,l)=>placeholderAll(e,`${t}_${l}`,r));if("object"==typeof e&&null!==e){let n={};for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=placeholderAll(e[o],`${t}_${o}`,r));return n}return e}function generatePlaceholder(){let e=document.getElementById("yamlInput").value,t=document.getElementById("osSelect").value,r={};try{let l=jsyaml.load(e),n=placeholderAll(l,"root",r),o=jsyaml.dump(n,{lineWidth:160});document.getElementById("yamlOutput").value=o,document.getElementById("envMapping").value=Object.entries(r).map(([e,t])=>`${e}=${t}`).join("\n"),document.getElementById("envScript").value=generateEnvScript(r,t)}catch(a){document.getElementById("yamlOutput").value="Error: "+a.message}}function encryptYamlEnv(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=document.getElementById("osSelect").value,l={},n=getPropertiesToProcess();try{let o=jsyaml.load(e);for(let a of n){let p=a.split("."),i=o;for(let c=0;c<p.length-1&&(i=i[p[c]]);c++);let y=p[p.length-1];if(i&&Object.prototype.hasOwnProperty.call(i,y)&&void 0!==i[y]){let u=toEnvName(a),m=String(i[y]),d=CryptoJS.AES.encrypt(m,t).toString();l[u]=d,i[y]=`\${${u}}`}}let s=jsyaml.dump(o,{lineWidth:160});document.getElementById("yamlOutput").value=s,document.getElementById("envMapping").value=Object.entries(l).map(([e,t])=>`${e}=${t}`).join("\n"),document.getElementById("envScript").value=generateEnvScript(l,r)}catch(f){document.getElementById("yamlOutput").value="Error: "+f.message}}function toEnvName(e){return e.replace(/^root_?/i,"").replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/[^A-Za-z0-9_]/g,"_").toUpperCase()}function toXml(e,t="root",r="item"){let l=document.implementation.createDocument("","",null),n=l.createElement(t);l.appendChild(n),arrayToXml(e,n,t,r,l);let o=new XMLSerializer,a=o.serializeToString(l);return formatXml(a)}function arrayToXml(e,t,r,l,n){if(Array.isArray(e))e.forEach(e=>{let o=n.createElement(l);t.appendChild(o),arrayToXml(e,o,r,l,n)});else if("object"==typeof e&&null!==e){for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];if(Array.isArray(a))a.forEach(e=>{let r=n.createElement(o);t.appendChild(r),arrayToXml(e,r,o,l,n)});else if("object"==typeof a&&null!==a){let p=n.createElement(o);t.appendChild(p),arrayToXml(a,p,o,l,n)}else{let i=n.createElement(o);i.textContent=a,t.appendChild(i)}}}else t.textContent=e}function formatXml(e){let t="",r=0;return(e=e.replace(/>\s*</g,">\n<")).split("\n").forEach(e=>{(e=e.trim())&&(/^<\//.test(e)?(r-=1,t+="  ".repeat(r)+e+"\n"):/^<[^>]+\/>/.test(e)?t+="  ".repeat(r)+e+"\n":/^<[^>]+>.*<\/[^>]+>$/.test(e)?t+="  ".repeat(r)+e+"\n":/^<[^>]+>/.test(e)?(t+="  ".repeat(r)+e+"\n",r+=1):t+="  ".repeat(r)+e+"\n")}),t.trim()}function arrayToXml(e,t,r,l,n){Array.isArray(e)?e.forEach(e=>{let o=n.createElement(l);t.appendChild(o),arrayToXml(e,o,r,l,n)}):"object"==typeof e&&null!==e?Object.entries(e).forEach(([e,r])=>{if(Array.isArray(r)){let o=n.createElement(e);t.appendChild(o),r.forEach(t=>{let r=n.createElement(l);o.appendChild(r),arrayToXml(t,r,e,l,n)})}else if("object"==typeof r&&null!==r){let a=n.createElement(e);t.appendChild(a),arrayToXml(r,a,e,l,n)}else{let p=n.createElement(e);p.textContent=r,t.appendChild(p)}}):t.textContent=e}function yamlToXml(e){let t=jsyaml.load(e);return toXml(t,"root","item")}function copyEnv(e){let t=e.closest(".form-group").querySelector("textarea"),r=e.textContent,l=t.value;e.disabled=!0,navigator.clipboard.writeText(l).then(()=>{e.textContent=e.dataset.copiedCaption||"Copied!",setTimeout(()=>{e.textContent=r,e.disabled=!1},2e3)}).catch(e=>{console.error("Failed to copy text: ",e)})}function copyYaml(e){let t=e.closest(".form-group").querySelector("textarea"),r=e.textContent,l=t.value;e.disabled=!0,navigator.clipboard.writeText(l).then(()=>{e.textContent=e.dataset.copiedCaption||"Copied!",setTimeout(()=>{e.textContent=r,e.disabled=!1},2e3)}).catch(e=>{console.error("Failed to copy text: ",e)})}function copyXml(e){let t=e.closest(".form-group").querySelector("textarea"),r=e.textContent,l=yamlToXml(t.value);e.disabled=!0,navigator.clipboard.writeText(l).then(()=>{e.textContent=e.dataset.copiedCaption||"Copied!",setTimeout(()=>{e.textContent=r,e.disabled=!1},2e3)}).catch(e=>{console.error("Failed to copy text: ",e)})}function encryptYamlEnvRecursive(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=document.getElementById("osSelect").value,l={},n=getPropertiesToProcess();try{let o=jsyaml.load(e);function a(e,r){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e){let n=toEnvName(r),o=CryptoJS.AES.encrypt(String(e),t).toString();return l[n]=o,`\${${n}}`}if(Array.isArray(e))return e.map((e,t)=>a(e,`${r}_${t}`));if("object"==typeof e&&null!==e){let p={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(p[i]=a(e[i],`${r}_${i}`));return p}return e}for(let p of n){let i=p.split("."),c=o;for(let y=0;y<i.length-1&&(c=c[i[y]]);y++);let u=i[i.length-1];c&&Object.prototype.hasOwnProperty.call(c,u)&&void 0!==c[u]&&(c[u]=a(c[u],p))}let m=jsyaml.dump(o,{lineWidth:160});document.getElementById("yamlOutput").value=m,document.getElementById("envMapping").value=Object.entries(l).map(([e,t])=>`${e}=${t}`).join("\n"),document.getElementById("envScript").value=generateEnvScript(l,r)}catch(d){document.getElementById("yamlOutput").value="Error: "+d.message}}