function generateRandomHex32(){let e="";for(let t=0;t<32;t++)e+=Math.floor(16*Math.random()).toString(16);return e}function encryptValue(e,t,r=!1){let n=e.toString();if(r)return n;let l=CryptoJS.lib.WordArray.random(16),o=CryptoJS.enc.Utf8.parse(t),a=CryptoJS.AES.encrypt(n,o,{iv:l,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),p=a.ciphertext,i=p.clone().concat(l),c=CryptoJS.HmacSHA256(i,o),u=l.clone().concat(c).concat(p);return CryptoJS.enc.Base64.stringify(u)}function decryptValue(e,t){if(!e)return null;let r=CryptoJS.enc.Utf8.parse(t),n=CryptoJS.enc.Base64.parse(e);if(n.sigBytes<48)return null;let l=CryptoJS.lib.WordArray.create(n.words.slice(0,4),16),o=CryptoJS.lib.WordArray.create(n.words.slice(4,12),32),a=CryptoJS.lib.WordArray.create(n.words.slice(12),n.sigBytes-16-32),p=a.clone().concat(l),i=CryptoJS.HmacSHA256(p,r);if(CryptoJS.enc.Hex.stringify(i)!==CryptoJS.enc.Hex.stringify(o))return console.warn("HMAC mismatch"),null;let c=CryptoJS.AES.decrypt({ciphertext:a},r,{iv:l,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return c.toString(CryptoJS.enc.Utf8)}function encryptObject(e,t){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return encryptValue(e,t);if(Array.isArray(e))return e.map(e=>encryptObject(e,t));if("object"==typeof e&&null!==e){let r={};for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=encryptObject(e[n],t));return r}return e}function encryptObjectEnv(e,t,r,n,l=!1){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e){let o=`${r.replace(/[^A-Za-z0-9_]/g,"_").toUpperCase()}`;return n[o]=encryptValue(e,t,l),`\${${o}}`}if(Array.isArray(e))return e.map((e,o)=>encryptObjectEnv(e,t,`${r}_${o}`,n,l));if("object"==typeof e&&null!==e){let a={};for(let p in e)Object.prototype.hasOwnProperty.call(e,p)&&(a[p]=encryptObjectEnv(e[p],t,`${r}_${p}`,n,l));return a}return e}function decryptObject(e,t){if("string"==typeof e){let r=decryptValue(e,t);return null!==r?r:e}if(Array.isArray(e))return e.map(e=>decryptObject(e,t));if("object"==typeof e&&null!==e){let n={};for(let l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=decryptObject(e[l],t));return n}return e}function getPropertiesToProcess(){return document.getElementById("propsInput").value.split("\n").map(e=>e.trim()).filter(e=>""!==e)}function encryptYaml(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=getPropertiesToProcess();try{let n=jsyaml.load(e);for(let l of r){let o=l.split("."),a=n;for(let p=0;p<o.length-1&&(a=a[o[p]]);p++);let i=o[o.length-1];a&&Object.prototype.hasOwnProperty.call(a,i)&&void 0!==a[i]&&(a[i]=encryptObject(a[i],t))}let c=jsyaml.dump(n,{lineWidth:160});document.getElementById("yamlOutput").value=c}catch(u){document.getElementById("yamlOutput").value="Error: "+u.message}}function generateEnvScript(e,t){return"windows"===t?Object.entries(e).map(([e,t])=>`setx ${e} "${t}"`).join("\n"):Object.entries(e).map(([e,t])=>`export ${e}="${t}"`).join("\n")}function decryptYaml(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=getPropertiesToProcess();try{let n=jsyaml.load(e);for(let l of r){let o=l.split("."),a=n;for(let p=0;p<o.length-1&&(a=a[o[p]]);p++);let i=o[o.length-1];a&&Object.prototype.hasOwnProperty.call(a,i)&&void 0!==a[i]&&(a[i]=decryptObject(a[i],t))}let c=jsyaml.dump(n,{lineWidth:160});document.getElementById("yamlOutput").value=c}catch(u){document.getElementById("yamlOutput").value="Error: "+u.message}}function placeholderAll(e,t,r){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e){let n=`${toEnvName(t)}`;return r[n]=e,`\${${n}}`}if(Array.isArray(e))return e.map((e,n)=>placeholderAll(e,`${t}_${n}`,r));if("object"==typeof e&&null!==e){let l={};for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&(l[o]=placeholderAll(e[o],`${t}_${o}`,r));return l}return e}function generatePlaceholder(){let e=document.getElementById("yamlInput").value,t=document.getElementById("osSelect").value,r={};try{let n=jsyaml.load(e),l=placeholderAll(n,"root",r),o=jsyaml.dump(l,{lineWidth:160});document.getElementById("yamlOutput").value=o,document.getElementById("envMapping").value=Object.entries(r).map(([e,t])=>`${e}=${t}`).join("\n"),document.getElementById("envScript").value=generateEnvScript(r,t)}catch(a){document.getElementById("yamlOutput").value="Error: "+a.message}}function encryptYamlEnv(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=document.getElementById("osSelect").value,n={};try{let l=jsyaml.load(e),o=function e(r,n,l){if("string"==typeof r||"number"==typeof r||"boolean"==typeof r){let o=`${toEnvName(n)}`,a=String(r),p=CryptoJS.AES.encrypt(a,t).toString();return l[o]=p,`\${${o}}`}if(Array.isArray(r))return r.map((t,r)=>e(t,`${n}_${r}`,l));if("object"==typeof r&&null!==r){let i={};for(let c in r)Object.prototype.hasOwnProperty.call(r,c)&&(i[c]=e(r[c],`${n}_${c}`,l));return i}return r}(l,"root",n),a=jsyaml.dump(o,{lineWidth:160});document.getElementById("yamlOutput").value=a,document.getElementById("envMapping").value=Object.entries(n).map(([e,t])=>`${e}=${t}`).join("\n"),document.getElementById("envScript").value=generateEnvScript(n,r)}catch(p){document.getElementById("yamlOutput").value="Error: "+p.message}}function toEnvName(e){return e.replace(/^root_?/i,"").replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/[^A-Za-z0-9_]/g,"_").toUpperCase()}function toXml(e,t="root",r="item"){let n=document.implementation.createDocument("","",null),l=n.createElement(t);n.appendChild(l),arrayToXml(e,l,t,r,n);let o=new XMLSerializer,a=o.serializeToString(n);return formatXml(a)}function arrayToXml(e,t,r,n,l){if(Array.isArray(e))e.forEach(e=>{let o=l.createElement(n);t.appendChild(o),arrayToXml(e,o,r,n,l)});else if("object"==typeof e&&null!==e){for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];if(Array.isArray(a))a.forEach(e=>{let r=l.createElement(o);t.appendChild(r),arrayToXml(e,r,o,n,l)});else if("object"==typeof a&&null!==a){let p=l.createElement(o);t.appendChild(p),arrayToXml(a,p,o,n,l)}else{let i=l.createElement(o);i.textContent=a,t.appendChild(i)}}}else t.textContent=e}function formatXml(e){let t="",r=0;return(e=e.replace(/>\s*</g,">\n<")).split("\n").forEach(e=>{(e=e.trim())&&(/^<\//.test(e)?(r-=1,t+="  ".repeat(r)+e+"\n"):/^<[^>]+\/>/.test(e)?t+="  ".repeat(r)+e+"\n":/^<[^>]+>.*<\/[^>]+>$/.test(e)?t+="  ".repeat(r)+e+"\n":/^<[^>]+>/.test(e)?(t+="  ".repeat(r)+e+"\n",r+=1):t+="  ".repeat(r)+e+"\n")}),t.trim()}function arrayToXml(e,t,r,n,l){Array.isArray(e)?e.forEach(e=>{let o=l.createElement(n);t.appendChild(o),arrayToXml(e,o,r,n,l)}):"object"==typeof e&&null!==e?Object.entries(e).forEach(([e,r])=>{if(Array.isArray(r)){let o=l.createElement(e);t.appendChild(o),r.forEach(t=>{let r=l.createElement(n);o.appendChild(r),arrayToXml(t,r,e,n,l)})}else if("object"==typeof r&&null!==r){let a=l.createElement(e);t.appendChild(a),arrayToXml(r,a,e,n,l)}else{let p=l.createElement(e);p.textContent=r,t.appendChild(p)}}):t.textContent=e}function yamlToXml(e){let t=jsyaml.load(e);return toXml(t,"root","item")}function copyYaml(e){let t=e.closest(".form-group").querySelector("textarea"),r=e.textContent,n=t.value;e.disabled=!0,navigator.clipboard.writeText(n).then(()=>{e.textContent="Copied!",setTimeout(()=>{e.textContent=r,e.disabled=!1},2e3)}).catch(e=>{console.error("Failed to copy text: ",e)})}function copyXml(e){let t=e.closest(".form-group").querySelector("textarea"),r=e.textContent,n=yamlToXml(t.value);e.disabled=!0,navigator.clipboard.writeText(n).then(()=>{e.textContent="Copied!",setTimeout(()=>{e.textContent=r,e.disabled=!1},2e3)}).catch(e=>{console.error("Failed to copy text: ",e)})}