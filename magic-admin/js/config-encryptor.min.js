function generateRandomHex32(){let e="";for(let t=0;t<32;t++)e+=Math.floor(16*Math.random()).toString(16);return e}function encryptValue(e,t,r=!1){let n=e.toString();if(r)return n;let l=CryptoJS.lib.WordArray.random(16),o=CryptoJS.enc.Utf8.parse(t),a=CryptoJS.AES.encrypt(n,o,{iv:l,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),p=a.ciphertext,c=p.clone().concat(l),i=CryptoJS.HmacSHA256(c,o),u=l.clone().concat(i).concat(p);return CryptoJS.enc.Base64.stringify(u)}function decryptValue(e,t){if(!e)return null;let r=CryptoJS.enc.Utf8.parse(t),n=CryptoJS.enc.Base64.parse(e);if(n.sigBytes<48)return null;let l=CryptoJS.lib.WordArray.create(n.words.slice(0,4),16),o=CryptoJS.lib.WordArray.create(n.words.slice(4,12),32),a=CryptoJS.lib.WordArray.create(n.words.slice(12),n.sigBytes-16-32),p=a.clone().concat(l),c=CryptoJS.HmacSHA256(p,r);if(CryptoJS.enc.Hex.stringify(c)!==CryptoJS.enc.Hex.stringify(o))return console.warn("HMAC mismatch"),null;let i=CryptoJS.AES.decrypt({ciphertext:a},r,{iv:l,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return i.toString(CryptoJS.enc.Utf8)}function encryptObject(e,t){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return encryptValue(e,t);if(Array.isArray(e))return e.map(e=>encryptObject(e,t));if("object"==typeof e&&null!==e){let r={};for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=encryptObject(e[n],t));return r}return e}function encryptObjectEnv(e,t,r,n,l=!1){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e){let o=`${r.replace(/[^A-Za-z0-9_]/g,"_").toUpperCase()}`;return n[o]=encryptValue(e,t,l),`\${${o}}`}if(Array.isArray(e))return e.map((e,o)=>encryptObjectEnv(e,t,`${r}_${o}`,n,l));if("object"==typeof e&&null!==e){let a={};for(let p in e)Object.prototype.hasOwnProperty.call(e,p)&&(a[p]=encryptObjectEnv(e[p],t,`${r}_${p}`,n,l));return a}return e}function decryptObject(e,t){if("string"==typeof e){let r=decryptValue(e,t);return null!==r?r:e}if(Array.isArray(e))return e.map(e=>decryptObject(e,t));if("object"==typeof e&&null!==e){let n={};for(let l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=decryptObject(e[l],t));return n}return e}function getPropertiesToProcess(){return document.getElementById("propsInput").value.split("\n").map(e=>e.trim()).filter(e=>""!==e)}function encryptYaml(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=getPropertiesToProcess();try{let n=jsyaml.load(e);for(let l of r){let o=l.split("."),a=n;for(let p=0;p<o.length-1&&(a=a[o[p]]);p++);let c=o[o.length-1];a&&Object.prototype.hasOwnProperty.call(a,c)&&void 0!==a[c]&&(a[c]=encryptObject(a[c],t))}let i=jsyaml.dump(n,{lineWidth:160});document.getElementById("yamlOutput").value=i}catch(u){document.getElementById("yamlOutput").value="Error: "+u.message}}function generateEnvScript(e,t){return"windows"===t?Object.entries(e).map(([e,t])=>`setx ${e} "${t}"`).join("\n"):Object.entries(e).map(([e,t])=>`export ${e}="${t}"`).join("\n")}function decryptYaml(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=getPropertiesToProcess();try{let n=jsyaml.load(e);for(let l of r){let o=l.split("."),a=n;for(let p=0;p<o.length-1&&(a=a[o[p]]);p++);let c=o[o.length-1];a&&Object.prototype.hasOwnProperty.call(a,c)&&void 0!==a[c]&&(a[c]=decryptObject(a[c],t))}let i=jsyaml.dump(n,{lineWidth:160});document.getElementById("yamlOutput").value=i}catch(u){document.getElementById("yamlOutput").value="Error: "+u.message}}function placeholderAll(e,t,r){if("string"==typeof e||"number"==typeof e||"boolean"==typeof e){let n=`${toEnvName(t)}`;return r[n]=e,`\${${n}}`}if(Array.isArray(e))return e.map((e,n)=>placeholderAll(e,`${t}_${n}`,r));if("object"==typeof e&&null!==e){let l={};for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&(l[o]=placeholderAll(e[o],`${t}_${o}`,r));return l}return e}function generatePlaceholder(){let e=document.getElementById("yamlInput").value,t=document.getElementById("osSelect").value,r={};try{let n=jsyaml.load(e),l=placeholderAll(n,"root",r),o=jsyaml.dump(l,{lineWidth:160});document.getElementById("yamlOutput").value=o,document.getElementById("envMapping").value=Object.entries(r).map(([e,t])=>`${e}=${t}`).join("\n"),document.getElementById("envScript").value=generateEnvScript(r,t)}catch(a){document.getElementById("yamlOutput").value="Error: "+a.message}}function encryptYamlEnv(){let e=document.getElementById("yamlInput").value,t=document.getElementById("keyInput").value.trim(),r=document.getElementById("osSelect").value,n={};try{let l=jsyaml.load(e),o=function e(r,n,l){if("string"==typeof r||"number"==typeof r||"boolean"==typeof r){let o=`${toEnvName(n)}`,a=String(r),p=CryptoJS.AES.encrypt(a,t).toString();return l[o]=p,`\${${o}}`}if(Array.isArray(r))return r.map((t,r)=>e(t,`${n}_${r}`,l));if("object"==typeof r&&null!==r){let c={};for(let i in r)Object.prototype.hasOwnProperty.call(r,i)&&(c[i]=e(r[i],`${n}_${i}`,l));return c}return r}(l,"root",n),a=jsyaml.dump(o,{lineWidth:160});document.getElementById("yamlOutput").value=a,document.getElementById("envMapping").value=Object.entries(n).map(([e,t])=>`${e}=${t}`).join("\n"),document.getElementById("envScript").value=generateEnvScript(n,r)}catch(p){document.getElementById("yamlOutput").value="Error: "+p.message}}function toEnvName(e){return e.replace(/^root_?/i,"").replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/[^A-Za-z0-9_]/g,"_").toUpperCase()}